<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Pro Chord Studio - Profesyonel Akor √úretici & Antrenman</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0a0a0f" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-elevated: #1a1a25;
      --border-subtle: #2a2a3a;
      --border-active: #4a4a6a;
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #5a5a70;
      --accent-green: #00ff88;
      --accent-green-dim: #00cc6a;
      --accent-blue: #00aaff;
      --accent-purple: #aa55ff;
      --accent-orange: #ff8844;
      --accent-red: #ff4466;
      --accent-yellow: #ffcc00;
      --glow-green: rgba(0, 255, 136, 0.3);
      --glow-blue: rgba(0, 170, 255, 0.3);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    /* Animated Background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 170, 255, 0.05) 0%, transparent 50%);
      pointer-events: none;
    }

    /* Header - Mobile Optimized */
    .header {
      padding: 12px 16px;
      padding-top: calc(12px + var(--safe-top));
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
      gap: 12px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .logo-text {
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Mode Tabs - Scrollable on Mobile */
    .mode-tabs-wrapper {
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      flex: 1;
      min-width: 0;
    }

    .mode-tabs-wrapper::-webkit-scrollbar {
      display: none;
    }

    .mode-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-card);
      padding: 4px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      width: max-content;
      min-width: 100%;
    }

    .mode-tab {
      padding: 8px 12px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .mode-tab:hover {
      color: var(--text-primary);
      background: var(--bg-elevated);
    }

    .mode-tab.active {
      background: var(--accent-green);
      color: var(--bg-dark);
    }

    /* Main Container - Mobile First */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: calc(12px + var(--safe-bottom));
    }

    /* Panel */
    .panel {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 16px;
      transition: border-color 0.2s ease;
    }

    .panel-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }

    .panel-icon {
      width: 32px;
      height: 32px;
      background: var(--bg-elevated);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .panel-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Controls Grid - Mobile */
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .control-group.full-width {
      grid-column: 1 / -1;
    }

    .control-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 16px; /* Prevents zoom on iOS */
      cursor: pointer;
      transition: all 0.2s ease;
      appearance: none;
      -webkit-appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238888a0' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--accent-green);
      box-shadow: 0 0 0 3px var(--glow-green);
    }

    /* Buttons - Touch Optimized */
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      min-height: 48px; /* Touch target */
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dim));
      color: var(--bg-dark);
      box-shadow: 0 4px 20px var(--glow-green);
    }

    .btn-primary:active {
      transform: scale(0.98);
      box-shadow: 0 2px 10px var(--glow-green);
    }

    .btn-secondary {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
    }

    .btn-secondary:active {
      background: var(--border-subtle);
    }

    .btn-full {
      width: 100%;
    }

    .btn-group {
      display: flex;
      gap: 8px;
    }

    .btn-icon {
      width: 48px;
      height: 48px;
      padding: 0;
      border-radius: 12px;
      font-size: 1.2rem;
    }

    /* Toggle Button */
    .toggle-btn {
      position: relative;
      width: 52px;
      height: 28px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .toggle-btn::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: var(--text-secondary);
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .toggle-btn.active {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }

    .toggle-btn.active::after {
      left: 27px;
      background: var(--bg-dark);
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      gap: 12px;
    }

    .toggle-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    /* Transport Bar - Mobile Optimized */
    .transport-bar {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .transport-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .transport-btn {
      width: 48px;
      height: 48px;
      border: none;
      border-radius: 50%;
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .transport-btn:active {
      transform: scale(0.95);
    }

    .transport-btn.play-btn {
      width: 56px;
      height: 56px;
      background: var(--accent-green);
      color: var(--bg-dark);
    }

    .transport-btn.play-btn.playing {
      background: var(--accent-orange);
    }

    .transport-btn.active {
      background: var(--accent-blue);
      color: var(--bg-dark);
    }

    /* Rhythm Selector */
    .rhythm-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-elevated);
      border-radius: 12px;
      margin-left: 8px;
    }

    .comping-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-elevated);
      border-radius: 12px;
      margin-left: 8px;
    }

    .rhythm-nav-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .rhythm-nav-btn:hover {
      background: var(--accent-purple);
      color: white;
    }

    .rhythm-nav-btn:active {
      transform: scale(0.9);
    }

    .rhythm-name {
      min-width: 100px;
      text-align: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent-purple);
    }

    .comping-name {
      min-width: 90px;
      text-align: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--accent-coral);
    }

    .bass-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-elevated);
      border-radius: 12px;
      margin-left: 8px;
    }

    .bass-name {
      min-width: 95px;
      text-align: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: #22c55e; /* Ye≈üil - bass i√ßin */
    }

    /* Tempo Display */
    .tempo-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 8px 16px;
      background: var(--bg-elevated);
      border-radius: 12px;
    }

    .tempo-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-green);
      min-width: 50px;
      text-align: center;
    }

    .tempo-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .tempo-btn {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 8px;
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tempo-btn:active {
      background: var(--border-subtle);
    }

    /* Metronome Visual */
    .metronome-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .metronome-visual {
      display: flex;
      gap: 6px;
    }

    .beat-dot {
      width: 12px;
      height: 12px;
      background: var(--bg-elevated);
      border: 2px solid var(--border-subtle);
      border-radius: 50%;
      transition: all 0.1s ease;
    }

    .beat-dot.active {
      background: var(--accent-green);
      border-color: var(--accent-green);
      box-shadow: 0 0 10px var(--glow-green);
    }

    .beat-dot.accent {
      background: var(--accent-orange);
      border-color: var(--accent-orange);
    }

    /* Progress Bar */
    .progress-section {
      width: 100%;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-elevated);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s linear;
    }

    /* Chord Display */
    .chord-display {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 16px;
    }

    .chord-display-header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
    }

    .chord-display-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .chord-info-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .info-tag {
      padding: 4px 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .info-tag span {
      color: var(--accent-green);
      font-weight: 600;
    }

    /* Chord Chips - Touch Optimized */
    .chords-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .chord-chip {
      position: relative;
      padding: 12px 16px;
      background: var(--bg-elevated);
      border: 2px solid var(--border-subtle);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 70px;
      touch-action: manipulation;
    }

    .chord-chip:active {
      transform: scale(0.97);
    }

    .chord-chip.active {
      border-color: var(--accent-green);
      background: rgba(0, 255, 136, 0.1);
      box-shadow: 0 0 15px var(--glow-green);
    }

    .chord-chip.playing {
      border-color: var(--accent-orange);
      background: rgba(255, 136, 68, 0.15);
      animation: pulse 0.3s ease;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }

    .chord-index {
      position: absolute;
      top: -6px;
      left: -6px;
      width: 20px;
      height: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 50%;
      font-size: 0.65rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
    }

    .chord-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .chord-roman {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .chord-notes-mini {
      font-size: 0.6rem;
      color: var(--text-muted);
      margin-top: 3px;
    }

    /* Roman Numerals */
    .roman-line {
      padding: 10px 14px;
      background: var(--bg-elevated);
      border-radius: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-align: center;
      overflow-x: auto;
      white-space: nowrap;
    }

    /* Piano Section */
    .piano-section {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 16px;
      overflow: hidden;
    }

    .piano-header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .piano-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .current-chord-display {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .current-chord-name {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .current-chord-notes {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Piano Wrapper - Scrollable on Mobile */
    .piano-wrapper {
      background: linear-gradient(180deg, #1a1a25 0%, #0f0f18 100%);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid var(--border-subtle);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .piano-svg {
      display: block;
      min-width: 700px;
      height: auto;
    }

    .piano-key {
      transition: fill 0.08s ease, filter 0.08s ease;
      cursor: pointer;
      touch-action: manipulation;
    }

    .white-key {
      fill: #f8f8f8;
      stroke: #d0d0d0;
      stroke-width: 1;
    }

    .white-key:active {
      fill: #e0e0e0;
    }

    .black-key {
      fill: #1a1a1a;
      stroke: #000;
      stroke-width: 1;
    }

    .black-key:active {
      fill: #333;
    }

    .piano-key.active.white-key {
      fill: #a8ffd0;
      stroke: var(--accent-green);
      stroke-width: 2;
      filter: drop-shadow(0 0 8px var(--glow-green));
    }

    .piano-key.active.black-key {
      fill: var(--accent-green);
      stroke: var(--accent-green);
      filter: drop-shadow(0 0 8px var(--glow-green));
    }

    /* Staff Section */
    .staff-section {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 16px;
    }

    .staff-wrapper {
      background: #fffff8;
      border-radius: 10px;
      padding: 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .staff-svg {
      display: block;
      min-width: 500px;
    }

    /* Articulation Panel */
    .articulation-panel {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }

    .articulation-btn {
      padding: 10px 6px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: center;
      touch-action: manipulation;
    }

    .articulation-btn:active {
      transform: scale(0.97);
    }

    .articulation-btn.active {
      background: var(--accent-purple);
      border-color: var(--accent-purple);
      color: white;
    }

    .articulation-icon {
      font-size: 1rem;
      display: block;
      margin-bottom: 2px;
    }

    /* Training Stats */
    .training-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .stat-box {
      background: var(--bg-elevated);
      border-radius: 10px;
      padding: 12px 8px;
      text-align: center;
    }

    .stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .stat-label {
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    /* Note Finder Styles */
    .note-finder-modes {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .note-finder-modes .btn {
      flex: 1;
    }

    .target-note-display {
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 4px;
      padding: 24px;
      background: var(--bg-elevated);
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .target-note-name {
      font-family: 'JetBrains Mono', monospace;
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .target-note-octave {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      color: var(--text-secondary);
    }

    .note-finder-feedback {
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      margin: 12px 0;
      font-weight: 600;
      min-height: 44px;
    }

    .note-finder-feedback.correct {
      background: rgba(0, 255, 136, 0.2);
      color: var(--accent-green);
    }

    .note-finder-feedback.wrong {
      background: rgba(255, 68, 102, 0.2);
      color: var(--accent-red);
    }

    .note-finder-stats, .chord-recog-stats {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
    }

    .stat-mini {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-mini-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .stat-mini-label {
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    /* Chord Recognition Styles */
    .root-note-options,
    .chord-type-options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .note-option,
    .type-option {
      padding: 10px 14px;
      background: var(--bg-elevated);
      border: 2px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.15s ease;
      touch-action: manipulation;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .note-option:active,
    .type-option:active {
      transform: scale(0.97);
    }

    .note-option.selected,
    .type-option.selected {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: var(--bg-dark);
    }

    .chord-recog-result {
      text-align: center;
      padding: 16px;
      border-radius: 10px;
      margin-top: 12px;
      font-size: 1rem;
      font-weight: 600;
      min-height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chord-recog-result.correct {
      background: rgba(0, 255, 136, 0.15);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
    }

    .chord-recog-result.wrong {
      background: rgba(255, 68, 102, 0.15);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
    }

    /* Key Detection Styles */
    .key-result-primary {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 170, 255, 0.1));
      border: 1px solid var(--accent-green);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .key-result-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .key-result-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .key-result-confidence {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .confidence-bar {
      flex: 1;
      min-width: 100px;
      height: 8px;
      background: var(--bg-elevated);
      border-radius: 4px;
      overflow: hidden;
    }

    .confidence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      border-radius: 4px;
      width: 0%;
      transition: width 0.5s ease;
    }

    .confidence-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      color: var(--accent-green);
    }

    .alternative-keys {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .alt-key-chip {
      padding: 6px 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .alt-key-chip .confidence {
      color: var(--text-muted);
      font-size: 0.65rem;
      margin-left: 4px;
    }

    .analysis-section {
      margin-bottom: 16px;
    }

    .analysis-title {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .note-distribution {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .note-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 24px;
    }

    .note-bar-fill {
      width: 18px;
      background: var(--accent-blue);
      border-radius: 3px 3px 0 0;
      min-height: 2px;
    }

    .note-bar-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .functional-analysis {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .function-chip {
      padding: 6px 10px;
      background: var(--bg-elevated);
      border-radius: 6px;
      font-size: 0.75rem;
    }

    .function-chip .chord-name {
      font-size: 0.8rem;
    }

    .function-chip .function-name {
      color: var(--accent-purple);
      margin-left: 4px;
    }

    .modal-character {
      padding: 12px;
      background: var(--bg-elevated);
      border-radius: 8px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .modal-character .highlight {
      color: var(--accent-orange);
      font-weight: 600;
    }

    /* Preset Chips */
    .preset-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .preset-chip {
      padding: 8px 12px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      touch-action: manipulation;
    }

    .preset-chip:active {
      transform: scale(0.97);
    }

    .preset-chip:hover {
      border-color: var(--accent-green);
      color: var(--accent-green);
    }

    /* Song Library */
    .song-library {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .song-genre-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.85rem;
      cursor: pointer;
    }

    .song-list {
      max-height: 300px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding-right: 4px;
    }

    .song-list::-webkit-scrollbar {
      width: 6px;
    }

    .song-list::-webkit-scrollbar-thumb {
      background: var(--border-subtle);
      border-radius: 3px;
    }

    .song-item {
      padding: 10px 12px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .song-item:hover {
      border-color: var(--accent-green);
      background: rgba(0, 255, 136, 0.05);
    }

    .song-item.active {
      border-color: var(--accent-green);
      background: rgba(0, 255, 136, 0.1);
    }

    .song-item-name {
      font-size: 0.8rem;
      color: var(--text-primary);
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-item-info {
      display: flex;
      gap: 10px;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .song-item-key {
      color: var(--accent-green);
    }

    .song-item-tempo {
      color: var(--accent-blue);
    }

    .song-item-chords {
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }

    /* Chord Section Labels */
    .chord-section {
      width: 100%;
      margin-bottom: 12px;
    }

    .chord-section-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--accent-purple);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      padding: 4px 8px;
      background: rgba(167, 139, 250, 0.1);
      border-radius: 4px;
      display: inline-block;
    }

    /* Slider */
    .slider-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .slider-value {
      min-width: 50px;
      padding: 6px 8px;
      background: var(--bg-elevated);
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      text-align: center;
      color: var(--accent-green);
    }

    input[type="range"] {
      flex: 1;
      height: 6px;
      background: var(--bg-elevated);
      border-radius: 3px;
      appearance: none;
      -webkit-appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--accent-green);
      border-radius: 50%;
      cursor: pointer;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 30px 16px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 2.5rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* Loading Indicator */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 10, 15, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      cursor: pointer;
    }

    .loading-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .loading-icon {
      font-size: 64px;
      margin-bottom: 16px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--border-subtle);
      border-top-color: var(--accent-green);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .loading-text {
      margin-top: 16px;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Collapsible Sections for Mobile */
    .collapsible-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 4px 0;
    }

    .collapsible-icon {
      transition: transform 0.2s ease;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .collapsible-content {
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.collapsed {
      max-height: 0;
    }

    /* Piano Key Animations */
    .piano-key.correct-hit {
      fill: var(--accent-green) !important;
      animation: correctFlash 0.3s ease;
    }

    .piano-key.wrong-hit {
      fill: var(--accent-red) !important;
      animation: wrongShake 0.3s ease;
    }

    .piano-key.hint {
      animation: hintPulse 1s ease infinite;
    }

    @keyframes correctFlash {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }

    @keyframes hintPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Desktop Enhancements */
    @media (min-width: 768px) {
      .header {
        padding: 16px 24px;
      }

      .logo-text {
        font-size: 1.3rem;
      }

      .mode-tab {
        padding: 10px 16px;
        font-size: 0.85rem;
      }

      .main-container {
        padding: 20px;
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 20px;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .content-area {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .panel {
        padding: 20px;
      }

      .transport-bar {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-between;
        padding: 16px 20px;
      }

      .transport-row {
        flex-wrap: nowrap;
      }

      .chord-display-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .piano-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .articulation-panel {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .main-container {
        grid-template-columns: 340px 1fr;
      }
    }

    /* Mobile Specific */
    @media (max-width: 767px) {
      .sidebar {
        display: none;
      }

      .sidebar.mobile-visible {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .mobile-settings-toggle {
        display: flex;
      }

      .articulation-panel {
        grid-template-columns: repeat(4, 1fr);
      }

      .controls-grid {
        grid-template-columns: 1fr;
      }

      .training-stats {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 400px) {
      .articulation-panel {
        grid-template-columns: repeat(2, 1fr);
      }

      .chord-chip {
        min-width: 60px;
        padding: 10px 12px;
      }

      .chord-name {
        font-size: 1rem;
      }
    }

    /* Landscape Mobile */
    @media (max-height: 500px) and (orientation: landscape) {
      .header {
        padding: 8px 16px;
      }

      .logo-icon {
        width: 28px;
        height: 28px;
        font-size: 14px;
      }

      .logo-text {
        font-size: 1rem;
      }

      .panel {
        padding: 12px;
      }

      .panel-header {
        margin-bottom: 10px;
      }
    }

    /* Mobile Settings Button */
    .mobile-settings-btn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent-green);
      color: var(--bg-dark);
      border: none;
      font-size: 1.5rem;
      box-shadow: 0 4px 20px var(--glow-green);
      z-index: 99;
      cursor: pointer;
    }

    @media (max-width: 767px) {
      .mobile-settings-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    /* Bottom Sheet for Mobile Settings */
    .mobile-bottom-sheet {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-card);
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      padding: 20px;
      padding-bottom: calc(20px + var(--safe-bottom));
      z-index: 101;
      max-height: 70vh;
      overflow-y: auto;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .mobile-bottom-sheet.visible {
      display: block;
      transform: translateY(0);
    }

    .bottom-sheet-handle {
      width: 40px;
      height: 4px;
      background: var(--border-subtle);
      border-radius: 2px;
      margin: 0 auto 16px;
    }

    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 100;
    }

    .mobile-overlay.visible {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Piyano sesleri y√ºkleniyor...</div>
  </div>

  <div class="bg-animation"></div>

  <!-- Header -->
  <header class="header">
    <div class="logo">
      <div class="logo-icon">üéπ</div>
      <div class="logo-text">Pro Chord</div>
    </div>
    
    <div class="mode-tabs-wrapper">
      <div class="mode-tabs">
        <button class="mode-tab active" data-mode="create">Olu≈ütur</button>
        <button class="mode-tab" data-mode="practice">Antrenman</button>
        <button class="mode-tab" data-mode="noteFinder">Nota Bul</button>
        <button class="mode-tab" data-mode="chordRecog">Akor Tanƒ±</button>
        <button class="mode-tab" data-mode="keyDetect">Tonalite</button>
      </div>
    </div>
  </header>

  <!-- Mobile Settings Button -->
  <button class="mobile-settings-btn" id="mobileSettingsBtn">‚öôÔ∏è</button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- Mobile Bottom Sheet -->
  <div class="mobile-bottom-sheet" id="mobileBottomSheet">
    <div class="bottom-sheet-handle"></div>
    <div id="mobileSettingsContent"></div>
  </div>

  <div class="main-container">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar" id="sidebar">
      <!-- Settings panels will be here -->
    </aside>

    <!-- Main Content -->
    <main class="content-area" id="contentArea">
      <!-- Dynamic content -->
    </main>
  </div>

  <script>
// ============================================
// B√ñL√úM 1 SONU - B√ñL√úM 2'Yƒ∞ BURAYA YAPI≈ûTIRIN
// ============================================
// ============================================
// B√ñL√úM 2 BA≈ûLANGICI - SES MOTORU VE VERƒ∞LER
// ============================================

// === TEMEL VERƒ∞LER ===
const NOTES_SHARP = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
const NOTES_FLAT = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];

const NOTE_TO_MIDI = {
  "C": 0, "C#": 1, "Db": 1, "D": 2, "D#": 3, "Eb": 3, "E": 4,
  "F": 5, "F#": 6, "Gb": 6, "G": 7, "G#": 8, "Ab": 8,
  "A": 9, "A#": 10, "Bb": 10, "B": 11
};

// === GAM KALIPLARI ===
const SCALE_PATTERNS = {
  major: [0, 2, 4, 5, 7, 9, 11],
  naturalMinor: [0, 2, 3, 5, 7, 8, 10],
  harmonicMinor: [0, 2, 3, 5, 7, 8, 11],
  melodicMinor: [0, 2, 3, 5, 7, 9, 11],
  dorian: [0, 2, 3, 5, 7, 9, 10],
  phrygian: [0, 1, 3, 5, 7, 8, 10],
  lydian: [0, 2, 4, 6, 7, 9, 11],
  mixolydian: [0, 2, 4, 5, 7, 9, 10],
  locrian: [0, 1, 3, 5, 6, 8, 10],
  pentatonicMajor: [0, 2, 4, 7, 9],
  pentatonicMinor: [0, 3, 5, 7, 10],
  blues: [0, 3, 5, 6, 7, 10]
};

// === AKOR Tƒ∞PLERƒ∞ ===
const CHORD_TYPES = {
  maj: { intervals: [0, 4, 7], symbol: "", name: "Major", short: "Maj" },
  min: { intervals: [0, 3, 7], symbol: "m", name: "Minor", short: "m" },
  dim: { intervals: [0, 3, 6], symbol: "¬∞", name: "Diminished", short: "dim" },
  aug: { intervals: [0, 4, 8], symbol: "+", name: "Augmented", short: "aug" },
  sus2: { intervals: [0, 2, 7], symbol: "sus2", name: "Suspended 2", short: "sus2" },
  sus4: { intervals: [0, 5, 7], symbol: "sus4", name: "Suspended 4", short: "sus4" },
  maj7: { intervals: [0, 4, 7, 11], symbol: "maj7", name: "Major 7th", short: "M7" },
  min7: { intervals: [0, 3, 7, 10], symbol: "m7", name: "Minor 7th", short: "m7" },
  dom7: { intervals: [0, 4, 7, 10], symbol: "7", name: "Dominant 7th", short: "7" },
  dim7: { intervals: [0, 3, 6, 9], symbol: "¬∞7", name: "Diminished 7th", short: "¬∞7" },
  hdim7: { intervals: [0, 3, 6, 10], symbol: "√∏7", name: "Half-Dim 7th", short: "√∏7" },
  aug7: { intervals: [0, 4, 8, 10], symbol: "+7", name: "Augmented 7th", short: "+7" },
  dom9: { intervals: [0, 4, 7, 10, 14], symbol: "9", name: "Dominant 9th", short: "9" },
  add9: { intervals: [0, 4, 7, 14], symbol: "add9", name: "Add 9", short: "add9" }
};

// === AKOR Dƒ∞Zƒ∞Lƒ∞M KALIPLARI - PROFESƒ∞YONEL K√úT√úPHANE ===
// D√ºnyanƒ±n en ikonik ve yaratƒ±cƒ± akor dizilimleri

const PROGRESSION_PATTERNS = {
  
  // ========== POP / ROCK ==========
  pop: {
    "4": [
      { degrees: [1, 5, 6, 4], name: "Axis (I-V-vi-IV)" },
      { degrees: [1, 4, 5, 4], name: "Classic Rock" },
      { degrees: [6, 4, 1, 5], name: "Sensitive" },
      { degrees: [1, 6, 4, 5], name: "50s Doo-Wop" },
      { degrees: [1, 4, 6, 5], name: "Millennial Whoop" },
      { degrees: [4, 5, 6, 1], name: "K-Pop Standard" },
      { degrees: [1, 3, 4, 5], name: "Beatles Pop" },
      { degrees: [1, 5, 4, 5], name: "Power Pop" },
      { degrees: [6, 5, 4, 5], name: "Descending Minor" },
      { degrees: [1, 2, 4, 5], name: "Motown Classic" }
    ],
    "8": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4], name: "Extended Axis" },
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5], name: "Pachelbel Canon" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 5], name: "Emotional Journey" },
      { degrees: [1, 6, 2, 5, 1, 4, 5, 1], name: "Classic Turnaround" },
      { degrees: [1, 4, 6, 5, 1, 4, 2, 5], name: "Verse-Chorus Bridge" },
      { degrees: [1, 3, 4, 4, 6, 6, 5, 5], name: "Slow Build" },
      { degrees: [6, 3, 4, 1, 6, 3, 4, 5], name: "Epic Ballad" },
      { degrees: [1, 1, 4, 4, 5, 4, 1, 1], name: "Country Pop" },
      { degrees: [1, 5, 2, 4, 6, 3, 4, 5], name: "Complex Pop" },
      { degrees: [4, 1, 5, 6, 4, 1, 2, 5], name: "Uplifting Journey" }
    ],
    "12": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4, 4, 5, 6, 1], name: "Full Song Structure" },
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Complete Journey" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 3, 4, 5, 6, 1], name: "Emotional Arc" },
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 6, 4, 5], name: "Canon Extended" },
      { degrees: [1, 4, 5, 4, 6, 4, 5, 5, 1, 4, 2, 5], name: "Dynamic Build" }
    ],
    "16": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4, 6, 4, 1, 5, 6, 4, 1, 1], name: "Full Verse-Chorus" },
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 4, 6, 4, 5, 1], name: "Epic Pop Song" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 3, 4, 5, 6, 1, 4, 5, 6, 1], name: "Cinematic Pop" },
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 5, 6, 3, 4, 1, 2, 5], name: "Double Canon" },
      { degrees: [1, 4, 6, 5, 1, 4, 2, 5, 6, 3, 4, 1, 6, 4, 5, 1], name: "Full Production" }
    ]
  },

  rock: {
    "4": [
      { degrees: [1, 4, 5, 4], name: "Classic Rock" },
      { degrees: [1, 5, 4, 5], name: "Power Chord" },
      { degrees: [1, 7, 4, 4], name: "Hard Rock" },
      { degrees: [1, 6, 3, 7], name: "Metal Minor" },
      { degrees: [1, 4, 1, 5], name: "Blues Rock" },
      { degrees: [6, 7, 1, 1], name: "Dark Rock" },
      { degrees: [1, 3, 4, 6], name: "Grunge" },
      { degrees: [1, 5, 7, 4], name: "Alternative" }
    ],
    "8": [
      { degrees: [1, 4, 5, 4, 1, 4, 5, 5], name: "Rock Anthem" },
      { degrees: [1, 5, 6, 4, 5, 6, 4, 5], name: "Arena Rock" },
      { degrees: [6, 4, 1, 5, 6, 7, 1, 1], name: "Epic Rock" },
      { degrees: [1, 7, 6, 7, 1, 4, 5, 5], name: "Progressive Rock" },
      { degrees: [1, 4, 1, 5, 1, 4, 5, 4], name: "Verse-Chorus Rock" },
      { degrees: [6, 3, 7, 4, 6, 3, 4, 5], name: "Dark Anthem" },
      { degrees: [1, 5, 4, 1, 5, 4, 6, 5], name: "Classic Stadium" },
      { degrees: [1, 6, 3, 4, 1, 6, 5, 5], name: "Power Ballad" }
    ],
    "12": [
      { degrees: [1, 4, 5, 4, 1, 4, 5, 5, 6, 4, 5, 1], name: "Complete Rock Song" },
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4, 4, 5, 1, 1], name: "Rock Ballad" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 7, 6, 7, 1, 1], name: "Dramatic Rock" },
      { degrees: [1, 4, 1, 5, 1, 4, 5, 4, 6, 4, 5, 1], name: "Blues Rock Extended" }
    ],
    "16": [
      { degrees: [1, 4, 5, 4, 1, 4, 5, 5, 6, 4, 1, 5, 6, 4, 5, 1], name: "Epic Rock Journey" },
      { degrees: [1, 5, 6, 4, 1, 5, 6, 7, 1, 4, 5, 4, 6, 4, 5, 1], name: "Stadium Anthem" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 1, 4, 5, 6, 7, 1, 4, 5, 1], name: "Progressive Epic" }
    ]
  },

  // ========== JAZZ ==========
  jazz: {
    "4": [
      { degrees: [2, 5, 1, 1], name: "ii-V-I" },
      { degrees: [1, 6, 2, 5], name: "Rhythm Changes A" },
      { degrees: [3, 6, 2, 5], name: "iii-VI-ii-V" },
      { degrees: [1, 4, 3, 6], name: "I-IV-iii-vi" },
      { degrees: [2, 5, 3, 6], name: "Minor Turnaround" },
      { degrees: [1, 7, 3, 6], name: "Chromatic Descent" },
      { degrees: [4, 7, 3, 6], name: "Backdoor ii-V" },
      { degrees: [1, 1, 4, 4], name: "Jazz Blues Start" }
    ],
    "8": [
      { degrees: [1, 6, 2, 5, 1, 6, 2, 5], name: "Extended Turnaround" },
      { degrees: [1, 6, 2, 5, 3, 6, 2, 5], name: "Rhythm Changes AB" },
      { degrees: [2, 5, 1, 4, 3, 6, 2, 5], name: "Circle of Fifths" },
      { degrees: [1, 4, 3, 6, 2, 5, 1, 1], name: "Standard 8-Bar" },
      { degrees: [1, 7, 6, 5, 4, 3, 2, 5], name: "Chromatic Jazz" },
      { degrees: [2, 5, 1, 6, 2, 5, 3, 6], name: "Coltrane Style" },
      { degrees: [1, 4, 1, 5, 2, 5, 1, 6], name: "Bebop Standard" },
      { degrees: [3, 6, 2, 5, 1, 4, 7, 3], name: "Giant Steps Lite" }
    ],
    "12": [
      { degrees: [1, 1, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5], name: "12-Bar Jazz Blues" },
      { degrees: [1, 6, 2, 5, 1, 6, 2, 5, 3, 6, 2, 5], name: "Extended Rhythm" },
      { degrees: [1, 4, 1, 5, 2, 5, 1, 6, 2, 5, 1, 1], name: "Jazz Standard 12" },
      { degrees: [2, 5, 1, 6, 2, 5, 3, 6, 4, 7, 3, 6], name: "Complex Changes" },
      { degrees: [1, 7, 3, 6, 2, 5, 1, 4, 3, 6, 2, 5], name: "Sophisticated Jazz" }
    ],
    "16": [
      { degrees: [1, 6, 2, 5, 1, 6, 2, 5, 3, 6, 2, 5, 1, 6, 2, 5], name: "Full Rhythm Changes" },
      { degrees: [1, 4, 1, 5, 2, 5, 1, 6, 2, 5, 1, 4, 3, 6, 2, 5], name: "Complete Jazz Standard" },
      { degrees: [2, 5, 1, 6, 2, 5, 3, 6, 2, 5, 1, 4, 7, 3, 6, 2], name: "Advanced Changes" },
      { degrees: [1, 6, 2, 5, 3, 6, 4, 7, 1, 6, 2, 5, 3, 6, 2, 5], name: "Pro Jazz Chart" }
    ]
  },

  // ========== BLUES ==========
  blues: {
    "4": [
      { degrees: [1, 4, 1, 5], name: "Simple Blues" },
      { degrees: [1, 1, 4, 1], name: "Blues Start" },
      { degrees: [5, 4, 1, 5], name: "Turnaround" },
      { degrees: [1, 4, 5, 4], name: "Quick Change" }
    ],
    "8": [
      { degrees: [1, 1, 1, 1, 4, 4, 1, 1], name: "8-Bar Blues" },
      { degrees: [1, 4, 1, 1, 4, 4, 1, 5], name: "Early Blues" },
      { degrees: [1, 1, 4, 4, 1, 5, 4, 1], name: "Slow Blues" },
      { degrees: [1, 4, 1, 5, 1, 4, 5, 1], name: "Country Blues" }
    ],
    "12": [
      { degrees: [1, 1, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5], name: "12-Bar Blues Classic" },
      { degrees: [1, 4, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5], name: "Quick Change Blues" },
      { degrees: [1, 1, 1, 1, 4, 4, 1, 6, 2, 5, 1, 5], name: "Jazz Blues" },
      { degrees: [1, 4, 1, 5, 4, 4, 1, 1, 5, 4, 1, 5], name: "Texas Blues" },
      { degrees: [1, 1, 1, 1, 4, 4, 1, 3, 4, 5, 1, 5], name: "Chicago Blues" }
    ],
    "16": [
      { degrees: [1, 1, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5, 1, 4, 1, 5], name: "Extended 16-Bar Blues" },
      { degrees: [1, 4, 1, 1, 4, 4, 1, 1, 5, 4, 1, 6, 2, 5, 1, 5], name: "Jazz Blues Extended" },
      { degrees: [1, 1, 4, 4, 1, 1, 5, 5, 1, 4, 1, 5, 1, 4, 5, 1], name: "Double Blues" }
    ]
  },

  // ========== BALLAD / EMOTIONAL ==========
  ballad: {
    "4": [
      { degrees: [1, 6, 4, 5], name: "Heart Ballad" },
      { degrees: [6, 4, 1, 5], name: "Sensitive" },
      { degrees: [1, 5, 6, 4], name: "Hope & Pain" },
      { degrees: [1, 3, 4, 5], name: "Dreamy" },
      { degrees: [6, 5, 4, 5], name: "Melancholy" },
      { degrees: [1, 2, 4, 5], name: "Gentle Rise" }
    ],
    "8": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5], name: "Canon Ballad" },
      { degrees: [6, 4, 1, 5, 6, 3, 4, 5], name: "Tearjerker" },
      { degrees: [1, 6, 4, 5, 1, 3, 4, 5], name: "Wedding Song" },
      { degrees: [1, 5, 6, 4, 4, 5, 6, 1], name: "Hopeful End" },
      { degrees: [6, 3, 4, 1, 6, 5, 4, 5], name: "Bittersweet" },
      { degrees: [1, 6, 2, 5, 3, 6, 4, 5], name: "Jazz Ballad" },
      { degrees: [1, 4, 6, 5, 1, 4, 2, 5], name: "Cinematic Emotion" }
    ],
    "12": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 6, 4, 5], name: "Complete Ballad" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 3, 4, 5, 6, 1], name: "Emotional Journey" },
      { degrees: [1, 6, 4, 5, 1, 3, 4, 5, 6, 4, 5, 1], name: "Full Heart" },
      { degrees: [1, 6, 2, 5, 1, 6, 2, 5, 3, 6, 4, 5], name: "Sophisticated Ballad" }
    ],
    "16": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 5, 6, 3, 4, 1, 2, 5], name: "Epic Ballad" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 3, 4, 5, 6, 1, 4, 5, 6, 1], name: "Dramatic Ballad" },
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 3, 6, 4, 1, 6, 4, 5, 1], name: "Wedding Epic" }
    ]
  },

  // ========== EDM / ELECTRONIC ==========
  edm: {
    "4": [
      { degrees: [1, 5, 6, 4], name: "EDM Anthem" },
      { degrees: [6, 4, 1, 5], name: "Emotional EDM" },
      { degrees: [1, 6, 4, 5], name: "Festival" },
      { degrees: [6, 1, 5, 4], name: "Progressive House" },
      { degrees: [1, 4, 6, 5], name: "Future Bass" },
      { degrees: [6, 5, 4, 5], name: "Melodic Techno" },
      { degrees: [1, 5, 4, 5], name: "Big Room" },
      { degrees: [6, 7, 1, 5], name: "Dark EDM" }
    ],
    "8": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4], name: "Main Stage Anthem" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 5], name: "Emotional Build" },
      { degrees: [1, 6, 4, 5, 1, 6, 4, 5], name: "Festival Anthem" },
      { degrees: [6, 1, 5, 4, 6, 1, 5, 5], name: "Progressive Journey" },
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5], name: "Melodic EDM" },
      { degrees: [6, 5, 4, 5, 6, 5, 4, 1], name: "Melodic House" },
      { degrees: [1, 4, 6, 5, 1, 4, 2, 5], name: "Future Pop" }
    ],
    "12": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4, 4, 5, 6, 1], name: "Full EDM Track" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 3, 4, 5, 6, 1], name: "Emotional Arc" },
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Progressive Build" }
    ],
    "16": [
      { degrees: [1, 5, 6, 4, 1, 5, 6, 4, 6, 4, 1, 5, 6, 4, 5, 1], name: "Complete EDM Song" },
      { degrees: [6, 4, 1, 5, 6, 4, 1, 5, 4, 5, 6, 1, 4, 5, 6, 1], name: "Festival Journey" },
      { degrees: [1, 6, 4, 5, 1, 6, 4, 5, 6, 3, 4, 1, 6, 4, 5, 1], name: "Epic Drop" }
    ]
  },

  // ========== LATIN ==========
  latin: {
    "4": [
      { degrees: [2, 5, 1, 1], name: "Salsa Basic" },
      { degrees: [1, 4, 5, 4], name: "Bossa Nova" },
      { degrees: [1, 4, 2, 5], name: "Samba" },
      { degrees: [6, 3, 4, 5], name: "Flamenco" },
      { degrees: [1, 7, 6, 5], name: "Andalusian Cadence" },
      { degrees: [1, 4, 5, 1], name: "Son Cubano" },
      { degrees: [2, 5, 1, 6], name: "Latin Jazz" }
    ],
    "8": [
      { degrees: [2, 5, 1, 6, 2, 5, 1, 1], name: "Salsa Montuno" },
      { degrees: [1, 4, 2, 5, 1, 4, 5, 1], name: "Bossa Standard" },
      { degrees: [1, 6, 2, 5, 1, 4, 5, 1], name: "Latin Ballad" },
      { degrees: [6, 3, 4, 5, 6, 3, 7, 1], name: "Flamenco 8" },
      { degrees: [1, 7, 6, 5, 4, 3, 2, 1], name: "Full Andalusian" },
      { degrees: [1, 4, 5, 4, 1, 4, 2, 5], name: "Cumbia" },
      { degrees: [2, 5, 1, 4, 2, 5, 3, 6], name: "Afro-Cuban" }
    ],
    "12": [
      { degrees: [2, 5, 1, 6, 2, 5, 1, 4, 2, 5, 1, 1], name: "Salsa Extended" },
      { degrees: [1, 4, 2, 5, 1, 4, 5, 1, 6, 2, 5, 1], name: "Bossa Completa" },
      { degrees: [1, 7, 6, 5, 4, 3, 2, 1, 4, 5, 1, 1], name: "Flamenco Full" },
      { degrees: [1, 6, 2, 5, 3, 6, 2, 5, 1, 4, 5, 1], name: "Latin Jazz Standard" }
    ],
    "16": [
      { degrees: [2, 5, 1, 6, 2, 5, 1, 1, 2, 5, 1, 4, 2, 5, 1, 1], name: "Complete Salsa" },
      { degrees: [1, 4, 2, 5, 1, 4, 5, 1, 1, 6, 2, 5, 1, 4, 5, 1], name: "Full Bossa Nova" },
      { degrees: [6, 3, 4, 5, 6, 7, 1, 1, 6, 3, 4, 5, 6, 7, 1, 1], name: "Flamenco Epic" }
    ]
  },

  // ========== R&B / SOUL ==========
  rnb: {
    "4": [
      { degrees: [1, 6, 4, 5], name: "R&B Classic" },
      { degrees: [2, 5, 1, 6], name: "Neo Soul" },
      { degrees: [1, 4, 3, 6], name: "Motown" },
      { degrees: [6, 2, 5, 1], name: "Soul Ballad" },
      { degrees: [1, 3, 4, 6], name: "90s R&B" },
      { degrees: [2, 3, 4, 5], name: "Gospel Soul" }
    ],
    "8": [
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5], name: "R&B Standard" },
      { degrees: [2, 5, 1, 6, 2, 5, 3, 6], name: "Neo Soul Journey" },
      { degrees: [1, 4, 3, 6, 2, 5, 1, 1], name: "Classic Motown" },
      { degrees: [1, 3, 4, 6, 1, 5, 4, 5], name: "90s Slow Jam" },
      { degrees: [6, 2, 5, 1, 4, 2, 5, 1], name: "Soul Groove" },
      { degrees: [1, 6, 2, 5, 3, 6, 4, 5], name: "Sophisticated R&B" }
    ],
    "12": [
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Complete R&B" },
      { degrees: [2, 5, 1, 6, 2, 5, 1, 4, 3, 6, 2, 5], name: "Neo Soul Extended" },
      { degrees: [1, 4, 3, 6, 2, 5, 1, 6, 4, 5, 1, 1], name: "Motown Classic" }
    ],
    "16": [
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1, 6, 4, 5, 1], name: "Full R&B Song" },
      { degrees: [2, 5, 1, 6, 2, 5, 3, 6, 4, 7, 3, 6, 2, 5, 1, 1], name: "Neo Soul Epic" }
    ]
  },

  // ========== CLASSICAL / CINEMATIC ==========
  classical: {
    "4": [
      { degrees: [1, 4, 5, 1], name: "Authentic Cadence" },
      { degrees: [1, 5, 6, 3], name: "Romantic" },
      { degrees: [4, 5, 3, 6], name: "Deceptive" },
      { degrees: [1, 4, 1, 5], name: "Plagal Motion" },
      { degrees: [6, 4, 5, 1], name: "Baroque Cadence" },
      { degrees: [2, 5, 1, 4], name: "Mozart Style" }
    ],
    "8": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5], name: "Canon in D Style" },
      { degrees: [1, 4, 5, 1, 4, 5, 6, 3], name: "Classical Period" },
      { degrees: [6, 3, 4, 1, 2, 5, 1, 1], name: "Romantic Period" },
      { degrees: [1, 6, 2, 5, 1, 4, 5, 1], name: "Baroque Standard" },
      { degrees: [1, 4, 1, 5, 6, 4, 5, 1], name: "Sonata Form" },
      { degrees: [4, 5, 6, 3, 4, 5, 1, 1], name: "Chopin Style" }
    ],
    "12": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 4, 5, 1], name: "Full Canon" },
      { degrees: [1, 4, 5, 1, 6, 3, 4, 5, 1, 2, 5, 1], name: "Sonata Extended" },
      { degrees: [6, 3, 4, 1, 6, 3, 2, 5, 1, 4, 5, 1], name: "Romantic Epic" },
      { degrees: [1, 6, 4, 5, 3, 6, 2, 5, 1, 4, 5, 1], name: "Film Score" }
    ],
    "16": [
      { degrees: [1, 5, 6, 3, 4, 1, 4, 5, 1, 5, 6, 3, 4, 1, 5, 1], name: "Full Pachelbel" },
      { degrees: [1, 4, 5, 1, 6, 3, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Classical Epic" },
      { degrees: [6, 3, 4, 1, 6, 5, 4, 5, 1, 6, 4, 5, 1, 4, 5, 1], name: "Cinematic Score" }
    ]
  },

  // ========== FUNK / GROOVE ==========
  funk: {
    "4": [
      { degrees: [1, 4, 1, 4], name: "Basic Funk" },
      { degrees: [1, 7, 4, 4], name: "James Brown" },
      { degrees: [2, 5, 1, 4], name: "Funky Turnaround" },
      { degrees: [1, 4, 5, 4], name: "P-Funk" },
      { degrees: [6, 5, 4, 4], name: "Dark Funk" }
    ],
    "8": [
      { degrees: [1, 4, 1, 4, 5, 4, 1, 4], name: "Classic Funk" },
      { degrees: [1, 7, 4, 4, 1, 7, 4, 5], name: "JB Extended" },
      { degrees: [2, 5, 1, 4, 2, 5, 1, 1], name: "Fusion Funk" },
      { degrees: [1, 4, 5, 4, 1, 4, 5, 5], name: "Disco Funk" },
      { degrees: [1, 1, 4, 4, 1, 5, 4, 1], name: "Groove Standard" }
    ],
    "12": [
      { degrees: [1, 4, 1, 4, 5, 4, 1, 4, 5, 4, 1, 1], name: "Full Funk" },
      { degrees: [1, 7, 4, 4, 1, 7, 4, 5, 1, 4, 5, 1], name: "Parliament Style" },
      { degrees: [2, 5, 1, 4, 2, 5, 1, 6, 2, 5, 1, 1], name: "Jazz Funk" }
    ],
    "16": [
      { degrees: [1, 4, 1, 4, 5, 4, 1, 4, 1, 7, 4, 4, 5, 4, 1, 1], name: "Epic Funk" },
      { degrees: [1, 4, 1, 4, 5, 4, 1, 4, 2, 5, 1, 4, 5, 4, 1, 1], name: "Complete Groove" }
    ]
  },

  // ========== COUNTRY / FOLK ==========
  country: {
    "4": [
      { degrees: [1, 4, 5, 1], name: "Country Basic" },
      { degrees: [1, 4, 1, 5], name: "Nashville" },
      { degrees: [1, 5, 4, 1], name: "Folk" },
      { degrees: [1, 6, 4, 5], name: "Country Ballad" },
      { degrees: [1, 4, 5, 4], name: "Bluegrass" }
    ],
    "8": [
      { degrees: [1, 4, 5, 1, 1, 4, 5, 1], name: "Country Standard" },
      { degrees: [1, 4, 1, 5, 1, 4, 5, 1], name: "Nashville 8" },
      { degrees: [1, 6, 4, 5, 1, 6, 4, 5], name: "Country Ballad 8" },
      { degrees: [1, 5, 4, 1, 1, 5, 4, 5], name: "Folk Journey" },
      { degrees: [1, 4, 5, 4, 1, 4, 5, 1], name: "Bluegrass Standard" }
    ],
    "12": [
      { degrees: [1, 4, 5, 1, 1, 4, 5, 1, 4, 5, 1, 1], name: "Country Song" },
      { degrees: [1, 6, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Country Ballad Full" },
      { degrees: [1, 4, 1, 5, 1, 4, 5, 4, 1, 4, 5, 1], name: "Nashville Complete" }
    ],
    "16": [
      { degrees: [1, 4, 5, 1, 1, 4, 5, 1, 1, 6, 4, 5, 1, 4, 5, 1], name: "Full Country Song" },
      { degrees: [1, 6, 4, 5, 1, 6, 4, 5, 4, 5, 6, 1, 4, 5, 1, 1], name: "Epic Country Ballad" }
    ]
  },

  // ========== GOSPEL / SPIRITUAL ==========
  gospel: {
    "4": [
      { degrees: [1, 4, 1, 5], name: "Gospel Basic" },
      { degrees: [1, 1, 4, 4], name: "Praise" },
      { degrees: [4, 5, 1, 1], name: "Amen Cadence" },
      { degrees: [2, 5, 1, 4], name: "Gospel Turnaround" },
      { degrees: [1, 3, 4, 5], name: "Worship" }
    ],
    "8": [
      { degrees: [1, 4, 1, 5, 1, 4, 5, 1], name: "Gospel Standard" },
      { degrees: [1, 1, 4, 4, 1, 5, 4, 1], name: "Church Groove" },
      { degrees: [2, 5, 1, 4, 2, 5, 1, 1], name: "Gospel Jazz" },
      { degrees: [1, 3, 4, 5, 1, 6, 2, 5], name: "Worship Build" },
      { degrees: [4, 5, 1, 6, 4, 5, 1, 1], name: "Praise Anthem" }
    ],
    "12": [
      { degrees: [1, 4, 1, 5, 1, 4, 5, 1, 4, 5, 1, 1], name: "Full Gospel" },
      { degrees: [1, 3, 4, 5, 1, 6, 2, 5, 1, 4, 5, 1], name: "Worship Song" },
      { degrees: [2, 5, 1, 4, 2, 5, 1, 6, 4, 5, 1, 1], name: "Gospel Praise" }
    ],
    "16": [
      { degrees: [1, 4, 1, 5, 1, 4, 5, 1, 1, 6, 4, 5, 1, 4, 5, 1], name: "Complete Gospel" },
      { degrees: [1, 3, 4, 5, 1, 6, 2, 5, 4, 5, 6, 1, 4, 5, 1, 1], name: "Epic Worship" }
    ]
  },

  // ========== WORLD / ETHNIC ==========
  world: {
    "4": [
      { degrees: [1, 7, 6, 7], name: "Arabic Maqam" },
      { degrees: [1, 5, 4, 1], name: "Celtic" },
      { degrees: [1, 4, 7, 1], name: "Indian Raga" },
      { degrees: [6, 7, 1, 5], name: "Klezmer" },
      { degrees: [1, 3, 4, 5], name: "Chinese Pentatonic" },
      { degrees: [1, 5, 6, 4], name: "Japanese Pop" }
    ],
    "8": [
      { degrees: [1, 7, 6, 7, 1, 7, 6, 1], name: "Arabic Journey" },
      { degrees: [1, 5, 4, 1, 1, 5, 4, 5], name: "Celtic Dance" },
      { degrees: [1, 4, 7, 1, 1, 4, 5, 1], name: "Raga Inspired" },
      { degrees: [6, 7, 1, 5, 6, 7, 1, 1], name: "Eastern European" },
      { degrees: [1, 3, 4, 5, 1, 5, 4, 1], name: "Asian Fusion" },
      { degrees: [1, 5, 6, 4, 1, 5, 6, 5], name: "J-Pop Standard" }
    ],
    "12": [
      { degrees: [1, 7, 6, 7, 1, 4, 5, 1, 7, 6, 7, 1], name: "Arabic Full" },
      { degrees: [1, 5, 4, 1, 1, 5, 4, 5, 1, 4, 5, 1], name: "Celtic Epic" },
      { degrees: [6, 7, 1, 5, 6, 7, 1, 1, 6, 7, 1, 5], name: "Klezmer Dance" }
    ],
    "16": [
      { degrees: [1, 7, 6, 7, 1, 4, 5, 1, 1, 7, 6, 7, 1, 4, 5, 1], name: "Middle Eastern Epic" },
      { degrees: [1, 5, 4, 1, 1, 5, 4, 5, 1, 5, 6, 4, 1, 5, 4, 1], name: "Celtic Journey" },
      { degrees: [1, 5, 6, 4, 1, 5, 6, 3, 4, 1, 4, 5, 1, 5, 6, 1], name: "Anime Epic" }
    ]
  },

  // ========== RANDOM / EXPERIMENTAL ==========
  random: {
    "4": [],
    "8": [],
    "12": [],
    "16": []
  }
};

// === PRESET'LER ===
const PRESETS = {
  pop1: { key: "C", scale: "major", degrees: [1, 5, 6, 4], name: "I-V-vi-IV" },
  jazz1: { key: "C", scale: "major", degrees: [2, 5, 1], name: "ii-V-I", chordType: "sevenths" },
  blues1: { key: "A", scale: "blues", degrees: [1, 1, 1, 1, 4, 4, 1, 1, 5, 4, 1, 5], name: "12-Bar Blues" },
  rock1: { key: "G", scale: "major", degrees: [1, 4, 5], name: "I-IV-V" },
  sad1: { key: "A", scale: "naturalMinor", degrees: [1, 6, 3, 7], name: "Sad Progression" }
};

// === Rƒ∞Tƒ∞M PATTERN'LERƒ∞ ===
const RHYTHM_PATTERNS = {
  pop: {
    name: "Pop 4/4",
    subdivisions: 8,
    bpm: 120,
    // [accent, vel, vel, vel, accent, vel, vel, vel] - 8'lik notalar
    pattern: [1.0, 0.3, 0.7, 0.3, 0.8, 0.3, 0.7, 0.4],
    sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat']
  },
  rock: {
    name: "Rock 4/4",
    subdivisions: 8,
    bpm: 130,
    pattern: [1.0, 0.5, 0.9, 0.5, 0.8, 0.6, 1.0, 0.5],
    sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'kick', 'snare', 'hihat']
  },
  jazz: {
    name: "Jazz Swing",
    subdivisions: 12,
    bpm: 140,
    swing: true,
    pattern: [0.8, 0, 0.4, 0.6, 0, 0.5, 0.7, 0, 0.4, 0.6, 0, 0.6],
    sounds: ['ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'hihat']
  },
  blues: {
    name: "Blues Shuffle",
    subdivisions: 12,
    bpm: 90,
    swing: true,
    pattern: [1.0, 0, 0.4, 0.7, 0, 0.4, 0.6, 0, 0.4, 0.9, 0, 0.5],
    sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat']
  },
  ballad: {
    name: "Ballad 4/4",
    subdivisions: 8,
    bpm: 70,
    pattern: [0.7, 0, 0.5, 0.2, 0.4, 0.2, 0.6, 0],
    sounds: ['kick', null, 'snare', 'hihat', 'kick', 'hihat', 'snare', null]
  },
  edm: {
    name: "EDM Four-on-floor",
    subdivisions: 16,
    bpm: 128,
    pattern: [1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.9, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 1.0, 0.4],
    sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat']
  },
  latin: {
    name: "Latin Clave",
    subdivisions: 8,
    bpm: 100,
    pattern: [1.0, 0, 0.8, 0, 0.7, 0.8, 0, 0.7],
    sounds: ['clave', null, 'clave', null, 'clave', 'clave', null, 'clave']
  },
  rnb: {
    name: "R&B Groove",
    subdivisions: 16,
    bpm: 85,
    pattern: [0.9, 0.2, 0.4, 0.2, 0.7, 0.3, 0.8, 0.2, 0.6, 0.2, 0.4, 0.3, 0.7, 0.2, 0.9, 0.3],
    sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat']
  },
  funk: {
    name: "Funk Groove",
    subdivisions: 16,
    bpm: 110,
    pattern: [1.0, 0.3, 0.6, 0.3, 0.8, 0.4, 0.7, 0.3, 0.5, 0.3, 0.6, 0.4, 0.9, 0.3, 0.7, 0.5],
    sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat']
  },
  classical: {
    name: "Classical 4/4",
    subdivisions: 4,
    bpm: 80,
    pattern: [1.0, 0.5, 0.7, 0.5],
    sounds: ['click', 'click', 'click', 'click']
  },
  country: {
    name: "Country 4/4",
    subdivisions: 8,
    bpm: 115,
    pattern: [1.0, 0.4, 0.8, 0.4, 0.7, 0.4, 0.8, 0.4],
    sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat']
  },
  gospel: {
    name: "Gospel 4/4",
    subdivisions: 8,
    bpm: 95,
    pattern: [1.0, 0.3, 0.7, 0.4, 0.8, 0.3, 0.9, 0.4],
    sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat']
  },
  world: {
    name: "World 4/4",
    subdivisions: 8,
    bpm: 100,
    pattern: [1.0, 0.5, 0.7, 0.3, 0.6, 0.8, 0.4, 0.6],
    sounds: ['kick', 'clave', 'snare', 'clave', 'kick', 'clave', 'snare', 'clave']
  },
  random: {
    name: "Basic 4/4",
    subdivisions: 4,
    bpm: 120,
    pattern: [1.0, 0.5, 0.7, 0.5],
    sounds: ['click', 'click', 'click', 'click']
  }
};

// === √úNL√ú ≈ûARKI K√úT√úPHANESƒ∞ ===
const FAMOUS_SONGS = {
  
  // ========== POP ==========
  pop: [
    // 1950s-1960s
    { name: "Stand By Me - Ben E. King", key: "A", chords: ["A", "F#m", "D", "E"], tempo: 118 },
    { name: "Twist and Shout - The Beatles", key: "D", chords: ["D", "G", "A", "A"], tempo: 125 },
    { name: "La Bamba - Ritchie Valens", key: "C", chords: ["C", "F", "G", "G"], tempo: 142 },
    { name: "I'm a Believer - The Monkees", key: "G", chords: ["G", "C", "G", "D"], tempo: 160 },
    
    // 1970s-1980s
    { name: "Let It Be - The Beatles", key: "C", chords: ["C", "G", "Am", "F", "C", "G", "F", "C"], tempo: 76 },
    { name: "Hotel California - Eagles", key: "Bm", chords: ["Bm", "F#", "A", "E", "G", "D", "Em", "F#"], tempo: 75 },
    { name: "Africa - Toto", key: "A", chords: ["A", "C#m", "F#m", "D", "A", "C#m", "F#m", "E"], tempo: 93 },
    { name: "Take On Me - a-ha", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 169 },
    { name: "Billie Jean - Michael Jackson", key: "F#m", chords: ["F#m", "G#m", "F#m", "G#m"], tempo: 117 },
    { name: "Every Breath You Take - The Police", key: "Ab", chords: ["Ab", "Fm", "Db", "Eb"], tempo: 104 },
    { name: "Sweet Child O' Mine - Guns N' Roses", key: "D", chords: ["D", "C", "G", "D"], tempo: 122 },
    { name: "Livin' on a Prayer - Bon Jovi", key: "Em", chords: ["Em", "C", "D", "Em"], tempo: 123 },
    
    // 1990s
    { name: "Wonderwall - Oasis", key: "F#m", chords: ["Em", "G", "D", "A"], tempo: 87 },
    { name: "Creep - Radiohead", key: "G", chords: ["G", "B", "C", "Cm"], tempo: 92 },
    { name: "Smells Like Teen Spirit - Nirvana", key: "Fm", chords: ["Fm", "Bb", "Ab", "Db"], tempo: 117 },
    { name: "Zombie - The Cranberries", key: "Em", chords: ["Em", "C", "G", "D"], tempo: 83 },
    { name: "I Will Always Love You - Whitney Houston", key: "A", chords: ["A", "F#m", "D", "E"], tempo: 68 },
    { name: "My Heart Will Go On - Celine Dion", key: "E", chords: ["E", "B", "A", "B"], tempo: 100 },
    { name: "Wannabe - Spice Girls", key: "B", chords: ["B", "F#", "G#m", "E"], tempo: 110 },
    { name: "Iris - Goo Goo Dolls", key: "D", chords: ["D", "Em", "G", "Bm", "A"], tempo: 80 },
    
    // 2000s
    { name: "Clocks - Coldplay", key: "Eb", chords: ["Eb", "Bbm", "Fm", "Fm"], tempo: 130 },
    { name: "Mr. Brightside - The Killers", key: "D", chords: ["D", "G", "Bm", "A"], tempo: 148 },
    { name: "Hey Ya! - OutKast", key: "G", chords: ["G", "C", "D", "E"], tempo: 160 },
    { name: "Since U Been Gone - Kelly Clarkson", key: "G", chords: ["G", "Em", "C", "D"], tempo: 132 },
    { name: "Hips Don't Lie - Shakira", key: "Am", chords: ["Am", "Dm", "G", "C"], tempo: 100 },
    { name: "Crazy in Love - Beyonc√©", key: "Dm", chords: ["Dm", "Bb", "Gm", "A"], tempo: 99 },
    { name: "Toxic - Britney Spears", key: "Cm", chords: ["Cm", "Ab", "Bb", "G"], tempo: 143 },
    { name: "Beautiful Day - U2", key: "A", chords: ["A", "Bm", "D", "G", "D", "A"], tempo: 136 },
    { name: "Seven Nation Army - White Stripes", key: "Em", chords: ["Em", "Em", "G", "E"], tempo: 124 },
    { name: "Viva la Vida - Coldplay", key: "Ab", chords: ["Ab", "Eb", "Fm", "Db"], tempo: 138 },
    
    // 2010s
    { name: "Rolling in the Deep - Adele", key: "Cm", chords: ["Cm", "Bb", "Gm", "Ab", "Bb"], tempo: 105 },
    { name: "Someone Like You - Adele", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 68 },
    { name: "Happy - Pharrell Williams", key: "F", chords: ["F", "Fm", "Db", "C"], tempo: 160 },
    { name: "Uptown Funk - Bruno Mars", key: "Dm", chords: ["Dm", "Dm", "G", "G"], tempo: 115 },
    { name: "Shape of You - Ed Sheeran", key: "C#m", chords: ["C#m", "F#m", "A", "B"], tempo: 96 },
    { name: "Despacito - Luis Fonsi", key: "Bm", chords: ["Bm", "G", "D", "A"], tempo: 89 },
    { name: "Thinking Out Loud - Ed Sheeran", key: "D", chords: ["D", "D/F#", "G", "A"], tempo: 79 },
    { name: "All of Me - John Legend", key: "Ab", chords: ["Ab", "Fm", "Db", "Eb"], tempo: 63 },
    { name: "Blank Space - Taylor Swift", key: "F", chords: ["F", "Dm", "Bb", "C"], tempo: 96 },
    { name: "Shake It Off - Taylor Swift", key: "G", chords: ["G", "Am", "C", "D"], tempo: 160 },
    { name: "Havana - Camila Cabello", key: "Gm", chords: ["Gm", "Eb", "D", "Gm"], tempo: 105 },
    { name: "Closer - The Chainsmokers", key: "C", chords: ["C", "D", "Em", "G"], tempo: 95 },
    { name: "Can't Stop the Feeling - Justin Timberlake", key: "C", chords: ["C", "Am", "F", "Am"], tempo: 113 },
    { name: "Shallow - Lady Gaga", key: "G", chords: ["G", "D", "Em", "C"], tempo: 96 },
    
    // 2020s
    { name: "Blinding Lights - The Weeknd", key: "Fm", chords: ["Fm", "Cm", "Ab", "Eb"], tempo: 171 },
    { name: "Watermelon Sugar - Harry Styles", key: "Dm", chords: ["Dm", "Am", "C", "G"], tempo: 95 },
    { name: "Levitating - Dua Lipa", key: "Bm", chords: ["Bm", "F#m", "G", "A"], tempo: 103 },
    { name: "Stay - Kid Laroi & Justin Bieber", key: "C", chords: ["C", "G", "Am", "F"], tempo: 170 },
    { name: "As It Was - Harry Styles", key: "F#m", chords: ["F#m", "D", "E", "A"], tempo: 174 },
    { name: "Anti-Hero - Taylor Swift", key: "E", chords: ["E", "C#m", "B", "A"], tempo: 97 },
    { name: "Flowers - Miley Cyrus", key: "Am", chords: ["Am", "G", "F", "Em"], tempo: 118 },
    { name: "Kill Bill - SZA", key: "Am", chords: ["Am", "Em", "F", "G"], tempo: 89 },
  ],
  
  // ========== ROCK ==========
  rock: [
    // Classic Rock
    { name: "Smoke on the Water - Deep Purple", key: "Gm", chords: ["Gm", "Bb", "C", "Gm"], tempo: 112 },
    { name: "Back in Black - AC/DC", key: "E", chords: ["E", "D", "A", "E"], tempo: 92 },
    { name: "Stairway to Heaven - Led Zeppelin", key: "Am", chords: ["Am", "C", "D", "F", "G", "Am"], tempo: 82 },
    { name: "Bohemian Rhapsody - Queen", key: "Bb", chords: ["Bb", "Gm", "Cm", "F7"], tempo: 72 },
    { name: "We Will Rock You - Queen", key: "E", chords: ["E", "A", "E", "E"], tempo: 81 },
    { name: "We Are the Champions - Queen", key: "Cm", chords: ["Cm", "Bb", "Ab", "Bb", "Cm"], tempo: 65 },
    { name: "Free Bird - Lynyrd Skynyrd", key: "G", chords: ["G", "D", "Em", "F", "C", "D"], tempo: 60 },
    { name: "Highway to Hell - AC/DC", key: "A", chords: ["A", "D", "G", "D", "A"], tempo: 116 },
    { name: "Paranoid - Black Sabbath", key: "E", chords: ["E", "D", "G", "D", "E"], tempo: 164 },
    { name: "Iron Man - Black Sabbath", key: "E", chords: ["E", "G", "F#", "G", "F#", "E"], tempo: 76 },
    { name: "Purple Haze - Jimi Hendrix", key: "E", chords: ["E", "G", "A", "E"], tempo: 109 },
    { name: "Johnny B. Goode - Chuck Berry", key: "Bb", chords: ["Bb", "Eb", "F", "Bb"], tempo: 168 },
    { name: "Born to Be Wild - Steppenwolf", key: "E", chords: ["E", "E", "G", "A"], tempo: 146 },
    
    // 80s-90s Rock
    { name: "Welcome to the Jungle - GNR", key: "E", chords: ["E", "D", "C", "A"], tempo: 124 },
    { name: "Enter Sandman - Metallica", key: "Em", chords: ["Em", "G", "Em", "D"], tempo: 123 },
    { name: "Nothing Else Matters - Metallica", key: "Em", chords: ["Em", "D", "C", "G", "B7"], tempo: 69 },
    { name: "Under the Bridge - Red Hot Chili Peppers", key: "E", chords: ["E", "B", "C#m", "G#m", "A"], tempo: 84 },
    { name: "Californication - Red Hot Chili Peppers", key: "Am", chords: ["Am", "F", "C", "G"], tempo: 96 },
    { name: "Black Hole Sun - Soundgarden", key: "G", chords: ["G", "Bb", "F", "Em"], tempo: 87 },
    { name: "Alive - Pearl Jam", key: "A", chords: ["A", "G", "F", "G"], tempo: 76 },
    { name: "Jeremy - Pearl Jam", key: "A", chords: ["A", "A/G#", "A/G", "A/F#"], tempo: 100 },
    { name: "Basket Case - Green Day", key: "Eb", chords: ["Eb", "Bb", "Cm", "G"], tempo: 171 },
    { name: "American Idiot - Green Day", key: "Ab", chords: ["Ab", "Db", "Eb", "Ab"], tempo: 189 },
    { name: "Boulevard of Broken Dreams - Green Day", key: "Fm", chords: ["Fm", "Ab", "Eb", "Bb"], tempo: 86 },
    
    // 2000s Rock
    { name: "In the End - Linkin Park", key: "C#m", chords: ["C#m", "E", "A", "B"], tempo: 105 },
    { name: "Numb - Linkin Park", key: "F#m", chords: ["F#m", "D", "A", "E"], tempo: 110 },
    { name: "Chop Suey! - System of a Down", key: "Gm", chords: ["Gm", "F", "Eb", "D"], tempo: 128 },
    { name: "The Reason - Hoobastank", key: "E", chords: ["E", "B", "C#m", "A"], tempo: 82 },
    { name: "How You Remind Me - Nickelback", key: "C", chords: ["C", "F", "Bb", "Eb"], tempo: 86 },
    { name: "Bring Me to Life - Evanescence", key: "Em", chords: ["Em", "C", "D", "G"], tempo: 95 },
    { name: "Rockstar - Nickelback", key: "G", chords: ["G", "C", "F", "Am"], tempo: 80 },
    { name: "Use Somebody - Kings of Leon", key: "C", chords: ["C", "Em", "F", "Am"], tempo: 135 },
    
    // Modern Rock
    { name: "Radioactive - Imagine Dragons", key: "Bm", chords: ["Bm", "D", "A", "E"], tempo: 136 },
    { name: "Believer - Imagine Dragons", key: "Am", chords: ["Am", "F", "E", "Am"], tempo: 125 },
    { name: "Thunder - Imagine Dragons", key: "C", chords: ["C", "C", "Am", "F"], tempo: 168 },
    { name: "Stressed Out - Twenty One Pilots", key: "F", chords: ["F", "Am", "C", "Dm"], tempo: 85 },
    { name: "Heathens - Twenty One Pilots", key: "Am", chords: ["Am", "C", "G", "Em"], tempo: 90 },
    { name: "Feel Good Inc - Gorillaz", key: "Em", chords: ["Em", "G", "Am", "Em"], tempo: 139 },
    { name: "Do I Wanna Know? - Arctic Monkeys", key: "Gm", chords: ["Gm", "Bb", "F", "Eb"], tempo: 85 },
    { name: "The Pretender - Foo Fighters", key: "Am", chords: ["Am", "C", "D", "E"], tempo: 173 },
    { name: "Best of You - Foo Fighters", key: "D", chords: ["D", "G", "Bm", "A"], tempo: 129 },
    { name: "Everlong - Foo Fighters", key: "D", chords: ["Dmaj7", "Bsus4", "Gsus2", "Bsus4"], tempo: 79 },
  ],
  
  // ========== JAZZ ==========
  jazz: [
    // Jazz Standards
    { name: "Autumn Leaves", key: "Am", chords: ["Am7", "D7", "Gmaj7", "Cmaj7", "F#m7b5", "B7", "Em", "Em"], tempo: 130 },
    { name: "All of Me - Jazz Standard", key: "C", chords: ["Cmaj7", "E7", "A7", "Dm7", "E7", "Am7", "D7", "G7"], tempo: 130 },
    { name: "Fly Me to the Moon", key: "Am", chords: ["Am7", "Dm7", "G7", "Cmaj7", "F", "Bm7b5", "E7", "Am7"], tempo: 120 },
    { name: "Take Five - Dave Brubeck", key: "Ebm", chords: ["Ebm", "Bbm", "Ebm", "Bbm"], tempo: 174 },
    { name: "So What - Miles Davis", key: "Dm", chords: ["Dm7", "Dm7", "Dm7", "Dm7", "Ebm7", "Ebm7", "Dm7", "Dm7"], tempo: 136 },
    { name: "Blue Bossa - Kenny Dorham", key: "Cm", chords: ["Cm7", "Fm7", "Dm7b5", "G7", "Cm7", "Ebm7", "Ab7", "Dbmaj7"], tempo: 140 },
    { name: "Girl from Ipanema", key: "F", chords: ["Fmaj7", "G7", "Gm7", "Gb7", "Fmaj7", "Gb7", "Fmaj7", "Fmaj7"], tempo: 140 },
    { name: "Summertime - Gershwin", key: "Am", chords: ["Am7", "E7", "Am7", "E7", "Am7", "Dm7", "F", "E7"], tempo: 84 },
    { name: "Misty - Erroll Garner", key: "Eb", chords: ["Ebmaj7", "Bbm7", "Eb7", "Abmaj7", "Abm7", "Db7", "Ebmaj7", "Cm7"], tempo: 68 },
    { name: "My Funny Valentine", key: "Cm", chords: ["Cm", "Cm/B", "Cm/Bb", "A7", "Abmaj7", "Dm7b5", "G7", "Cm"], tempo: 66 },
    { name: "Body and Soul", key: "Db", chords: ["Ebm7", "Bb7", "Ebm7", "Ab7", "Dbmaj7", "Gb7", "Fm7", "E7"], tempo: 72 },
    { name: "In a Sentimental Mood - Duke Ellington", key: "F", chords: ["Dm", "Dm/C#", "Dm/C", "Dm/B", "Gm", "A7", "Dm", "D7"], tempo: 75 },
    { name: "Round Midnight - Thelonious Monk", key: "Ebm", chords: ["Ebm7", "Ab7", "Dbmaj7", "Gbmaj7", "Cm7b5", "F7", "Bbm7", "Eb7"], tempo: 60 },
    { name: "A Night in Tunisia - Dizzy Gillespie", key: "Dm", chords: ["Eb7", "Dm", "Eb7", "Dm", "Em7b5", "A7", "Dm", "Dm"], tempo: 180 },
    { name: "Cantaloupe Island - Herbie Hancock", key: "Fm", chords: ["Fm7", "Fm7", "Db7", "Db7", "Dm7", "Dm7", "Fm7", "Fm7"], tempo: 114 },
    { name: "Watermelon Man - Herbie Hancock", key: "F", chords: ["F7", "F7", "Bb7", "F7", "C7", "Bb7", "F7", "F7"], tempo: 112 },
    { name: "Stella by Starlight", key: "Bb", chords: ["Em7b5", "A7", "Cm7", "F7", "Fm7", "Bb7", "Ebmaj7", "Ab7"], tempo: 152 },
    { name: "Blue in Green - Bill Evans", key: "Dm", chords: ["Bbmaj7", "A7", "Dm7", "Db7", "Cmaj7", "A7", "Dm7", "E7"], tempo: 58 },
    { name: "Giant Steps - John Coltrane", key: "B", chords: ["Bmaj7", "D7", "Gmaj7", "Bb7", "Ebmaj7", "Am7", "D7", "Gmaj7"], tempo: 286 },
    { name: "Satin Doll - Duke Ellington", key: "C", chords: ["Dm7", "G7", "Dm7", "G7", "Em7", "A7", "Em7", "A7"], tempo: 118 },
    { name: "What Is This Thing Called Love", key: "C", chords: ["Gm7", "C7", "Fm", "Fm", "Dm7b5", "G7", "Cm", "Cm"], tempo: 200 },
    { name: "Spain - Chick Corea", key: "Bm", chords: ["Gmaj7", "F#7", "Em7", "A7", "Dmaj7", "Gmaj7", "C#7", "F#7"], tempo: 150 },
  ],
  
  // ========== BLUES ==========
  blues: [
    { name: "The Thrill Is Gone - B.B. King", key: "Bm", chords: ["Bm", "Em", "Bm", "Bm", "Em", "Em", "Bm", "Bm", "F#7", "Em", "Bm", "F#7"], tempo: 88 },
    { name: "Sweet Home Chicago - Robert Johnson", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B7", "A", "E", "B7"], tempo: 130 },
    { name: "Crossroads - Robert Johnson", key: "A", chords: ["A", "A", "A", "A", "D", "D", "A", "A", "E", "D", "A", "E"], tempo: 130 },
    { name: "Red House - Jimi Hendrix", key: "B", chords: ["B", "B", "B", "B", "E", "E", "B", "B", "F#", "E", "B", "F#"], tempo: 66 },
    { name: "Pride and Joy - Stevie Ray Vaughan", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B", "A", "E", "B"], tempo: 126 },
    { name: "Born Under a Bad Sign - Albert King", key: "C#m", chords: ["C#m", "C#m", "C#m", "C#m", "F#m", "F#m", "C#m", "C#m", "G#", "F#m", "C#m", "G#"], tempo: 92 },
    { name: "Stormy Monday - T-Bone Walker", key: "G", chords: ["G7", "C7", "G7", "G7", "C7", "C7", "G7", "G7", "D7", "C7", "G7", "D7"], tempo: 72 },
    { name: "Hoochie Coochie Man - Muddy Waters", key: "A", chords: ["A", "A", "A", "A", "D", "D", "A", "A", "E", "D", "A", "E"], tempo: 70 },
    { name: "I Can't Quit You Baby - Led Zeppelin", key: "A", chords: ["A", "A", "A", "A", "D", "D", "A", "A", "E", "D", "A", "E"], tempo: 52 },
    { name: "Killing Floor - Howlin' Wolf", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B", "A", "E", "B"], tempo: 148 },
    { name: "Boom Boom - John Lee Hooker", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B", "A", "E", "E"], tempo: 140 },
    { name: "Every Day I Have the Blues - B.B. King", key: "Bb", chords: ["Bb", "Bb", "Bb", "Bb", "Eb", "Eb", "Bb", "Bb", "F", "Eb", "Bb", "F"], tempo: 130 },
    { name: "Hide Away - Freddie King", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B", "A", "E", "B"], tempo: 134 },
    { name: "Texas Flood - Stevie Ray Vaughan", key: "G", chords: ["G", "G", "G", "G", "C", "C", "G", "G", "D", "C", "G", "D"], tempo: 60 },
    { name: "Still Got the Blues - Gary Moore", key: "Am", chords: ["Am", "Am", "Dm", "Am", "Am", "E", "Am", "Am"], tempo: 54 },
    { name: "Before You Accuse Me - Eric Clapton", key: "E", chords: ["E", "E", "E", "E", "A", "A", "E", "E", "B", "A", "E", "B"], tempo: 120 },
  ],
  
  // ========== BALLAD ==========
  ballad: [
    { name: "Yesterday - The Beatles", key: "F", chords: ["F", "Em", "A7", "Dm", "Bb", "C", "F", "F"], tempo: 98 },
    { name: "Imagine - John Lennon", key: "C", chords: ["C", "Cmaj7", "F", "F", "C", "Cmaj7", "F", "F"], tempo: 76 },
    { name: "Hallelujah - Leonard Cohen", key: "C", chords: ["C", "Am", "C", "Am", "F", "G", "C", "G"], tempo: 64 },
    { name: "Tears in Heaven - Eric Clapton", key: "A", chords: ["A", "E", "F#m", "A/E", "D", "A", "E", "A"], tempo: 80 },
    { name: "Nothing Compares 2 U - Sin√©ad O'Connor", key: "F", chords: ["F", "C", "Dm", "A", "Bb", "F", "C", "C"], tempo: 60 },
    { name: "Hello - Adele", key: "Fm", chords: ["Fm", "Ab", "Eb", "Db"], tempo: 79 },
    { name: "Fix You - Coldplay", key: "Eb", chords: ["Eb", "Gm", "Cm", "Ab"], tempo: 69 },
    { name: "Say Something - A Great Big World", key: "Bm", chords: ["Bm", "G", "D", "A"], tempo: 69 },
    { name: "Mad World - Gary Jules", key: "Em", chords: ["Em", "A", "Em", "A"], tempo: 88 },
    { name: "The Scientist - Coldplay", key: "Dm", chords: ["Dm", "Bb", "F", "C"], tempo: 75 },
    { name: "Hurt - Johnny Cash", key: "Am", chords: ["Am", "C", "D", "Am"], tempo: 69 },
    { name: "Skinny Love - Bon Iver", key: "Am", chords: ["Am", "C", "C", "Am"], tempo: 75 },
    { name: "When I Was Your Man - Bruno Mars", key: "C", chords: ["C", "G", "Am", "Em", "F", "G", "C", "C"], tempo: 74 },
    { name: "Chasing Cars - Snow Patrol", key: "A", chords: ["A", "E", "D", "A"], tempo: 104 },
    { name: "Yellow - Coldplay", key: "B", chords: ["B", "F#", "E", "B"], tempo: 86 },
    { name: "A Thousand Years - Christina Perri", key: "Bb", chords: ["Bb", "F", "Gm", "Eb"], tempo: 90 },
    { name: "Perfect - Ed Sheeran", key: "G", chords: ["G", "Em", "C", "D"], tempo: 63 },
    { name: "Unchained Melody - Righteous Brothers", key: "C", chords: ["C", "Am", "F", "G", "C", "Am", "G", "G"], tempo: 66 },
    { name: "Angels - Robbie Williams", key: "E", chords: ["E", "A", "C#m", "B"], tempo: 76 },
    { name: "I Don't Want to Miss a Thing - Aerosmith", key: "D", chords: ["D", "A", "Em", "G"], tempo: 62 },
  ],
  
  // ========== EDM ==========
  edm: [
    { name: "Levels - Avicii", key: "Db", chords: ["Db", "Ab", "Eb", "Fm"], tempo: 126 },
    { name: "Titanium - David Guetta ft. Sia", key: "Eb", chords: ["Eb", "Bb", "Cm", "Ab"], tempo: 126 },
    { name: "Wake Me Up - Avicii", key: "Bm", chords: ["Bm", "G", "D", "A"], tempo: 124 },
    { name: "Don't You Worry Child - Swedish House Mafia", key: "G", chords: ["G", "D", "Em", "C"], tempo: 128 },
    { name: "Clarity - Zedd", key: "F#m", chords: ["F#m", "D", "E", "C#"], tempo: 128 },
    { name: "Animals - Martin Garrix", key: "F#m", chords: ["F#m", "D", "A", "E"], tempo: 128 },
    { name: "Lean On - Major Lazer", key: "Gm", chords: ["Gm", "Bb", "F", "Cm"], tempo: 98 },
    { name: "This Is What It Feels Like - Armin van Buuren", key: "Am", chords: ["Am", "F", "C", "G"], tempo: 130 },
    { name: "Faded - Alan Walker", key: "F#m", chords: ["F#m", "D", "A", "E"], tempo: 90 },
    { name: "Alone - Marshmello", key: "Ab", chords: ["Ab", "Eb", "Fm", "Db"], tempo: 120 },
    { name: "Something Just Like This - Chainsmokers", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 103 },
    { name: "The Middle - Zedd", key: "Ab", chords: ["Ab", "Eb", "Fm", "Db"], tempo: 113 },
    { name: "Scared to Be Lonely - Martin Garrix", key: "Ab", chords: ["Ab", "Cm", "Eb", "Bb"], tempo: 108 },
    { name: "Take Me Home - Cash Cash", key: "Ab", chords: ["Ab", "Eb", "Fm", "Db"], tempo: 128 },
    { name: "In the Name of Love - Martin Garrix", key: "Bm", chords: ["Bm", "G", "D", "A"], tempo: 138 },
    { name: "Summer - Calvin Harris", key: "Db", chords: ["Db", "Ab", "Eb", "Fm"], tempo: 128 },
    { name: "Where Are √ú Now - Skrillex & Diplo", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 136 },
    { name: "Reload - Sebastian Ingrosso", key: "E", chords: ["E", "B", "C#m", "A"], tempo: 126 },
    { name: "Under Control - Calvin Harris", key: "E", chords: ["E", "A", "B", "C#m"], tempo: 126 },
    { name: "Sun Is Shining - Axwell Œõ Ingrosso", key: "E", chords: ["E", "A", "C#m", "B"], tempo: 126 },
  ],
  
  // ========== LATIN ==========
  latin: [
    { name: "B√©same Mucho", key: "Dm", chords: ["Dm", "A7", "Dm", "Dm", "Gm", "A7", "Dm", "D7"], tempo: 110 },
    { name: "La Bamba - Ritchie Valens", key: "C", chords: ["C", "F", "G", "G"], tempo: 142 },
    { name: "Oye Como Va - Santana", key: "Am", chords: ["Am", "D", "Am", "D"], tempo: 126 },
    { name: "Smooth - Santana", key: "Am", chords: ["Am", "F", "E", "Am"], tempo: 114 },
    { name: "Maria Maria - Santana", key: "Am", chords: ["Am", "Dm", "E", "Am"], tempo: 96 },
    { name: "Livin' La Vida Loca - Ricky Martin", key: "C#m", chords: ["C#m", "B", "A", "G#"], tempo: 178 },
    { name: "Bailando - Enrique Iglesias", key: "Am", chords: ["Am", "F", "C", "G"], tempo: 124 },
    { name: "Conga - Gloria Estefan", key: "Am", chords: ["Am", "Dm", "E", "Am"], tempo: 126 },
    { name: "Hips Don't Lie - Shakira", key: "Am", chords: ["Am", "Dm", "G", "C"], tempo: 100 },
    { name: "Whenever, Wherever - Shakira", key: "Bm", chords: ["Bm", "G", "A", "F#m"], tempo: 100 },
    { name: "Gasolina - Daddy Yankee", key: "Dm", chords: ["Dm", "Bb", "C", "Am"], tempo: 96 },
    { name: "Danza Kuduro - Don Omar", key: "Am", chords: ["Am", "F", "C", "G"], tempo: 130 },
    { name: "Suavemente - Elvis Crespo", key: "Am", chords: ["Am", "Dm", "E", "Am"], tempo: 180 },
    { name: "Entre Dos Aguas - Paco de Luc√≠a", key: "Am", chords: ["Am", "G", "F", "E"], tempo: 90 },
    { name: "Bamboleo - Gipsy Kings", key: "Am", chords: ["Am", "G", "C", "E"], tempo: 120 },
    { name: "Volare - Gipsy Kings", key: "C", chords: ["C", "Am", "Dm", "G"], tempo: 132 },
    { name: "El Perd√≥n - Nicky Jam & Enrique Iglesias", key: "Am", chords: ["Am", "F", "C", "G"], tempo: 92 },
    { name: "Vivir Mi Vida - Marc Anthony", key: "Gm", chords: ["Gm", "Eb", "Bb", "F"], tempo: 92 },
    { name: "Mi Gente - J Balvin", key: "Am", chords: ["Am", "Am", "Dm", "E"], tempo: 105 },
    { name: "La Camisa Negra - Juanes", key: "Em", chords: ["Em", "Am", "B7", "Em"], tempo: 96 },
  ],
  
  // ========== R&B / SOUL ==========
  rnb: [
    { name: "Let's Stay Together - Al Green", key: "F", chords: ["Fmaj7", "Em7", "Dm7", "Cmaj7"], tempo: 103 },
    { name: "Ain't No Sunshine - Bill Withers", key: "Am", chords: ["Am", "Em", "G", "Am"], tempo: 78 },
    { name: "Lean on Me - Bill Withers", key: "C", chords: ["C", "F", "C", "G", "Am", "Em", "G", "C"], tempo: 78 },
    { name: "What's Going On - Marvin Gaye", key: "E", chords: ["Emaj7", "C#m7", "F#m7", "B7"], tempo: 98 },
    { name: "Sexual Healing - Marvin Gaye", key: "Eb", chords: ["Ebmaj7", "Cm7", "Fm7", "Bb7"], tempo: 94 },
    { name: "I Heard It Through the Grapevine - Marvin Gaye", key: "Dm", chords: ["Dm", "A7", "Dm", "A7"], tempo: 116 },
    { name: "Superstition - Stevie Wonder", key: "Ebm", chords: ["Ebm", "Ebm", "Bb7", "Ebm"], tempo: 101 },
    { name: "Isn't She Lovely - Stevie Wonder", key: "E", chords: ["E", "C#m", "F#m", "B"], tempo: 125 },
    { name: "No Diggity - Blackstreet", key: "Cm", chords: ["Cm", "Bb", "Ab", "G"], tempo: 85 },
    { name: "Waterfalls - TLC", key: "Eb", chords: ["Ebmaj7", "Abmaj7", "Bb", "Cm7"], tempo: 86 },
    { name: "End of the Road - Boyz II Men", key: "Ab", chords: ["Ab", "Fm", "Db", "Eb"], tempo: 60 },
    { name: "I'll Make Love to You - Boyz II Men", key: "D", chords: ["D", "Bm", "G", "A"], tempo: 52 },
    { name: "Kiss from a Rose - Seal", key: "Eb", chords: ["Eb", "Bb", "Cm", "Fm"], tempo: 56 },
    { name: "Ordinary People - John Legend", key: "F", chords: ["Fmaj7", "Em7b5", "A7", "Dm7", "Gm7", "C7"], tempo: 76 },
    { name: "Empire State of Mind - Alicia Keys", key: "F#", chords: ["F#", "D#m", "B", "C#"], tempo: 84 },
    { name: "If I Ain't Got You - Alicia Keys", key: "G", chords: ["Gmaj7", "Cmaj7", "Am7", "D7"], tempo: 64 },
    { name: "Crazy in Love - Beyonc√©", key: "Dm", chords: ["Dm", "Gm", "Bb", "A"], tempo: 99 },
    { name: "Single Ladies - Beyonc√©", key: "E", chords: ["E", "G#m", "A", "E"], tempo: 96 },
    { name: "No Scrubs - TLC", key: "Db", chords: ["Db", "Ab", "Bbm", "Gb"], tempo: 87 },
    { name: "I Wanna Dance with Somebody - Whitney Houston", key: "G", chords: ["G", "D", "Em", "C"], tempo: 119 },
  ],
  
  // ========== CLASSICAL / CINEMATIC ==========
  classical: [
    { name: "Canon in D - Pachelbel", key: "D", chords: ["D", "A", "Bm", "F#m", "G", "D", "G", "A"], tempo: 54 },
    { name: "F√ºr Elise - Beethoven", key: "Am", chords: ["Am", "E", "Am", "E", "Am", "C", "G", "Am"], tempo: 125 },
    { name: "Moonlight Sonata - Beethoven", key: "C#m", chords: ["C#m", "G#7", "C#m", "A", "F#m", "C#m", "G#", "C#m"], tempo: 56 },
    { name: "Clair de Lune - Debussy", key: "Db", chords: ["Dbmaj7", "Bbm7", "Gb", "Ab7"], tempo: 66 },
    { name: "Requiem - Mozart", key: "Dm", chords: ["Dm", "Gm", "A", "Dm", "Bb", "A7", "Dm", "Dm"], tempo: 68 },
    { name: "Ride of the Valkyries - Wagner", key: "B", chords: ["B", "E", "B", "F#", "B", "E", "F#", "B"], tempo: 96 },
    { name: "The Four Seasons: Spring - Vivaldi", key: "E", chords: ["E", "B", "E", "A", "E", "B", "E", "E"], tempo: 76 },
    { name: "Ode to Joy - Beethoven", key: "D", chords: ["D", "A", "D", "G", "D", "A", "D", "D"], tempo: 120 },
    { name: "Toccata and Fugue - Bach", key: "Dm", chords: ["Dm", "A", "Dm", "Gm", "A", "Dm", "A", "Dm"], tempo: 80 },
    { name: "Gymnopedie No.1 - Satie", key: "D", chords: ["Dmaj7", "Gmaj7", "Dmaj7", "Gmaj7"], tempo: 66 },
    // Film Scores
    { name: "Main Theme - Star Wars", key: "Bb", chords: ["Bb", "Eb", "Bb", "F", "Gm", "Eb", "F", "Bb"], tempo: 108 },
    { name: "Main Theme - Harry Potter", key: "Em", chords: ["Em", "G", "D", "Em", "Am", "D", "G", "Em"], tempo: 78 },
    { name: "Main Theme - Jurassic Park", key: "Bb", chords: ["Bb", "Gm", "Eb", "F", "Bb", "Gm", "Eb", "F"], tempo: 84 },
    { name: "The Godfather Theme", key: "Dm", chords: ["Dm", "Gm", "Dm", "A7", "Dm", "Gm", "A7", "Dm"], tempo: 56 },
    { name: "Main Theme - Pirates of the Caribbean", key: "Dm", chords: ["Dm", "Bb", "C", "Dm", "F", "C", "Dm", "Dm"], tempo: 140 },
    { name: "Time - Inception", key: "Am", chords: ["Am", "Em", "G", "D", "Am", "Em", "G", "D"], tempo: 100 },
    { name: "Concerning Hobbits - LOTR", key: "C", chords: ["C", "G", "Am", "F", "C", "G", "F", "C"], tempo: 104 },
    { name: "Main Theme - Schindler's List", key: "Am", chords: ["Am", "Dm", "E", "Am", "F", "Dm", "E", "Am"], tempo: 56 },
    { name: "Hedwig's Theme - Harry Potter", key: "Em", chords: ["Em", "Am", "B7", "Em", "G", "D", "B7", "Em"], tempo: 76 },
    { name: "Main Theme - Game of Thrones", key: "Cm", chords: ["Cm", "Ab", "Eb", "Bb", "Cm", "Ab", "Eb", "Bb"], tempo: 85 },
  ],
  
  // ========== FUNK ==========
  funk: [
    { name: "Superstition - Stevie Wonder", key: "Ebm", chords: ["Ebm", "Ebm", "Bb7", "Ebm"], tempo: 101 },
    { name: "Get Up (I Feel Like Being a) Sex Machine - James Brown", key: "E", chords: ["E", "E", "A", "E"], tempo: 112 },
    { name: "Give Up the Funk - Parliament", key: "E", chords: ["E", "E", "A", "A"], tempo: 108 },
    { name: "Play That Funky Music - Wild Cherry", key: "E", chords: ["E", "E", "A", "B"], tempo: 110 },
    { name: "Brick House - Commodores", key: "Am", chords: ["Am", "Am", "Dm", "Am"], tempo: 106 },
    { name: "Le Freak - Chic", key: "Am", chords: ["Am", "G", "Am", "G"], tempo: 120 },
    { name: "Good Times - Chic", key: "Em", chords: ["Em", "A", "Em", "A"], tempo: 110 },
    { name: "September - Earth, Wind & Fire", key: "Ab", chords: ["Ab", "Cm", "Bbm", "Ab"], tempo: 126 },
    { name: "Let's Groove - Earth, Wind & Fire", key: "Em", chords: ["Em", "A", "Em", "A"], tempo: 123 },
    { name: "Boogie Wonderland - Earth, Wind & Fire", key: "Cm", chords: ["Cm", "Ab", "Bb", "Cm"], tempo: 130 },
    { name: "Sir Duke - Stevie Wonder", key: "B", chords: ["B", "G#m", "E", "F#"], tempo: 108 },
    { name: "Kiss - Prince", key: "A", chords: ["A", "E", "A", "E"], tempo: 112 },
    { name: "1999 - Prince", key: "Dm", chords: ["Dm", "C", "Dm", "C"], tempo: 120 },
    { name: "Forget Me Nots - Patrice Rushen", key: "Em", chords: ["Em7", "Fmaj7", "Em7", "Fmaj7"], tempo: 108 },
    { name: "Chameleon - Herbie Hancock", key: "Bbm", chords: ["Bbm7", "Eb9", "Bbm7", "Eb9"], tempo: 96 },
    { name: "Pick Up the Pieces - Average White Band", key: "F#m", chords: ["F#m7", "B7", "F#m7", "B7"], tempo: 106 },
    { name: "Got to Give It Up - Marvin Gaye", key: "A", chords: ["A", "Bm", "A", "Bm"], tempo: 122 },
    { name: "Jungle Boogie - Kool & the Gang", key: "E", chords: ["E7", "A", "E7", "A"], tempo: 110 },
    { name: "Word Up - Cameo", key: "Em", chords: ["Em", "Am", "Em", "Am"], tempo: 106 },
    { name: "Uptown Funk - Bruno Mars", key: "Dm", chords: ["Dm", "Dm", "G", "G"], tempo: 115 },
  ],
  
  // ========== COUNTRY ==========
  country: [
    { name: "Take Me Home, Country Roads - John Denver", key: "A", chords: ["A", "F#m", "E", "D"], tempo: 82 },
    { name: "Jolene - Dolly Parton", key: "Am", chords: ["Am", "C", "G", "Am"], tempo: 112 },
    { name: "Ring of Fire - Johnny Cash", key: "G", chords: ["G", "C", "G", "D"], tempo: 108 },
    { name: "I Walk the Line - Johnny Cash", key: "A", chords: ["A", "D", "A", "E"], tempo: 106 },
    { name: "Folsom Prison Blues - Johnny Cash", key: "E", chords: ["E", "E", "A", "E", "B7", "E"], tempo: 110 },
    { name: "Friends in Low Places - Garth Brooks", key: "A", chords: ["A", "Bm", "E", "A"], tempo: 84 },
    { name: "The Dance - Garth Brooks", key: "G", chords: ["G", "C", "D", "G"], tempo: 72 },
    { name: "Amazed - Lonestar", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 76 },
    { name: "I Hope You Dance - Lee Ann Womack", key: "G", chords: ["G", "D", "Em", "C"], tempo: 86 },
    { name: "Before He Cheats - Carrie Underwood", key: "F#m", chords: ["F#m", "E", "D", "E"], tempo: 132 },
    { name: "Need You Now - Lady A", key: "A", chords: ["A", "C#m", "E", "F#m", "D"], tempo: 107 },
    { name: "Wagon Wheel - Darius Rucker", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 79 },
    { name: "Cruise - Florida Georgia Line", key: "Bb", chords: ["Bb", "Gm", "F", "Eb"], tempo: 80 },
    { name: "Die a Happy Man - Thomas Rhett", key: "Bb", chords: ["Bb", "Gm", "Eb", "F"], tempo: 78 },
    { name: "Tennessee Whiskey - Chris Stapleton", key: "A", chords: ["A", "Bm", "D", "A"], tempo: 96 },
    { name: "Body Like a Back Road - Sam Hunt", key: "G", chords: ["G", "D", "C", "G"], tempo: 100 },
    { name: "Meant to Be - Bebe Rexha ft. FGL", key: "Ab", chords: ["Ab", "Eb", "Fm", "Db"], tempo: 81 },
    { name: "Speechless - Dan + Shay", key: "D", chords: ["D", "A", "Bm", "G"], tempo: 78 },
    { name: "Tequila - Dan + Shay", key: "G", chords: ["G", "D", "Em", "C"], tempo: 98 },
    { name: "Old Town Road - Lil Nas X", key: "G", chords: ["G", "Em", "C", "D"], tempo: 136 },
  ],
  
  // ========== GOSPEL ==========
  gospel: [
    { name: "Amazing Grace", key: "G", chords: ["G", "G", "C", "G", "G", "D", "G", "G"], tempo: 72 },
    { name: "Oh Happy Day", key: "F", chords: ["F", "Bb", "F", "C", "F", "Bb", "C", "F"], tempo: 108 },
    { name: "How Great Is Our God - Chris Tomlin", key: "G", chords: ["G", "Em", "C", "D"], tempo: 80 },
    { name: "Shout to the Lord", key: "Bb", chords: ["Bb", "Eb", "F", "Gm", "Eb", "F", "Bb", "Bb"], tempo: 72 },
    { name: "10,000 Reasons - Matt Redman", key: "G", chords: ["G", "D", "Em", "C"], tempo: 73 },
    { name: "Oceans - Hillsong United", key: "D", chords: ["D", "A", "Bm", "G"], tempo: 66 },
    { name: "What a Beautiful Name - Hillsong", key: "D", chords: ["D", "G", "Bm", "A"], tempo: 68 },
    { name: "Way Maker", key: "E", chords: ["E", "B", "C#m", "A"], tempo: 68 },
    { name: "Reckless Love - Cory Asbury", key: "C", chords: ["C", "G", "Am", "F"], tempo: 86 },
    { name: "Good Good Father - Chris Tomlin", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 68 },
    { name: "In Christ Alone", key: "D", chords: ["D", "A", "G", "D"], tempo: 68 },
    { name: "Blessed Assurance", key: "D", chords: ["D", "G", "D", "A", "D", "G", "A", "D"], tempo: 84 },
    { name: "Great Is Thy Faithfulness", key: "D", chords: ["D", "G", "D", "A", "D", "G", "Em", "A"], tempo: 76 },
    { name: "Holy Spirit - Francesca Battistelli", key: "D", chords: ["D", "A", "Em", "G"], tempo: 72 },
    { name: "I Can Only Imagine - MercyMe", key: "E", chords: ["E", "B", "C#m", "A"], tempo: 80 },
    { name: "Revelation Song", key: "D", chords: ["D", "Am", "C", "G"], tempo: 66 },
    { name: "Lord I Need You - Matt Maher", key: "G", chords: ["G", "D", "Em", "C"], tempo: 74 },
    { name: "Build My Life", key: "G", chords: ["G", "D", "Em", "C"], tempo: 68 },
    { name: "Cornerstone - Hillsong", key: "C", chords: ["C", "F", "Am", "G"], tempo: 68 },
    { name: "O Come to the Altar - Elevation", key: "A", chords: ["A", "E", "F#m", "D"], tempo: 72 },
  ],
  
  // ========== WORLD ==========
  world: [
    { name: "Waka Waka - Shakira", key: "G", chords: ["G", "D", "Em", "C"], tempo: 127 },
    { name: "Ai Se Eu Te Pego - Michel Tel√≥", key: "G", chords: ["G", "C", "D", "G"], tempo: 102 },
    { name: "Dragostea Din Tei - O-Zone", key: "Am", chords: ["Am", "Dm", "E", "Am"], tempo: 135 },
    { name: "Macarena - Los del R√≠o", key: "Bb", chords: ["Bb", "F", "Bb", "F"], tempo: 103 },
    { name: "Lambada", key: "Am", chords: ["Am", "G", "F", "E"], tempo: 135 },
    { name: "Mas Que Nada - Sergio Mendes", key: "Am", chords: ["Am", "D", "Am", "E"], tempo: 105 },
    { name: "Guantanamera", key: "D", chords: ["D", "G", "A", "D"], tempo: 90 },
    { name: "Chan Chan - Buena Vista Social Club", key: "E", chords: ["E", "A", "B", "E"], tempo: 82 },
    { name: "Tequila Sunrise - Eagles", key: "G", chords: ["G", "D", "Am", "D"], tempo: 102 },
    { name: "La Vie en Rose - √âdith Piaf", key: "C", chords: ["C", "Dm", "G", "C"], tempo: 68 },
    { name: "Bella Ciao", key: "Am", chords: ["Am", "Dm", "E", "Am"], tempo: 116 },
    { name: "O Sole Mio", key: "G", chords: ["G", "D", "C", "G"], tempo: 72 },
    { name: "Hava Nagila", key: "Am", chords: ["Am", "E", "Dm", "Am"], tempo: 160 },
    { name: "Kalinka", key: "Am", chords: ["Am", "E", "Am", "E"], tempo: 120 },
    { name: "Sukiyaki - Kyu Sakamoto", key: "G", chords: ["G", "C", "D", "G"], tempo: 77 },
    { name: "Gangnam Style - PSY", key: "B", chords: ["B", "F#", "G#m", "E"], tempo: 132 },
    { name: "Ievan Polkka", key: "Am", chords: ["Am", "G", "F", "E"], tempo: 132 },
    { name: "Korobeiniki (Tetris Theme)", key: "Am", chords: ["Am", "E", "F", "C", "Dm", "Am", "E", "Am"], tempo: 140 },
    { name: "Misirlou - Dick Dale", key: "E", chords: ["E", "F", "E", "F"], tempo: 180 },
    { name: "Zorba the Greek", key: "Am", chords: ["Am", "G", "Am", "E"], tempo: 140 },
  ]
};

// ≈ûu anda se√ßili ≈üarkƒ±
let currentSong = null;
let currentStyle = "pop";

// === GLOBAL DURUM ===
let audioCtx = null;
let masterGain = null;
let compressor = null;
let convolver = null;
let dryGain = null;
let wetGain = null;

let pianoSamples = {};
let samplesLoaded = false;
let audioInitialized = false;

let currentChords = [];
let currentChordIndex = -1;
let isPlaying = false;
let isLooping = false;
let tempo = 120;
let metronomeOn = false;
let currentArticulation = "normal";
let currentMode = "create";
let volume = 0.7;
let reverbEnabled = true;
let currentOctave = 4;
let playbackInterval = null;
let metronomeInterval = null;
let currentBeat = 0;
let beatsPerMeasure = 4;
let currentSubdivision = 0;

// Yeni √∂zellikler
let arpeggiatorEnabled = false;
let bassLineEnabled = false;

// Quiz ve Training
let quizCorrectAnswer = null;
let quizStats = { correct: 0, total: 0 };
let noteFinderActive = false;
let noteFinderMode = "learn";
let noteFinderTarget = { note: null, octave: null };
let noteFinderStats = { correct: 0, wrong: 0, streak: 0 };
let chordRecogTarget = { root: null, type: null, fullName: null };
let chordRecogSelected = { root: null, type: null };
let chordRecogStats = { correct: 0, total: 0 };

// === PROFESYONEl SOUNDFONT SES MOTORU ===
// Ger√ßek enstr√ºman samples (nbrosowsky/tonejs-instruments repo'sundan)

// Base URL - nbrosowsky GitHub Pages
const SAMPLE_BASE_URL = "https://nbrosowsky.github.io/tonejs-instruments/samples/";

// Enstr√ºman tanƒ±mlarƒ±
const INSTRUMENTS = {
  piano: { 
    name: "Akustik Piano", 
    program: 0, 
    category: "piano",
    fallbackType: "piano",
    tonejsUrl: SAMPLE_BASE_URL + "piano/" // Ger√ßek piano
  },
  epiano: { 
    name: "Electric Piano", 
    program: 4,
    category: "piano",
    fallbackType: "epiano",
    tonejsUrl: null // Soundfont kullan
  },
  organ: { 
    name: "Church Organ", 
    program: 19, 
    category: "organ",
    fallbackType: "organ",
    tonejsUrl: SAMPLE_BASE_URL + "organ/" // Ger√ßek organ
  },
  synth: { 
    name: "Synth Pad", 
    program: 89,
    category: "synth",
    fallbackType: "synth",
    tonejsUrl: SAMPLE_BASE_URL + "harmonium/" // Harmonium as synth alternative
  },
  guitar: { 
    name: "Akustik Gitar (Steel)", 
    program: 25,
    category: "guitar",
    fallbackType: "guitar",
    tonejsUrl: SAMPLE_BASE_URL + "guitar-acoustic/" // Ger√ßek akustik gitar!
  },
  nylonGuitar: { 
    name: "Klasik Gitar (Nylon)", 
    program: 24,
    category: "guitar",
    fallbackType: "guitar",
    tonejsUrl: SAMPLE_BASE_URL + "guitar-nylon/" // Ger√ßek klasik gitar!
  },
  electricGuitar: { 
    name: "Elektro Gitar", 
    program: 27,
    category: "guitar",
    fallbackType: "guitar",
    tonejsUrl: SAMPLE_BASE_URL + "guitar-electric/" // Ger√ßek elektro gitar!
  },
  strings: { 
    name: "Violin", 
    program: 40, 
    category: "strings",
    fallbackType: "strings",
    tonejsUrl: SAMPLE_BASE_URL + "violin/" // Ger√ßek violin
  },
  bass: {
    name: "Electric Bass",
    program: 33,
    category: "bass",
    fallbackType: "bass",
    tonejsUrl: SAMPLE_BASE_URL + "bass-electric/" // Ger√ßek bas gitar
  },
  cello: {
    name: "Cello",
    program: 42,
    category: "strings",
    fallbackType: "strings",
    tonejsUrl: SAMPLE_BASE_URL + "cello/" // Ger√ßek √ßello
  },
  trumpet: {
    name: "Trumpet",
    program: 56,
    category: "brass",
    fallbackType: "synth",
    tonejsUrl: SAMPLE_BASE_URL + "trumpet/" // Ger√ßek trompet
  },
  saxophone: {
    name: "Saxophone",
    program: 65,
    category: "woodwind",
    fallbackType: "synth",
    tonejsUrl: SAMPLE_BASE_URL + "saxophone/" // Ger√ßek saksofon
  },
  flute: {
    name: "Flute",
    program: 73,
    category: "woodwind",
    fallbackType: "synth",
    tonejsUrl: SAMPLE_BASE_URL + "flute/" // Ger√ßek fl√ºt
  },
  harp: {
    name: "Harp",
    program: 46,
    category: "strings",
    fallbackType: "piano",
    tonejsUrl: SAMPLE_BASE_URL + "harp/" // Ger√ßek harp
  }
};

// Mevcut enstr√ºman
let currentInstrument = "piano";
let instrumentSamples = {};
let loadingInstrument = false;

// Soundfont CDN URL'leri (Gleitz Soundfonts - y√ºksek kalite)
const SOUNDFONT_BASE_URL = "https://gleitz.github.io/midi-js-soundfonts/MusyngKite/";

// Nota isimleri (Soundfont formatƒ±)
const SF_NOTE_NAMES = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];

async function initAudio() {
  if (audioInitialized) return;
  
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    if (audioCtx.state === "suspended") {
      await audioCtx.resume();
    }
    
    // Dynamics Compressor
    compressor = audioCtx.createDynamicsCompressor();
    compressor.threshold.value = -20;
    compressor.knee.value = 20;
    compressor.ratio.value = 4;
    compressor.attack.value = 0.003;
    compressor.release.value = 0.15;
    
    // Master Gain
    masterGain = audioCtx.createGain();
    masterGain.gain.value = volume;
    
    // Dry/Wet for Reverb
    dryGain = audioCtx.createGain();
    dryGain.gain.value = 0.65;
    
    wetGain = audioCtx.createGain();
    wetGain.gain.value = reverbEnabled ? 0.35 : 0;
    
    // Create Convolution Reverb
    createConvolutionReverb();
    
    // Signal Chain
    masterGain.connect(compressor);
    compressor.connect(dryGain);
    dryGain.connect(audioCtx.destination);
    
    compressor.connect(convolver);
    convolver.connect(wetGain);
    wetGain.connect(audioCtx.destination);
    
    // √ñnce synthesized samples olu≈ütur (hƒ±zlƒ± ba≈ülangƒ±√ß)
    generatePianoSamples();
    
    audioInitialized = true;
    console.log("Audio initialized!");
    
    // Arka planda ger√ßek soundfont'u y√ºkle
    loadSoundfontInstrument(currentInstrument);
    
  } catch (err) {
    console.error("Audio init error:", err);
    const overlay = document.getElementById("loadingOverlay");
    if (overlay) overlay.style.display = "none";
  }
}

// Soundfont enstr√ºman y√ºkleme
async function loadSoundfontInstrument(instrumentId) {
  if (loadingInstrument) return;
  if (instrumentSamples[instrumentId]) {
    console.log(`${instrumentId} zaten y√ºkl√º`);
    return;
  }
  
  const instrument = INSTRUMENTS[instrumentId];
  if (!instrument) return;
  
  loadingInstrument = true;
  showLoadingStatus(`${instrument.name} y√ºkleniyor...`);
  
  try {
    // √ñnce Tonejs URL'i dene (daha kaliteli)
    if (instrument.tonejsUrl) {
      console.log(`Loading from Tonejs: ${instrument.tonejsUrl}`);
      const samples = await loadTonejsSamples(instrument.tonejsUrl, instrumentId);
      
      if (samples && Object.keys(samples).length > 0) {
        instrumentSamples[instrumentId] = samples;
        console.log(`${instrument.name} loaded from Tonejs: ${Object.keys(samples).length} samples`);
        showLoadingStatus(`${instrument.name} y√ºklendi! ‚úì`);
        setTimeout(hideLoadingStatus, 1000);
        loadingInstrument = false;
        return;
      }
    }
    
    // Tonejs yoksa veya ba≈üarƒ±sƒ±zsa Soundfont dene
    const programName = getGMProgramName(instrument.program);
    const url = `https://gleitz.github.io/midi-js-soundfonts/FluidR3_GM/${programName}-mp3.js`;
    
    console.log(`Loading soundfont: ${url}`);
    
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const jsContent = await response.text();
    const samples = await parseSoundfontData(jsContent, programName);
    
    if (samples && Object.keys(samples).length > 0) {
      instrumentSamples[instrumentId] = samples;
      console.log(`${instrument.name} loaded: ${Object.keys(samples).length} samples`);
      showLoadingStatus(`${instrument.name} y√ºklendi! ‚úì`);
      setTimeout(hideLoadingStatus, 1000);
    } else {
      throw new Error("No samples parsed");
    }
    
  } catch (err) {
    console.warn(`Soundfont y√ºklenemedi (${instrumentId}):`, err.message);
    // Fallback: Synthesized samples olu≈ütur
    console.log(`Generating synth samples for ${instrumentId}...`);
    generateSynthSamplesForInstrument(instrumentId);
    showLoadingStatus(`${INSTRUMENTS[instrumentId].name} (synth) hazƒ±r`);
    setTimeout(hideLoadingStatus, 1000);
  }
  
  loadingInstrument = false;
}

// Tonejs sample'larƒ±nƒ± y√ºkle (nbrosowsky GitHub Pages'den)
async function loadTonejsSamples(baseUrl, instrumentId) {
  const samples = {};
  
  // nbrosowsky/tonejs-instruments repo'sundan sample'lar
  // Format: https://nbrosowsky.github.io/tonejs-instruments/samples/{instrument}/{note}.mp3
  
  // Enstr√ºmana g√∂re nota listesi (her enstr√ºmanƒ±n sample'larƒ± farklƒ±)
  let availableNotes;
  
  if (baseUrl.includes("salamander") || baseUrl.includes("piano")) {
    // Piano: geni≈ü aralƒ±k
    availableNotes = [
      "A0", "C1", "D#1", "F#1", "A1", "C2", "D#2", "F#2", 
      "A2", "C3", "D#3", "F#3", "A3", "C4", "D#4", "F#4", 
      "A4", "C5", "D#5", "F#5", "A5", "C6", "D#6", "F#6",
      "A6", "C7", "D#7", "F#7", "A7", "C8"
    ];
  } else if (baseUrl.includes("guitar")) {
    // Gitar: E2 - E5 arasƒ± (standart gitar aralƒ±ƒüƒ±)
    availableNotes = [
      "A2", "A3", "A4",
      "C3", "C4", "C5",
      "D#3", "D#4", "D#5",
      "E2", "E3", "E4",
      "F#2", "F#3", "F#4"
    ];
  } else if (baseUrl.includes("bass")) {
    // Bass: d√º≈ü√ºk oktavlar
    availableNotes = [
      "A#1", "A#2",
      "C#1", "C#2", "C#3",
      "E1", "E2",
      "G1", "G2"
    ];
  } else if (baseUrl.includes("cello")) {
    // Cello
    availableNotes = [
      "A2", "A3", "A4",
      "C2", "C3", "C4",
      "D#2", "D#3", "D#4",
      "F#2", "F#3", "F#4"
    ];
  } else {
    // Genel
    availableNotes = [
      "A2", "A3", "A4", "A5",
      "C3", "C4", "C5",
      "D#3", "D#4", "D#5",
      "F#3", "F#4", "F#5"
    ];
  }
  
  let loadedCount = 0;
  const totalNotes = availableNotes.length;
  
  // Paralel y√ºkleme i√ßin Promise'ler
  const loadPromises = availableNotes.map(async (noteName) => {
    try {
      // Nota adƒ±nƒ± dosya formatƒ±na √ßevir (D# -> Ds, F# -> Fs)
      const fileName = noteName.replace("#", "s");
      const url = `${baseUrl}${fileName}.mp3`;
      
      const response = await fetch(url);
      if (!response.ok) return null;
      
      const arrayBuffer = await response.arrayBuffer();
      const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
      
      loadedCount++;
      showLoadingStatus(`${INSTRUMENTS[instrumentId].name}: ${loadedCount}/${totalNotes}`);
      
      return { noteName, audioBuffer };
      
    } catch (e) {
      return null;
    }
  });
  
  // T√ºm y√ºklemeleri bekle
  const results = await Promise.all(loadPromises);
  
  // Ba≈üarƒ±lƒ± olanlarƒ± kaydet
  results.forEach(result => {
    if (result) {
      samples[result.noteName] = result.audioBuffer;
    }
  });
  
  // En az 3 nota y√ºklendiyse ba≈üarƒ±lƒ± say
  if (Object.keys(samples).length >= 3) {
    // Eksik notalarƒ± mevcut notalardan interpolasyon ile doldur
    fillMissingSamples(samples);
  }
  
  return samples;
}

// Eksik notalarƒ± en yakƒ±n mevcut notadan doldur
function fillMissingSamples(samples) {
  const allNotes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const octaves = [2, 3, 4, 5];
  
  for (const octave of octaves) {
    for (const note of allNotes) {
      const key = `${note}${octave}`;
      if (!samples[key]) {
        // En yakƒ±n mevcut notayƒ± bul
        const nearest = findNearestSample(samples, note, octave);
        if (nearest) {
          samples[key] = nearest;
        }
      }
    }
  }
}

// En yakƒ±n mevcut sample'ƒ± bul
function findNearestSample(samples, targetNote, targetOctave) {
  const allNotes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const targetMidi = allNotes.indexOf(targetNote) + targetOctave * 12;
  
  let nearestSample = null;
  let nearestDistance = Infinity;
  
  for (const [key, buffer] of Object.entries(samples)) {
    const match = key.match(/^([A-G]#?)(\d)$/);
    if (!match) continue;
    
    const sampleNote = match[1];
    const sampleOctave = parseInt(match[2]);
    const sampleMidi = allNotes.indexOf(sampleNote) + sampleOctave * 12;
    
    const distance = Math.abs(sampleMidi - targetMidi);
    if (distance < nearestDistance) {
      nearestDistance = distance;
      nearestSample = buffer;
    }
  }
  
  return nearestSample;
}

// Belirli bir enstr√ºman i√ßin synthesized samples olu≈ütur
function generateSynthSamplesForInstrument(instrumentId) {
  const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const octaves = [2, 3, 4, 5, 6];
  const instrument = INSTRUMENTS[instrumentId];
  const type = instrument?.fallbackType || "piano";
  
  instrumentSamples[instrumentId] = {};
  
  octaves.forEach(octave => {
    notes.forEach(note => {
      const key = `${note}${octave}`;
      instrumentSamples[instrumentId][key] = createSynthSample(note, octave, type);
    });
  });
  
  console.log(`Synth samples generated for ${instrumentId}`);
}

// GM Program numarasƒ±ndan isim
function getGMProgramName(program) {
  const gmNames = [
    "acoustic_grand_piano", "bright_acoustic_piano", "electric_grand_piano", "honkytonk_piano",
    "electric_piano_1", "electric_piano_2", "harpsichord", "clavinet",
    "celesta", "glockenspiel", "music_box", "vibraphone",
    "marimba", "xylophone", "tubular_bells", "dulcimer",
    "drawbar_organ", "percussive_organ", "rock_organ", "church_organ",
    "reed_organ", "accordion", "harmonica", "tango_accordion",
    "acoustic_guitar_nylon", "acoustic_guitar_steel", "electric_guitar_jazz", "electric_guitar_clean",
    "electric_guitar_muted", "overdriven_guitar", "distortion_guitar", "guitar_harmonics",
    "acoustic_bass", "electric_bass_finger", "electric_bass_pick", "fretless_bass",
    "slap_bass_1", "slap_bass_2", "synth_bass_1", "synth_bass_2",
    "violin", "viola", "cello", "contrabass",
    "tremolo_strings", "pizzicato_strings", "orchestral_harp", "timpani",
    "string_ensemble_1", "string_ensemble_2", "synth_strings_1", "synth_strings_2",
    "choir_aahs", "voice_oohs", "synth_choir", "orchestra_hit",
    "trumpet", "trombone", "tuba", "muted_trumpet",
    "french_horn", "brass_section", "synth_brass_1", "synth_brass_2",
    "soprano_sax", "alto_sax", "tenor_sax", "baritone_sax",
    "oboe", "english_horn", "bassoon", "clarinet",
    "piccolo", "flute", "recorder", "pan_flute",
    "blown_bottle", "shakuhachi", "whistle", "ocarina",
    "lead_1_square", "lead_2_sawtooth", "lead_3_calliope", "lead_4_chiff",
    "lead_5_charang", "lead_6_voice", "lead_7_fifths", "lead_8_bass_lead",
    "pad_1_new_age", "pad_2_warm", "pad_3_polysynth", "pad_4_choir",
    "pad_5_bowed", "pad_6_metallic", "pad_7_halo", "pad_8_sweep"
  ];
  return gmNames[program] || "acoustic_grand_piano";
}

// Soundfont JS verisi parse et
async function parseSoundfontData(jsContent, programName) {
  const samples = {};
  
  try {
    // MIDI.Soundfont.instrument_name = {...} formatƒ±nƒ± parse et
    const dataMatch = jsContent.match(/MIDI\.Soundfont\.[\w_]+\s*=\s*(\{[\s\S]*\})/);
    if (!dataMatch) {
      console.warn("Soundfont data format not recognized");
      return samples;
    }
    
    // JSON olarak parse et
    const dataStr = dataMatch[1]
      .replace(/'/g, '"')
      .replace(/(\w+):/g, '"$1":');
    
    const soundfontData = JSON.parse(dataStr);
    
    // Her nota i√ßin audio buffer olu≈ütur
    const notePromises = Object.entries(soundfontData).map(async ([noteName, dataUrl]) => {
      try {
        // data:audio/mp3;base64,... formatƒ±ndan base64'√º √ßƒ±kar
        const base64Data = dataUrl.split(',')[1];
        if (!base64Data) return;
        
        // Base64'√º ArrayBuffer'a √ßevir
        const binaryString = atob(base64Data);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        
        // Audio buffer'a decode et
        const audioBuffer = await audioCtx.decodeAudioData(bytes.buffer.slice(0));
        
        // Nota adƒ±nƒ± standart formata √ßevir (Ab4 -> G#4)
        const standardNote = convertNoteNameToStandard(noteName);
        samples[standardNote] = audioBuffer;
        
      } catch (e) {
        // Sessizce ge√ß
      }
    });
    
    // T√ºm notalarƒ± bekle (maksimum 3 saniye)
    await Promise.race([
      Promise.all(notePromises),
      new Promise(resolve => setTimeout(resolve, 3000))
    ]);
    
  } catch (err) {
    console.warn("Soundfont parse error:", err);
  }
  
  return samples;
}

// Nota adƒ±nƒ± standart formata √ßevir
function convertNoteNameToStandard(sfNote) {
  // Ab4 -> G#4, Bb3 -> A#3, Db5 -> C#5 vb.
  const conversions = {
    'Db': 'C#', 'Eb': 'D#', 'Gb': 'F#', 'Ab': 'G#', 'Bb': 'A#'
  };
  
  for (const [from, to] of Object.entries(conversions)) {
    if (sfNote.startsWith(from)) {
      return sfNote.replace(from, to);
    }
  }
  return sfNote;
}

// Loading status g√∂ster
function showLoadingStatus(message) {
  let status = document.getElementById("instrumentLoadingStatus");
  if (!status) {
    status = document.createElement("div");
    status.id = "instrumentLoadingStatus";
    status.style.cssText = `
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(139, 92, 246, 0.9);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 0.85rem;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 10px;
    `;
    document.body.appendChild(status);
  }
  status.innerHTML = `<span class="loading-spinner"></span> ${message}`;
  status.style.display = "flex";
}

function hideLoadingStatus() {
  const status = document.getElementById("instrumentLoadingStatus");
  if (status) {
    status.style.display = "none";
  }
}

// Enstr√ºman deƒüi≈ütir
async function changeInstrument(instrumentId) {
  if (!INSTRUMENTS[instrumentId]) return;
  
  currentInstrument = instrumentId;
  console.log(`Switching to: ${INSTRUMENTS[instrumentId].name}`);
  
  // Eƒüer soundfont y√ºkl√º deƒüilse y√ºkle
  if (!instrumentSamples[instrumentId]) {
    await loadSoundfontInstrument(instrumentId);
  }
}

// Konser salonu reverb impulse response
function createConvolutionReverb() {
  convolver = audioCtx.createConvolver();
  
  const sampleRate = audioCtx.sampleRate;
  const length = sampleRate * 2.8;
  const impulse = audioCtx.createBuffer(2, length, sampleRate);
  
  for (let channel = 0; channel < 2; channel++) {
    const data = impulse.getChannelData(channel);
    for (let i = 0; i < length; i++) {
      const decay = Math.pow(1 - i / length, 2);
      const earlyReflections = i < sampleRate * 0.1 ? 
        Math.sin(i * 0.015) * Math.exp(-20 * i / sampleRate) * 0.4 : 0;
      const diffuse = (Math.random() * 2 - 1) * decay;
      const stereoOffset = channel === 0 ? 0.02 : -0.02;
      data[i] = (earlyReflections + diffuse * 0.6) * (1 + stereoOffset);
    }
  }
  
  convolver.buffer = impulse;
}

// Fallback: Synthesized samples (hƒ±zlƒ± ba≈ülangƒ±√ß i√ßin)
function generatePianoSamples() {
  const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const octaves = [2, 3, 4, 5, 6];
  
  octaves.forEach(octave => {
    notes.forEach(note => {
      const key = `${note}${octave}`;
      pianoSamples[key] = createSynthSample(note, octave, "piano");
    });
  });
  
  samplesLoaded = true;
  const overlay = document.getElementById("loadingOverlay");
  if (overlay) overlay.style.display = "none";
}

// Enstr√ºmana g√∂re synthesized sample olu≈ütur
function createSynthSample(note, octave, type) {
  const sampleRate = audioCtx.sampleRate;
  const duration = type === "organ" ? 6.0 : (type === "strings" ? 5.0 : 4.0);
  const length = sampleRate * duration;
  const buffer = audioCtx.createBuffer(2, length, sampleRate);
  
  const midiNote = NOTE_TO_MIDI[note] + (octave + 1) * 12;
  const frequency = 440 * Math.pow(2, (midiNote - 69) / 12);
  
  // Enstr√ºmana g√∂re harmonik yapƒ±
  let harmonics;
  switch (type) {
    case "epiano":
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 0.8 },
        { ratio: 2.0, amp: 0.6, decay: 0.6 },
        { ratio: 3.0, amp: 0.3, decay: 0.5 },
        { ratio: 4.0, amp: 0.2, decay: 0.4 },
        { ratio: 7.0, amp: 0.1, decay: 0.3 } // Bell-like
      ];
      break;
    case "organ":
      harmonics = [
        { ratio: 0.5, amp: 0.5, decay: 1.0 },
        { ratio: 1.0, amp: 1.0, decay: 1.0 },
        { ratio: 2.0, amp: 0.8, decay: 1.0 },
        { ratio: 3.0, amp: 0.6, decay: 1.0 },
        { ratio: 4.0, amp: 0.4, decay: 1.0 },
        { ratio: 6.0, amp: 0.2, decay: 1.0 },
        { ratio: 8.0, amp: 0.1, decay: 1.0 }
      ];
      break;
    case "synth":
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 0.95 },
        { ratio: 2.0, amp: 0.5, decay: 0.9 },
        { ratio: 3.0, amp: 0.25, decay: 0.85 }
      ];
      break;
    case "guitar":
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 0.5 },
        { ratio: 2.0, amp: 0.5, decay: 0.4 },
        { ratio: 3.0, amp: 0.35, decay: 0.35 },
        { ratio: 4.0, amp: 0.25, decay: 0.3 },
        { ratio: 5.0, amp: 0.15, decay: 0.25 }
      ];
      break;
    case "strings":
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 0.9 },
        { ratio: 2.0, amp: 0.7, decay: 0.85 },
        { ratio: 3.0, amp: 0.5, decay: 0.8 },
        { ratio: 4.0, amp: 0.3, decay: 0.75 },
        { ratio: 5.0, amp: 0.15, decay: 0.7 }
      ];
      break;
    case "bass":
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 0.6 },
        { ratio: 2.0, amp: 0.4, decay: 0.5 },
        { ratio: 3.0, amp: 0.2, decay: 0.4 }
      ];
      break;
    default: // piano
      harmonics = [
        { ratio: 1.0, amp: 1.0, decay: 1.0 },
        { ratio: 2.0, amp: 0.45, decay: 0.85 },
        { ratio: 3.0, amp: 0.28, decay: 0.72 },
        { ratio: 4.0, amp: 0.18, decay: 0.62 },
        { ratio: 5.0, amp: 0.12, decay: 0.52 },
        { ratio: 6.0, amp: 0.08, decay: 0.45 },
        { ratio: 7.0, amp: 0.05, decay: 0.38 },
        { ratio: 8.0, amp: 0.03, decay: 0.32 }
      ];
  }
  
  const inharmonicity = type === "piano" ? 0.0005 * Math.pow(frequency / 261.63, 1.5) : 0;
  
  for (let channel = 0; channel < 2; channel++) {
    const data = buffer.getChannelData(channel);
    
    for (let i = 0; i < length; i++) {
      const t = i / sampleRate;
      let sample = 0;
      
      harmonics.forEach((h, idx) => {
        const harmonicFreq = frequency * h.ratio * Math.sqrt(1 + inharmonicity * h.ratio * h.ratio);
        const harmonicDecay = type === "organ" ? 1 : Math.exp(-3.5 * t / (duration * h.decay));
        const phase = channel * 0.1 + idx * 0.05;
        
        let wave;
        if (type === "organ") {
          wave = Math.sin(2 * Math.PI * harmonicFreq * t + phase);
        } else if (type === "synth") {
          // Saw + sine blend
          const saw = 2 * ((harmonicFreq * t) % 1) - 1;
          const sine = Math.sin(2 * Math.PI * harmonicFreq * t + phase);
          wave = saw * 0.3 + sine * 0.7;
        } else if (type === "strings") {
          // Vibrato
          const vibrato = Math.sin(2 * Math.PI * 5 * t) * 3;
          wave = Math.sin(2 * Math.PI * (harmonicFreq + vibrato) * t + phase);
        } else {
          const sine = Math.sin(2 * Math.PI * harmonicFreq * t + phase);
          const triangle = 2 * Math.abs(2 * ((harmonicFreq * t + phase) % 1) - 1) - 1;
          wave = sine * 0.85 + triangle * 0.15;
        }
        
        sample += wave * h.amp * harmonicDecay;
      });
      
      // Attack envelope
      let attackTime = type === "strings" ? 0.1 : (type === "organ" ? 0.02 : 0.003);
      const attackEnv = t < attackTime ? t / attackTime : 1;
      
      // Transient noise
      const noise = type === "guitar" ? 
        (t < 0.02 ? (Math.random() * 2 - 1) * Math.exp(-100 * t) * 0.4 : 0) :
        (t < 0.015 ? (Math.random() * 2 - 1) * Math.exp(-200 * t) * 0.2 : 0);
      
      data[i] = (sample * attackEnv + noise) * 0.25;
    }
  }
  
  return buffer;
}

// MIDI notadan frekans
function midiToFrequency(midi) {
  return 440 * Math.pow(2, (midi - 69) / 12);
}

// Nota √ßalma - √∂nce soundfont, yoksa synthesized
async function playNote(noteName, octave = 4, duration = 2.0, velocity = 1.0, delay = 0) {
  if (!audioInitialized) await initAudio();
  if (!audioCtx) return;
  if (audioCtx.state === "suspended") await audioCtx.resume();
  
  const key = `${noteName}${octave}`;
  
  // √ñnce soundfont sample'ƒ± dene
  let buffer = null;
  if (instrumentSamples[currentInstrument]) {
    buffer = instrumentSamples[currentInstrument][key];
  }
  
  // Yoksa synthesized piano sample kullan
  if (!buffer) {
    buffer = pianoSamples[key];
  }
  
  if (!buffer) {
    // Son √ßare: synthesis ile √ßal
    playNoteSynth(noteName, octave, duration, velocity, delay);
    return;
  }
  
  const startTime = audioCtx.currentTime + delay;
  
  // Buffer source
  const source = audioCtx.createBufferSource();
  source.buffer = buffer;
  
  // Velocity gain
  const velocityGain = audioCtx.createGain();
  velocityGain.gain.value = velocity * volume;
  
  // Artik√ºlasyon
  const artParams = ARTICULATION_PARAMS[currentArticulation];
  const actualDuration = duration * artParams.durationMult;
  
  // Release envelope
  velocityGain.gain.setValueAtTime(velocity * volume * artParams.velocityMult, startTime);
  velocityGain.gain.setValueAtTime(velocity * volume * artParams.velocityMult, startTime + actualDuration * 0.7);
  velocityGain.gain.exponentialRampToValueAtTime(0.001, startTime + actualDuration);
  
  source.connect(velocityGain);
  velocityGain.connect(masterGain);
  
  source.start(startTime);
  source.stop(startTime + actualDuration + 0.1);
}

// Fallback synthesizer
function playNoteSynth(noteName, octave, duration, velocity, delay) {
  const midiNote = NOTE_TO_MIDI[noteName] + (octave + 1) * 12;
  const frequency = midiToFrequency(midiNote);
  
  const startTime = audioCtx.currentTime + delay;
  const artParams = ARTICULATION_PARAMS[currentArticulation];
  const actualDuration = duration * artParams.durationMult;
  
  // Oscillators
  const osc1 = audioCtx.createOscillator();
  osc1.type = "triangle";
  osc1.frequency.value = frequency;
  
  const osc2 = audioCtx.createOscillator();
  osc2.type = "sine";
  osc2.frequency.value = frequency * 2;
  
  const gain = audioCtx.createGain();
  gain.gain.setValueAtTime(0, startTime);
  gain.gain.linearRampToValueAtTime(velocity * volume * 0.3 * artParams.velocityMult, startTime + 0.01);
  gain.gain.exponentialRampToValueAtTime(velocity * volume * 0.15, startTime + 0.1);
  gain.gain.exponentialRampToValueAtTime(0.001, startTime + actualDuration);
  
  const gain2 = audioCtx.createGain();
  gain2.gain.value = 0.15;
  
  osc1.connect(gain);
  osc2.connect(gain2);
  gain2.connect(gain);
  gain.connect(masterGain);
  
  osc1.start(startTime);
  osc2.start(startTime);
  osc1.stop(startTime + actualDuration + 0.1);
  osc2.stop(startTime + actualDuration + 0.1);
}

// Artik√ºlasyon parametreleri
const ARTICULATION_PARAMS = {
  normal: { durationMult: 1.0, velocityMult: 1.0 },
  staccato: { durationMult: 0.3, velocityMult: 1.1 },
  legato: { durationMult: 1.3, velocityMult: 0.9 },
  accent: { durationMult: 0.9, velocityMult: 1.4 },
  tenuto: { durationMult: 1.1, velocityMult: 1.0 },
  marcato: { durationMult: 0.7, velocityMult: 1.5 },
  sforzando: { durationMult: 0.6, velocityMult: 1.8 },
  arpeggio: { durationMult: 1.0, velocityMult: 1.0, isArpeggio: true }
};

// Akor √ßalma
async function playChord(chordName, duration = 1.0) {
  if (!audioInitialized) await initAudio();
  if (!audioCtx) return;
  if (audioCtx.state === "suspended") await audioCtx.resume();
  
  const notes = getChordNoteNames(chordName);
  if (!notes || notes.length === 0) return;
  
  const artParams = ARTICULATION_PARAMS[currentArticulation];
  
  // NOT: Bass line artƒ±k playChord'dan deƒüil, master clock'tan (playBassAtTick) √ßaƒürƒ±lƒ±yor
  
  if (artParams.isArpeggio || arpeggiatorEnabled) {
    // Arpeggio - farklƒ± pattern'ler
    const arpPatterns = [
      [0, 1, 2, 1],         // Up-down
      [0, 1, 2, 0, 1, 2],   // Up-up
      [2, 1, 0, 1],         // Down-up
      [0, 2, 1, 2],         // Broken
    ];
    const pattern = arpPatterns[Math.floor(Math.random() * arpPatterns.length)];
    const noteDelay = duration / pattern.length * 0.8;
    
    pattern.forEach((noteIdx, i) => {
      const note = notes[noteIdx % notes.length];
      const velocity = 0.85 + Math.random() * 0.15;
      const vel = i === 0 ? velocity + 0.1 : velocity;
      playNote(note, currentOctave, duration * 0.6, vel, i * noteDelay);
    });
  } else {
    // Normal akor (humanize ile)
    notes.forEach((note, idx) => {
      const humanizeDelay = Math.random() * 0.012;
      const humanizeVel = 0.92 + Math.random() * 0.16;
      playNote(note, currentOctave, duration, humanizeVel, humanizeDelay);
    });
  }
}

// Metronom click
// Perk√ºsyon sesi √ßal
async function playDrumSound(type, velocity = 1.0) {
  if (!audioInitialized) await initAudio();
  if (!audioCtx) return;
  if (audioCtx.state === "suspended") await audioCtx.resume();
  if (!type || velocity <= 0) return;
  
  const now = audioCtx.currentTime;
  
  if (type === 'kick') {
    // Kick drum
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(150, now);
    osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);
    gain.gain.setValueAtTime(velocity * 0.6, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(now);
    osc.stop(now + 0.2);
  }
  else if (type === 'snare') {
    // Snare drum
    const noise = audioCtx.createBufferSource();
    const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.1, audioCtx.sampleRate);
    const data = noiseBuffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
    noise.buffer = noiseBuffer;
    
    const noiseGain = audioCtx.createGain();
    noiseGain.gain.setValueAtTime(velocity * 0.3, now);
    noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
    
    const osc = audioCtx.createOscillator();
    osc.type = 'triangle';
    osc.frequency.value = 180;
    const oscGain = audioCtx.createGain();
    oscGain.gain.setValueAtTime(velocity * 0.4, now);
    oscGain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
    
    noise.connect(noiseGain);
    osc.connect(oscGain);
    noiseGain.connect(audioCtx.destination);
    oscGain.connect(audioCtx.destination);
    noise.start(now);
    osc.start(now);
    osc.stop(now + 0.1);
  }
  else if (type === 'hihat') {
    // Hi-hat
    const noise = audioCtx.createBufferSource();
    const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
    const data = noiseBuffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
    noise.buffer = noiseBuffer;
    
    const filter = audioCtx.createBiquadFilter();
    filter.type = 'highpass';
    filter.frequency.value = 7000;
    
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(velocity * 0.2, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
    
    noise.connect(filter);
    filter.connect(gain);
    gain.connect(audioCtx.destination);
    noise.start(now);
  }
  else if (type === 'ride') {
    // Ride cymbal
    const osc1 = audioCtx.createOscillator();
    const osc2 = audioCtx.createOscillator();
    osc1.type = 'triangle';
    osc2.type = 'sine';
    osc1.frequency.value = 400;
    osc2.frequency.value = 800;
    
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(velocity * 0.15, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
    
    osc1.connect(gain);
    osc2.connect(gain);
    gain.connect(audioCtx.destination);
    osc1.start(now);
    osc2.start(now);
    osc1.stop(now + 0.3);
    osc2.stop(now + 0.3);
  }
  else if (type === 'clave') {
    // Clave
    const osc = audioCtx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = 2500;
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(velocity * 0.3, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(now);
    osc.stop(now + 0.03);
  }
  else if (type === 'click') {
    // Simple click/metronome
    const osc = audioCtx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = velocity > 0.8 ? 1200 : 900;
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(velocity * 0.25, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(now);
    osc.stop(now + 0.05);
  }
}

// Eski playMetronomeClick - geriye uyumluluk i√ßin
async function playMetronomeClick(isAccent) {
  await playDrumSound('click', isAccent ? 1.0 : 0.6);
}

// === AKOR VE GAM FONKSƒ∞YONLARI ===

function parseChordName(chordName) {
  if (!chordName || typeof chordName !== 'string') return null;
  
  chordName = chordName.trim();
  if (chordName.length === 0) return null;
  
  let root = chordName[0].toUpperCase();
  let suffix = chordName.slice(1);
  
  if (suffix.startsWith("#") || suffix.startsWith("b")) {
    root += suffix[0];
    suffix = suffix.slice(1);
  }
  
  // Root kontrol√º
  if (!NOTES_SHARP.includes(root) && !NOTES_FLAT.includes(root)) {
    return null;
  }
  
  // Flat'ƒ± sharp'a √ßevir
  const flatToSharp = { "Db": "C#", "Eb": "D#", "Gb": "F#", "Ab": "G#", "Bb": "A#" };
  if (flatToSharp[root]) root = flatToSharp[root];
  
  // Suffix'ten tip belirle
  let type = "maj";
  
  if (suffix === "" || suffix === "M" || suffix === "maj") {
    type = "maj";
  } else if (suffix === "m" || suffix === "min" || suffix === "-") {
    type = "min";
  } else if (suffix === "¬∞" || suffix === "dim" || suffix === "o") {
    type = "dim";
  } else if (suffix === "+" || suffix === "aug") {
    type = "aug";
  } else if (suffix === "7" || suffix === "dom7") {
    type = "dom7";
  } else if (suffix === "maj7" || suffix === "M7" || suffix === "Œî7") {
    type = "maj7";
  } else if (suffix === "m7" || suffix === "min7" || suffix === "-7") {
    type = "min7";
  } else if (suffix === "¬∞7" || suffix === "dim7") {
    type = "dim7";
  } else if (suffix === "√∏7" || suffix === "m7b5" || suffix === "√∏") {
    type = "hdim7";
  } else if (suffix === "sus2") {
    type = "sus2";
  } else if (suffix === "sus4" || suffix === "sus") {
    type = "sus4";
  } else if (suffix === "9") {
    type = "dom9";
  } else if (suffix === "add9") {
    type = "add9";
  }
  
  return { root, type, suffix };
}

function getChordNoteNames(chordName) {
  const parsed = parseChordName(chordName);
  if (!parsed) return [];
  
  const { root, type } = parsed;
  const chordDef = CHORD_TYPES[type];
  if (!chordDef) return [];
  
  const rootIndex = NOTES_SHARP.indexOf(root);
  if (rootIndex === -1) return [];
  
  return chordDef.intervals.map(interval => {
    const noteIndex = (rootIndex + interval) % 12;
    return NOTES_SHARP[noteIndex];
  });
}

function buildScaleChords(key, scaleType, chordTypeOption = "triads") {
  const pattern = SCALE_PATTERNS[scaleType];
  if (!pattern) return [];
  
  const rootIndex = NOTES_SHARP.indexOf(key);
  if (rootIndex === -1) return [];
  
  const scaleNotes = pattern.map(interval => NOTES_SHARP[(rootIndex + interval) % 12]);
  const chords = [];
  
  for (let degree = 0; degree < Math.min(7, scaleNotes.length); degree++) {
    const chordRoot = scaleNotes[degree];
    
    // 3l√º ve 5li
    const thirdDegree = (degree + 2) % scaleNotes.length;
    const fifthDegree = (degree + 4) % scaleNotes.length;
    
    const thirdNote = scaleNotes[thirdDegree];
    const fifthNote = scaleNotes[fifthDegree];
    
    const rootIdx = NOTES_SHARP.indexOf(chordRoot);
    const thirdIdx = NOTES_SHARP.indexOf(thirdNote);
    const fifthIdx = NOTES_SHARP.indexOf(fifthNote);
    
    const thirdInterval = (thirdIdx - rootIdx + 12) % 12;
    const fifthInterval = (fifthIdx - rootIdx + 12) % 12;
    
    let quality, suffix;
    
    if (thirdInterval === 4 && fifthInterval === 7) {
      quality = "maj"; suffix = "";
    } else if (thirdInterval === 3 && fifthInterval === 7) {
      quality = "min"; suffix = "m";
    } else if (thirdInterval === 3 && fifthInterval === 6) {
      quality = "dim"; suffix = "¬∞";
    } else if (thirdInterval === 4 && fifthInterval === 8) {
      quality = "aug"; suffix = "+";
    } else {
      quality = "maj"; suffix = "";
    }
    
    // Akor tipi se√ßenekleri
    if (chordTypeOption === "sevenths") {
      // 7'li akorlar
      if (quality === "maj") {
        if (degree === 0 || degree === 3) {
          suffix = "maj7"; quality = "maj7";
        } else {
          suffix = "7"; quality = "dom7";
        }
      } else if (quality === "min") {
        suffix = "m7"; quality = "min7";
      } else if (quality === "dim") {
        suffix = "√∏7"; quality = "hdim7";
      }
    } else if (chordTypeOption === "extended") {
      // Geni≈ületilmi≈ü akorlar (9, 11, 13)
      const extTypes = ["9", "11", "13"];
      const ext = extTypes[Math.floor(Math.random() * extTypes.length)];
      if (quality === "maj") {
        if (degree === 0 || degree === 3) {
          suffix = "maj" + ext; quality = "maj" + ext;
        } else {
          suffix = ext; quality = "dom" + ext;
        }
      } else if (quality === "min") {
        suffix = "m" + ext; quality = "min" + ext;
      }
    } else if (chordTypeOption === "color") {
      // Renkli akorlar (sus, add, 6)
      const colorTypes = ["sus2", "sus4", "add9", "6"];
      const color = colorTypes[Math.floor(Math.random() * colorTypes.length)];
      if (quality === "maj") {
        suffix = color; quality = color;
      } else if (quality === "min") {
        if (color === "6") {
          suffix = "m6"; quality = "min6";
        } else if (color === "add9") {
          suffix = "m(add9)"; quality = "minadd9";
        } else {
          suffix = "m"; // sus akorlar min√∂r i√ßin mantƒ±klƒ± deƒüil
        }
      }
    } else if (chordTypeOption === "jazz") {
      // Jazz akorlarƒ± (altered, extended voicings)
      const jazzChance = Math.random();
      if (quality === "maj") {
        if (degree === 0 || degree === 3) {
          const opts = ["maj9", "maj13", "6/9"];
          suffix = opts[Math.floor(Math.random() * opts.length)];
          quality = suffix;
        } else if (degree === 4) { // V derece
          const opts = ["9", "13", "7#11", "7b9", "7#9", "7alt"];
          suffix = opts[Math.floor(Math.random() * opts.length)];
          quality = "dom" + suffix.replace("7", "");
        } else {
          suffix = "7"; quality = "dom7";
        }
      } else if (quality === "min") {
        const opts = ["m9", "m11", "m7"];
        suffix = opts[Math.floor(Math.random() * opts.length)];
        quality = suffix.replace("m", "min");
      } else if (quality === "dim") {
        suffix = "√∏7"; quality = "hdim7";
      }
    } else if (chordTypeOption === "mixed") {
      // Karƒ±≈üƒ±k - rastgele se√ßim
      const roll = Math.random();
      if (roll < 0.4) {
        // Triad olarak bƒ±rak
      } else if (roll < 0.7) {
        // 7'li
        if (quality === "maj") {
          if (degree === 0 || degree === 3) {
            suffix = "maj7"; quality = "maj7";
          } else {
            suffix = "7"; quality = "dom7";
          }
        } else if (quality === "min") {
          suffix = "m7"; quality = "min7";
        }
      } else {
        // Renkli
        const colorOpts = ["sus4", "add9", "6"];
        const color = colorOpts[Math.floor(Math.random() * colorOpts.length)];
        if (quality === "maj") {
          suffix = color; quality = color;
        }
      }
    }
    
    chords.push({
      degree: degree + 1,
      name: chordRoot + suffix,
      root: chordRoot,
      quality,
      suffix
    });
  }
  
  return chords;
}

function romanNumeral(degree, quality) {
  const numerals = ["I", "II", "III", "IV", "V", "VI", "VII"];
  let roman = numerals[degree - 1] || "?";
  
  if (["min", "min7", "dim", "hdim7"].includes(quality)) {
    roman = roman.toLowerCase();
  }
  
  if (quality === "dim" || quality === "dim7") roman += "¬∞";
  else if (quality === "hdim7") roman += "√∏";
  else if (quality === "aug") roman += "+";
  
  if (quality.includes("7")) {
    if (quality === "maj7") roman += "Œî";
    else roman += "‚Å∑";
  }
  
  return roman;
}

// === YARDIMCI FONKSƒ∞YONLAR ===

function pickRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getMillisecondsPerBeat() {
  return 60000 / tempo;
}

function getChordDuration() {
  return getMillisecondsPerBeat() * 2;
}

// ============================================
// B√ñL√úM 2 SONU - B√ñL√úM 3'√ú BURAYA YAPI≈ûTIRIN
// ============================================
// ============================================
// B√ñL√úM 3 BA≈ûLANGICI - UI VE T√úM MODLAR
// ============================================

// === UI OLU≈ûTURMA ===

function initializeApp() {
  // Ses ba≈ülatmayƒ± kullanƒ±cƒ± etkile≈üimine bƒ±rak
  renderSidebar();
  renderContentArea();
  setupEventListeners();
  updateProgress();
  
  // Loading overlay'i gizle ve kullanƒ±cƒ±ya tƒ±klamasƒ±nƒ± s√∂yle
  const overlay = document.getElementById("loadingOverlay");
  overlay.innerHTML = `
    <div class="loading-content">
      <div class="loading-icon">üéπ</div>
      <div class="loading-text">Ba≈ülamak i√ßin tƒ±klayƒ±n</div>
    </div>
  `;
  
  // Herhangi bir tƒ±klamada ses motorunu ba≈ülat
  const startAudio = async () => {
    overlay.innerHTML = `
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">Piyano sesleri y√ºkleniyor...</div>
      </div>
    `;
    await initAudio();
    document.removeEventListener("click", startAudio);
    document.removeEventListener("touchstart", startAudio);
  };
  
  document.addEventListener("click", startAudio, { once: true });
  document.addEventListener("touchstart", startAudio, { once: true });
}

function renderSidebar() {
  const sidebarHTML = getSidebarHTML('desktop');
  document.getElementById("sidebar").innerHTML = sidebarHTML;
  
  // Mobil ayarlar i√ßin farklƒ± ID'lerle
  document.getElementById("mobileSettingsContent").innerHTML = getSidebarHTML('mobile');
}

function getSidebarHTML(prefix) {
  const idPrefix = prefix === 'mobile' ? 'mobile_' : '';
  
  return `
    <!-- Ton & Gam -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">üéµ</div>
        <div class="panel-title">Ton & Gam</div>
      </div>
      <div class="controls-grid">
        <div class="control-group">
          <label class="control-label">Ton</label>
          <select class="sync-control" data-sync="keySelect" id="${idPrefix}keySelect">
            ${NOTES_SHARP.map(n => `<option value="${n}">${n}</option>`).join("")}
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Gam</label>
          <select class="sync-control" data-sync="scaleSelect" id="${idPrefix}scaleSelect">
            <option value="major">Major</option>
            <option value="naturalMinor">Minor</option>
            <option value="harmonicMinor">Harm. Min√∂r</option>
            <option value="dorian">Dorian</option>
            <option value="phrygian">Phrygian</option>
            <option value="lydian">Lydian</option>
            <option value="mixolydian">Mixolydian</option>
            <option value="pentatonicMajor">Penta. Maj</option>
            <option value="blues">Blues</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Stil & Uzunluk -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">üé∏</div>
        <div class="panel-title">Stil</div>
      </div>
      <div class="controls-grid">
        <div class="control-group">
          <label class="control-label">T√ºr</label>
          <select class="sync-control" data-sync="styleSelect" id="${idPrefix}styleSelect">
            <option value="pop">üé§ Pop</option>
            <option value="rock">üé∏ Rock</option>
            <option value="jazz">üé∑ Jazz</option>
            <option value="blues">üé∫ Blues</option>
            <option value="ballad">üíù Ballad</option>
            <option value="edm">üéß EDM</option>
            <option value="latin">üíÉ Latin</option>
            <option value="rnb">üéôÔ∏è R&B/Soul</option>
            <option value="classical">üéª Classical</option>
            <option value="funk">üï∫ Funk</option>
            <option value="country">ü§† Country</option>
            <option value="gospel">‚õ™ Gospel</option>
            <option value="world">üåç World</option>
            <option value="random">üé≤ Rastgele</option>
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Akor Sayƒ±sƒ±</label>
          <select class="sync-control" data-sync="lengthSelect" id="${idPrefix}lengthSelect">
            <option value="4">4 Akor</option>
            <option value="8" selected>8 Akor</option>
            <option value="12">12 Akor</option>
            <option value="16">16 Akor</option>
          </select>
        </div>
        <div class="control-group full-width">
          <label class="control-label">Akor Tipi</label>
          <select class="sync-control" data-sync="chordTypeSelect" id="${idPrefix}chordTypeSelect">
            <option value="triads">√ú√ßl√ºler (Triad)</option>
            <option value="sevenths">7'li Akorlar</option>
            <option value="extended">Geni≈ületilmi≈ü (9, 11, 13)</option>
            <option value="color">Renkli (sus, add, 6)</option>
            <option value="jazz">Jazz Voicings</option>
            <option value="mixed">Karƒ±≈üƒ±k</option>
          </select>
        </div>
        <div class="control-group full-width">
          <label class="control-label">√úretim Algoritmasƒ±</label>
          <select class="sync-control" data-sync="algorithmSelect" id="${idPrefix}algorithmSelect">
            <option value="pattern">üìö Stil K√ºt√ºphanesi</option>
            <option value="functional">üéØ Fonksiyonel Harmoni (T-S-D-T)</option>
            <option value="fifths">‚≠ï Circle of Fifths</option>
            <option value="jazz251">üé∑ Jazz ii-V-I</option>
            <option value="modal">üåà Modal Interchange</option>
            <option value="secondary">üî• Secondary Dominants</option>
            <option value="cadence">üé¨ Kadans Odaklƒ±</option>
            <option value="random">üé≤ Tam Rastgele</option>
          </select>
        </div>
        <div class="control-group full-width">
          <label class="control-label">üé∏ Bass Pattern</label>
          <select class="sync-control" data-sync="bassPatternSelect" id="${idPrefix}bassPatternSelect">
            <option value="auto">üéØ Otomatik (Stile g√∂re)</option>
            <option value="root">üî¥ Sadece Root</option>
            <option value="rootFifth">üîµ Root + 5th</option>
            <option value="walking">üö∂ Walking Bass</option>
            <option value="latin">üíÉ Latin / Bossa</option>
            <option value="rock">üé∏ Rock / Pop</option>
            <option value="funk">üï∫ Funk</option>
            <option value="jazz">üé∑ Jazz Walking</option>
            <option value="ballad">üíù Ballad</option>
            <option value="reggae">üå¥ Reggae</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Artik√ºlasyon -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">üéº</div>
        <div class="panel-title">Artik√ºlasyon</div>
      </div>
      <div class="articulation-panel">
        <button class="articulation-btn active" data-articulation="normal">
          <span class="articulation-icon">‚Äî</span>Normal
        </button>
        <button class="articulation-btn" data-articulation="staccato">
          <span class="articulation-icon">‚Ä¢</span>Staccato
        </button>
        <button class="articulation-btn" data-articulation="legato">
          <span class="articulation-icon">‚åí</span>Legato
        </button>
        <button class="articulation-btn" data-articulation="arpeggio">
          <span class="articulation-icon">‚üø</span>Arpeggio
        </button>
      </div>
    </div>

    <!-- Ses Ayarlarƒ± -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">üîä</div>
        <div class="panel-title">Ses</div>
      </div>
      <div class="control-group">
        <label class="control-label">Enstr√ºman</label>
        <select class="sync-control" data-sync="instrumentSelect" id="${idPrefix}instrumentSelect">
          <optgroup label="üéπ Klavye">
            <option value="piano">üéπ Akustik Piano</option>
            <option value="epiano">üéπ Electric Piano</option>
            <option value="organ">üéπ Organ</option>
            <option value="synth">üéπ Harmonium</option>
          </optgroup>
          <optgroup label="üé∏ Gitar">
            <option value="guitar">üé∏ Akustik Gitar (Steel)</option>
            <option value="nylonGuitar">üé∏ Klasik Gitar (Nylon)</option>
            <option value="electricGuitar">üé∏ Elektro Gitar</option>
          </optgroup>
          <optgroup label="üéª Yaylƒ±lar">
            <option value="strings">üéª Violin</option>
            <option value="cello">üéª Cello</option>
            <option value="harp">üéª Harp</option>
          </optgroup>
          <optgroup label="üé∫ Nefesli">
            <option value="trumpet">üé∫ Trumpet</option>
            <option value="saxophone">üé∑ Saxophone</option>
            <option value="flute">üéµ Flute</option>
          </optgroup>
          <optgroup label="üé∏ Bass">
            <option value="bass">üé∏ Electric Bass</option>
          </optgroup>
        </select>
      </div>
      <div class="control-group">
        <label class="control-label">Ses Seviyesi</label>
        <div class="slider-container">
          <input type="range" class="sync-control" data-sync="volumeSlider" id="${idPrefix}volumeSlider" min="0" max="100" value="70">
          <div class="slider-value" id="${idPrefix}volumeValue">70%</div>
        </div>
      </div>
      <div class="control-group">
        <label class="control-label">Oktav</label>
        <select class="sync-control" data-sync="octaveSelect" id="${idPrefix}octaveSelect">
          <option value="2">2 (√áok D√º≈ü√ºk)</option>
          <option value="3">3 (D√º≈ü√ºk)</option>
          <option value="4" selected>4 (Orta)</option>
          <option value="5">5 (Y√ºksek)</option>
        </select>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Reverb</span>
        <button class="toggle-btn active sync-control" data-sync="reverbToggle" id="${idPrefix}reverbToggle"></button>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Arpeggiator</span>
        <button class="toggle-btn sync-control" data-sync="arpToggle" id="${idPrefix}arpToggle"></button>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Bass Line</span>
        <button class="toggle-btn sync-control" data-sync="bassToggle" id="${idPrefix}bassToggle"></button>
      </div>
    </div>

    <!-- Presetler -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">‚ö°</div>
        <div class="panel-title">Presetler</div>
      </div>
      <div class="preset-list">
        <button class="preset-chip" data-preset="pop1">I-V-vi-IV</button>
        <button class="preset-chip" data-preset="jazz1">ii-V-I</button>
        <button class="preset-chip" data-preset="blues1">Blues</button>
        <button class="preset-chip" data-preset="rock1">I-IV-V</button>
        <button class="preset-chip" data-preset="sad1">Sad</button>
      </div>
    </div>

    <!-- ≈ûarkƒ± K√ºt√ºphanesi -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-icon">üéµ</div>
        <div class="panel-title">≈ûarkƒ± K√ºt√ºphanesi</div>
      </div>
      <div class="song-library">
        <select class="song-genre-select" id="${idPrefix}songGenreSelect">
          <option value="pop">üé§ Pop (${FAMOUS_SONGS.pop?.length || 0})</option>
          <option value="rock">üé∏ Rock (${FAMOUS_SONGS.rock?.length || 0})</option>
          <option value="jazz">üé∑ Jazz (${FAMOUS_SONGS.jazz?.length || 0})</option>
          <option value="blues">üé∫ Blues (${FAMOUS_SONGS.blues?.length || 0})</option>
          <option value="ballad">üíù Ballad (${FAMOUS_SONGS.ballad?.length || 0})</option>
          <option value="edm">üéß EDM (${FAMOUS_SONGS.edm?.length || 0})</option>
          <option value="latin">üíÉ Latin (${FAMOUS_SONGS.latin?.length || 0})</option>
          <option value="rnb">üéôÔ∏è R&B/Soul (${FAMOUS_SONGS.rnb?.length || 0})</option>
          <option value="classical">üéª Classical (${FAMOUS_SONGS.classical?.length || 0})</option>
          <option value="funk">üï∫ Funk (${FAMOUS_SONGS.funk?.length || 0})</option>
          <option value="country">ü§† Country (${FAMOUS_SONGS.country?.length || 0})</option>
          <option value="gospel">‚õ™ Gospel (${FAMOUS_SONGS.gospel?.length || 0})</option>
          <option value="world">üåç World (${FAMOUS_SONGS.world?.length || 0})</option>
        </select>
        <div class="song-list" id="${idPrefix}songList">
          <!-- ≈ûarkƒ±lar buraya dinamik olarak y√ºklenecek -->
        </div>
      </div>
    </div>
  `;
}

function renderContentArea() {
  const content = document.getElementById("contentArea");
  content.innerHTML = `
    <!-- Transport Bar -->
    <div class="transport-bar">
      <div class="transport-row">
        <button class="transport-btn" id="stopBtn" title="Durdur">‚èπ</button>
        <button class="transport-btn play-btn" id="playBtn" title="√áal">‚ñ∂</button>
        <button class="transport-btn" id="loopBtn" title="D√∂ng√º">üîÅ</button>
        <button class="transport-btn" id="metronomeBtn" title="Metronom">ü•Å</button>
        
        <!-- Ritim Se√ßici -->
        <div class="rhythm-selector">
          <button class="rhythm-nav-btn" id="prevRhythmBtn" title="√ñnceki Ritim">‚óÄ</button>
          <div class="rhythm-name" id="rhythmName">Standard Pop</div>
          <button class="rhythm-nav-btn" id="nextRhythmBtn" title="Sonraki Ritim">‚ñ∂</button>
        </div>
        
        <!-- Comping Pattern Se√ßici -->
        <div class="comping-selector">
          <button class="rhythm-nav-btn" id="prevCompingBtn" title="√ñnceki Pattern">‚óÄ</button>
          <div class="comping-name" id="compingName">Straight</div>
          <button class="rhythm-nav-btn" id="nextCompingBtn" title="Sonraki Pattern">‚ñ∂</button>
        </div>
        
        <!-- Bass Pattern Se√ßici -->
        <div class="bass-selector">
          <button class="rhythm-nav-btn" id="prevBassBtn" title="√ñnceki Bass">‚óÄ</button>
          <div class="bass-name" id="bassName">üé∏ Root+5th</div>
          <button class="rhythm-nav-btn" id="nextBassBtn" title="Sonraki Bass">‚ñ∂</button>
        </div>
      </div>
      
      <div class="tempo-section">
        <button class="tempo-btn" id="tempoDown">‚àí</button>
        <div>
          <div class="tempo-value" id="tempoDisplay">${tempo}</div>
          <div class="tempo-label">BPM</div>
        </div>
        <button class="tempo-btn" id="tempoUp">+</button>
      </div>
      
      <div class="metronome-section">
        <div class="metronome-visual" id="metronomeVisual">
          <div class="beat-dot"></div>
          <div class="beat-dot"></div>
          <div class="beat-dot"></div>
          <div class="beat-dot"></div>
        </div>
      </div>
      
      <div class="progress-section">
        <div class="progress-info">
          <span id="currentChordNum">Akor 0/0</span>
          <span id="currentTime">0:00</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
    </div>

    <!-- Generate Button -->
    <button class="btn btn-primary btn-full" id="generateBtn">
      ‚ú® Yeni Akor Dizisi √úret
    </button>

    <!-- Chord Display -->
    <div class="chord-display" id="chordDisplayPanel">
      <div class="chord-display-header">
        <div class="chord-display-title">Akor Dizisi</div>
        <div class="chord-info-tags">
          <div class="info-tag">Ton: <span id="tagKey">C</span></div>
          <div class="info-tag">Gam: <span id="tagScale">Major</span></div>
          <div class="info-tag">T√ºr: <span id="tagStyle">Pop</span></div>
        </div>
      </div>
      <div class="chords-container" id="chordsContainer">
        <div class="empty-state">
          <div class="empty-state-icon">üéπ</div>
          <p>Akor dizisi √ºretmek i√ßin butona tƒ±klayƒ±n</p>
        </div>
      </div>
      <div class="roman-line" id="romanLine">Roma rakamlarƒ± burada g√∂r√ºnecek</div>
    </div>

    <!-- Piano -->
    <div class="piano-section" id="pianoSection">
      <div class="piano-header">
        <div class="piano-title">üéπ Piyano</div>
        <div class="current-chord-display">
          <span class="current-chord-name" id="currentChordName">-</span>
          <span class="current-chord-notes" id="currentChordNotes"></span>
        </div>
      </div>
      <div class="piano-wrapper">
        <svg id="pianoSvg" class="piano-svg" viewBox="0 0 700 140" preserveAspectRatio="xMidYMid meet">
          ${generatePianoSVG(currentOctave)}
        </svg>
      </div>
    </div>

    <!-- Training Panel -->
    <div class="panel" id="trainingPanel" style="display: none;">
      <div class="panel-header">
        <div class="panel-icon">üìä</div>
        <div class="panel-title">Antrenman ƒ∞statistikleri</div>
      </div>
      <div class="training-stats">
        <div class="stat-box">
          <div class="stat-value" id="statCorrect">0</div>
          <div class="stat-label">Doƒüru</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-label">Toplam</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="statAccuracy">0%</div>
          <div class="stat-label">Ba≈üarƒ±</div>
        </div>
      </div>
    </div>

    <!-- Note Finder Panel -->
    <div class="panel" id="noteFinderPanel" style="display: none;">
      <div class="panel-header">
        <div class="panel-icon">üéØ</div>
        <div class="panel-title">Nota Yeri Bulma</div>
      </div>
      <div class="note-finder-modes">
        <button class="btn btn-secondary" id="noteFinderLearn">üìö √ñƒüren</button>
        <button class="btn btn-secondary" id="noteFinderTest">‚úèÔ∏è Test</button>
      </div>
      <div id="noteFinderTarget" style="display: none;">
        <div class="target-note-display">
          <span class="target-note-name" id="targetNoteName">C</span>
          <span class="target-note-octave" id="targetNoteOctave">4</span>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.85rem; text-align: center;">Bu notayƒ± piyanoda bulun!</p>
      </div>
      <div class="note-finder-feedback" id="noteFinderFeedback"></div>
      <div class="note-finder-stats">
        <div class="stat-mini">
          <span class="stat-mini-value" id="nfCorrect">0</span>
          <span class="stat-mini-label">Doƒüru</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="nfWrong">0</span>
          <span class="stat-mini-label">Yanlƒ±≈ü</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="nfStreak">0</span>
          <span class="stat-mini-label">Seri</span>
        </div>
      </div>
      <button class="btn btn-primary btn-full" id="noteFinderNext" style="margin-top: 12px;">üé≤ Yeni Nota</button>
    </div>

    <!-- Chord Recognition Panel -->
    <div class="panel" id="chordRecogPanel" style="display: none;">
      <div class="panel-header">
        <div class="panel-icon">üëÇ</div>
        <div class="panel-title">Akor Tanƒ±ma</div>
      </div>
      <div class="control-group" style="margin-bottom: 12px;">
        <label class="control-label">Zorluk</label>
        <select id="chordRecogDifficulty">
          <option value="easy">Kolay (Maj/Min)</option>
          <option value="medium">Orta (+Dim/Aug)</option>
          <option value="hard">Zor (+7'li)</option>
        </select>
      </div>
      <button class="btn btn-primary btn-full" id="chordRecogPlay">üîä Akoru √áal</button>
      <div id="chordRecogAnswer" style="display: none; margin-top: 16px;">
        <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 8px;">K√∂k Nota:</p>
        <div class="root-note-options" id="rootNoteOptions"></div>
        <p style="color: var(--text-muted); font-size: 0.8rem; margin: 12px 0 8px;">Akor Tipi:</p>
        <div class="chord-type-options" id="chordTypeOptions"></div>
        <button class="btn btn-secondary btn-full" id="chordRecogSubmit" style="margin-top: 12px;">‚úì Kontrol Et</button>
      </div>
      <div class="chord-recog-result" id="chordRecogResult"></div>
      <div class="chord-recog-stats">
        <div class="stat-mini">
          <span class="stat-mini-value" id="crCorrect">0</span>
          <span class="stat-mini-label">Doƒüru</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="crTotal">0</span>
          <span class="stat-mini-label">Toplam</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="crAccuracy">0%</span>
          <span class="stat-mini-label">Ba≈üarƒ±</span>
        </div>
      </div>
    </div>

    <!-- Key Detection Panel -->
    <div class="panel" id="keyDetectPanel" style="display: none;">
      <div class="panel-header">
        <div class="panel-icon">üîë</div>
        <div class="panel-title">Tonalite Analizi</div>
      </div>
      <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 12px;">Akor dizisini analiz ederek tonaliteyi tespit eder.</p>
      <button class="btn btn-primary btn-full" id="analyzeKeyBtn">üîç Analiz Et</button>
      <div class="control-group" style="margin-top: 12px;">
        <label class="control-label">Manuel Giri≈ü (√∂r: C Am F G)</label>
        <input type="text" id="manualChordInput" placeholder="C Am F G">
      </div>
      <button class="btn btn-secondary btn-full" id="analyzeManualBtn" style="margin-top: 8px;">Manuel Analiz</button>
      <div id="keyDetectResults" style="display: none; margin-top: 16px;">
        <div class="key-result-primary">
          <span class="key-result-label">Tespit Edilen Tonalite</span>
          <span class="key-result-value" id="detectedKey">-</span>
        </div>
        <div class="key-result-confidence">
          <span class="key-result-label">G√ºven:</span>
          <div class="confidence-bar"><div class="confidence-fill" id="confidenceFill"></div></div>
          <span class="confidence-value" id="confidenceValue">0%</span>
        </div>
        <div style="margin-bottom: 12px;">
          <span class="key-result-label">Alternatifler:</span>
          <div class="alternative-keys" id="alternativeKeys"></div>
        </div>
        <div class="analysis-section">
          <span class="analysis-title">üìä Nota Daƒüƒ±lƒ±mƒ±</span>
          <div class="note-distribution" id="noteDistribution"></div>
        </div>
        <div class="analysis-section">
          <span class="analysis-title">üéº Fonksiyonel Analiz</span>
          <div class="functional-analysis" id="functionalAnalysis"></div>
        </div>
        <div class="analysis-section">
          <span class="analysis-title">üé≠ Modal Karakter</span>
          <div class="modal-character" id="modalCharacter"></div>
        </div>
      </div>
    </div>
  `;
}

function generatePianoSVG(baseOctave = 4) {
  let svg = '';
  const whiteKeyWidth = 50;
  const blackKeyWidth = 32;
  const whiteKeyHeight = 140;
  const blackKeyHeight = 85;
  
  // 2 oktav: baseOctave ve baseOctave+1
  const octave1 = baseOctave;
  const octave2 = baseOctave + 1;
  
  const whiteNotes = [
    {note: "C", octave: octave1}, {note: "D", octave: octave1}, {note: "E", octave: octave1},
    {note: "F", octave: octave1}, {note: "G", octave: octave1}, {note: "A", octave: octave1}, {note: "B", octave: octave1},
    {note: "C", octave: octave2}, {note: "D", octave: octave2}, {note: "E", octave: octave2},
    {note: "F", octave: octave2}, {note: "G", octave: octave2}, {note: "A", octave: octave2}, {note: "B", octave: octave2}
  ];
  
  // Beyaz tu≈ülar
  whiteNotes.forEach((n, i) => {
    const x = i * whiteKeyWidth;
    svg += `<rect class="piano-key white-key" data-note="${n.note}" data-octave="${n.octave}" 
            x="${x}" y="0" width="${whiteKeyWidth}" height="${whiteKeyHeight}" rx="0" ry="4"/>`;
  });
  
  // Siyah tu≈ülar
  const blackPositions = [
    {note: "C#", octave: octave1, offset: 0}, {note: "D#", octave: octave1, offset: 1},
    {note: "F#", octave: octave1, offset: 3}, {note: "G#", octave: octave1, offset: 4}, {note: "A#", octave: octave1, offset: 5},
    {note: "C#", octave: octave2, offset: 7}, {note: "D#", octave: octave2, offset: 8},
    {note: "F#", octave: octave2, offset: 10}, {note: "G#", octave: octave2, offset: 11}, {note: "A#", octave: octave2, offset: 12}
  ];
  
  blackPositions.forEach(n => {
    const x = (n.offset + 1) * whiteKeyWidth - blackKeyWidth / 2 - 2;
    svg += `<rect class="piano-key black-key" data-note="${n.note}" data-octave="${n.octave}" 
            x="${x}" y="0" width="${blackKeyWidth}" height="${blackKeyHeight}" rx="0" ry="3"/>`;
  });
  
  // Nota isimleri
  whiteNotes.forEach((n, i) => {
    const x = i * whiteKeyWidth + whiteKeyWidth / 2;
    const label = (i === 0 || i === 7) ? `${n.note}${n.octave}` : n.note;
    svg += `<text x="${x}" y="130" text-anchor="middle" font-size="10" fill="#888" font-family="JetBrains Mono">${label}</text>`;
  });
  
  return svg;
}

// Piyanoyu yeniden √ßiz
function updatePianoOctave() {
  const pianoSvg = document.getElementById("pianoSvg");
  pianoSvg.innerHTML = generatePianoSVG(currentOctave);
  
  // Event listener'larƒ± tekrar ekle
  pianoSvg.querySelectorAll(".piano-key").forEach(key => {
    const handler = () => {
      const note = key.dataset.note;
      const octave = parseInt(key.dataset.octave);
      playNote(note, octave, 1.0, 1.0);
      
      if (currentMode === "noteFinder" && noteFinderActive) {
        checkNoteFinder(note, octave, key);
      }
    };
    key.addEventListener("click", handler);
    key.addEventListener("touchstart", (e) => { e.preventDefault(); handler(); }, { passive: false });
  });
}

// === AKOR Dƒ∞Zƒ∞Sƒ∞ OLU≈ûTURMA ===

// Fonksiyonel Harmoni - Akor fonksiyonlarƒ±
const CHORD_FUNCTIONS = {
  // Major scale
  major: {
    tonic: [1, 6, 3],      // I, vi, iii - Dinlenme
    subdominant: [4, 2],   // IV, ii - Hareket
    dominant: [5, 7]       // V, vii¬∞ - Gerilim
  },
  // Minor scale
  minor: {
    tonic: [1, 6, 3],
    subdominant: [4, 2],
    dominant: [5, 7]
  }
};

// Circle of Fifths sƒ±rasƒ± (derece olarak)
const CIRCLE_OF_FIFTHS_DEGREES = [4, 7, 3, 6, 2, 5, 1]; // IV-vii-iii-vi-ii-V-I

// Jazz ii-V-I pattern'leri
const JAZZ_251_PATTERNS = [
  [2, 5, 1],           // Klasik ii-V-I
  [2, 5, 1, 1],        // ii-V-I uzatƒ±lmƒ±≈ü
  [2, 5, 1, 6],        // ii-V-I-vi
  [2, 5, 3, 6],        // ii-V-iii-vi
  [6, 2, 5, 1],        // vi-ii-V-I (full turnaround)
  [3, 6, 2, 5],        // iii-vi-ii-V
  [1, 6, 2, 5],        // I-vi-ii-V (rhythm changes)
];

// Modal Interchange - Major'dan borrowed chords
const MODAL_INTERCHANGE = {
  major: {
    fromMinor: ['bVII', 'bVI', 'bIII', 'iv'],  // Paralel minor'dan
    fromDorian: ['IV7', 'bVII'],
    fromLydian: ['#IV¬∞', 'II'],
    fromMixolydian: ['bVII', 'v']
  }
};

// Kadans tipleri
const CADENCE_TYPES = {
  authentic: [5, 1],      // V-I (g√º√ßl√º biti≈ü)
  plagal: [4, 1],         // IV-I (amen)
  half: [1, 5],           // I-V (yarƒ±m kadans)
  deceptive: [5, 6],      // V-vi (aldatƒ±cƒ±)
  backdoor: [4, 'bVII', 1] // IV-bVII-I (backdoor)
};

function generateChordProgression() {
  const key = document.getElementById("keySelect").value;
  const scaleType = document.getElementById("scaleSelect").value;
  const style = document.getElementById("styleSelect").value;
  const length = parseInt(document.getElementById("lengthSelect").value);
  const chordTypeOption = document.getElementById("chordTypeSelect").value;
  const algorithm = document.getElementById("algorithmSelect")?.value || "pattern";
  
  const scaleChords = buildScaleChords(key, scaleType, chordTypeOption);
  if (!scaleChords.length) {
    alert("Akorlar olu≈üturulamadƒ±!");
    return;
  }
  
  let degreeSequence = [];
  let patternName = "";
  
  // Algoritmaya g√∂re √ºret
  switch (algorithm) {
    case "functional":
      ({ degrees: degreeSequence, name: patternName } = generateFunctionalHarmony(length, scaleType));
      break;
      
    case "fifths":
      ({ degrees: degreeSequence, name: patternName } = generateCircleOfFifths(length));
      break;
      
    case "jazz251":
      ({ degrees: degreeSequence, name: patternName } = generateJazz251(length));
      break;
      
    case "modal":
      ({ degrees: degreeSequence, name: patternName } = generateModalInterchange(length, key, scaleType, scaleChords));
      break;
      
    case "secondary":
      ({ degrees: degreeSequence, name: patternName } = generateSecondaryDominants(length, scaleChords));
      break;
      
    case "cadence":
      ({ degrees: degreeSequence, name: patternName } = generateCadenceFocused(length));
      break;
      
    case "random":
      // Tam rastgele
      for (let i = 0; i < length; i++) {
        degreeSequence.push(Math.floor(Math.random() * 7) + 1);
      }
      patternName = "Tam Rastgele";
      break;
      
    case "pattern":
    default:
      // Mevcut stil k√ºt√ºphanesi sistemi
      ({ degrees: degreeSequence, name: patternName } = generateFromPatternLibrary(style, length, scaleChords));
      break;
  }
  
  // Dereceleri akorlara √ßevir
  currentChords = degreeSequence.map(degree => {
    // √ñzel akorlar (bVII, bVI vs) i√ßin kontrol
    if (typeof degree === 'string') {
      return createBorrowedChord(degree, key, scaleType);
    }
    const adjustedDegree = ((degree - 1) % scaleChords.length) + 1;
    return { ...scaleChords[adjustedDegree - 1], degree: adjustedDegree };
  });
  
  currentPatternName = patternName;
  
  // Bass line hesapla (stil bazlƒ± pattern se√ßimi)
  const bassPattern = getStyleBasedBassPattern(style);
  currentBassPattern = bassPattern;
  calculateBassLine(currentChords, bassPattern);
  
  updateChordDisplay();
  updateTags(key, scaleType, style, patternName);
  
  if (currentChords.length > 0) {
    selectChord(0);
  }
  
  stopPlayback();
  startPlayback();
}

// === ALGORƒ∞TMA FONKSƒ∞YONLARI ===

// 1. Fonksiyonel Harmoni (T-S-D-T)
function generateFunctionalHarmony(length, scaleType) {
  const isMinor = scaleType.includes('Minor') || scaleType === 'dorian' || scaleType === 'phrygian';
  const functions = CHORD_FUNCTIONS[isMinor ? 'minor' : 'major'];
  
  // T-S-D-T d√∂ng√ºs√º
  const functionSequence = ['tonic', 'subdominant', 'dominant', 'tonic'];
  const degrees = [];
  
  for (let i = 0; i < length; i++) {
    const func = functionSequence[i % functionSequence.length];
    const options = functions[func];
    // ƒ∞lk ve son akor tonik olsun
    if (i === 0 || i === length - 1) {
      degrees.push(1);
    } else {
      degrees.push(pickRandom(options));
    }
  }
  
  return { degrees, name: "Fonksiyonel (T-S-D-T)" };
}

// 2. Circle of Fifths
function generateCircleOfFifths(length) {
  const degrees = [];
  
  // Be≈üliler √ßemberinde ilerle
  // ... vi - ii - V - I - IV ≈üeklinde
  const fifthsSequence = [6, 2, 5, 1, 4, 7, 3]; // vi-ii-V-I-IV-vii-iii
  
  // Ba≈ülangƒ±√ß noktasƒ± rastgele se√ß
  let startIdx = Math.floor(Math.random() * 4); // ƒ∞lk 4'ten ba≈üla
  
  for (let i = 0; i < length; i++) {
    const idx = (startIdx + i) % fifthsSequence.length;
    degrees.push(fifthsSequence[idx]);
  }
  
  // Son akor tonik olsun
  if (degrees[degrees.length - 1] !== 1) {
    degrees[degrees.length - 1] = 1;
  }
  
  return { degrees, name: "Circle of Fifths" };
}

// 3. Jazz ii-V-I
function generateJazz251(length) {
  const degrees = [];
  
  // Temel ii-V-I bloklarƒ± ile doldur
  while (degrees.length < length) {
    const pattern = pickRandom(JAZZ_251_PATTERNS);
    for (const d of pattern) {
      if (degrees.length < length) {
        degrees.push(d);
      }
    }
  }
  
  return { degrees, name: "Jazz ii-V-I" };
}

// 4. Modal Interchange
function generateModalInterchange(length, key, scaleType, scaleChords) {
  const degrees = [];
  const borrowedOptions = ['bVII', 'bVI', 'bIII', 'iv'];
  
  for (let i = 0; i < length; i++) {
    // %30 ≈üansla borrowed chord kullan
    if (Math.random() < 0.3 && i !== 0 && i !== length - 1) {
      degrees.push(pickRandom(borrowedOptions));
    } else {
      // Normal diatonic
      if (i === 0 || i === length - 1) {
        degrees.push(1); // Tonik
      } else if (i === length - 2) {
        degrees.push(5); // Dominant
      } else {
        degrees.push(pickRandom([1, 2, 4, 5, 6]));
      }
    }
  }
  
  return { degrees, name: "Modal Interchange" };
}

// 5. Secondary Dominants
function generateSecondaryDominants(length, scaleChords) {
  const degrees = [];
  
  // Secondary dominant hedefleri: ii, iii, IV, V, vi
  const targets = [2, 3, 4, 5, 6];
  
  for (let i = 0; i < length; i++) {
    if (i === 0) {
      degrees.push(1);
    } else if (i === length - 1) {
      degrees.push(1);
    } else if (i === length - 2) {
      degrees.push(5);
    } else {
      // %40 ≈üansla secondary dominant + target
      if (Math.random() < 0.4 && i < length - 3) {
        const target = pickRandom(targets);
        degrees.push('V/' + target); // Secondary dominant
        i++;
        if (i < length) {
          degrees.push(target);
        }
      } else {
        degrees.push(pickRandom([1, 2, 4, 5, 6]));
      }
    }
  }
  
  // Uzunluƒüu d√ºzelt
  while (degrees.length > length) degrees.pop();
  while (degrees.length < length) degrees.push(pickRandom([1, 4, 5]));
  
  return { degrees, name: "Secondary Dominants" };
}

// 6. Kadans Odaklƒ±
function generateCadenceFocused(length) {
  const degrees = [];
  const cadenceTypes = Object.keys(CADENCE_TYPES);
  
  // Her 4 akorda bir kadans yerle≈ütir
  const blockSize = 4;
  const numBlocks = Math.ceil(length / blockSize);
  
  for (let block = 0; block < numBlocks; block++) {
    const isLast = (block === numBlocks - 1);
    const remainingLength = length - degrees.length;
    const blockLength = Math.min(blockSize, remainingLength);
    
    if (blockLength <= 0) break;
    
    // Kadans tipi se√ß
    let cadenceType;
    if (isLast) {
      cadenceType = 'authentic'; // Son blok her zaman authentic
    } else {
      cadenceType = pickRandom(['authentic', 'half', 'deceptive', 'plagal']);
    }
    
    const cadence = CADENCE_TYPES[cadenceType];
    
    // Blok doldur
    if (blockLength >= 4) {
      // Tam blok: I - X - kadans
      degrees.push(1);
      degrees.push(pickRandom([2, 4, 6]));
      degrees.push(cadence[0]);
      degrees.push(typeof cadence[1] === 'number' ? cadence[1] : 1);
    } else if (blockLength >= 2) {
      // Kƒ±sa blok: sadece kadans
      degrees.push(cadence[0]);
      degrees.push(typeof cadence[1] === 'number' ? cadence[1] : 1);
    } else {
      degrees.push(1);
    }
  }
  
  // Uzunluƒüu d√ºzelt
  while (degrees.length > length) degrees.pop();
  
  return { degrees, name: "Kadans Odaklƒ±" };
}

// Mevcut stil k√ºt√ºphanesi (pattern)
function generateFromPatternLibrary(style, length, scaleChords) {
  let degreeSequence = [];
  let patternName = "";
  
  if (style === "random") {
    let lastDegree = null;
    for (let i = 0; i < length; i++) {
      let d;
      let attempts = 0;
      do {
        d = Math.floor(Math.random() * scaleChords.length) + 1;
        attempts++;
      } while (d === lastDegree && scaleChords.length > 1 && attempts < 10);
      degreeSequence.push(d);
      lastDegree = d;
    }
    patternName = "Rastgele";
  } else {
    const stylePatterns = PROGRESSION_PATTERNS[style];
    
    if (stylePatterns && stylePatterns[length] && stylePatterns[length].length > 0) {
      const pattern = pickRandom(stylePatterns[length]);
      degreeSequence = [...pattern.degrees];
      patternName = pattern.name;
    } else if (stylePatterns) {
      const availableLengths = Object.keys(stylePatterns).filter(l => stylePatterns[l].length > 0);
      
      if (availableLengths.length > 0) {
        const targetLen = length;
        let closestLen = availableLengths[0];
        let minDiff = Math.abs(parseInt(closestLen) - targetLen);
        
        availableLengths.forEach(l => {
          const diff = Math.abs(parseInt(l) - targetLen);
          if (diff < minDiff) {
            minDiff = diff;
            closestLen = l;
          }
        });
        
        const pattern = pickRandom(stylePatterns[closestLen]);
        const baseSequence = [...pattern.degrees];
        patternName = pattern.name;
        
        if (baseSequence.length < targetLen) {
          while (degreeSequence.length < targetLen) {
            degreeSequence = degreeSequence.concat(baseSequence);
          }
          degreeSequence = degreeSequence.slice(0, targetLen);
        } else {
          degreeSequence = baseSequence.slice(0, targetLen);
        }
      } else {
        degreeSequence = [1, 4, 5, 1];
        patternName = "Temel";
      }
    } else {
      degreeSequence = [1, 4, 5, 1];
      patternName = "Temel";
    }
  }
  
  return { degrees: degreeSequence, name: patternName };
}

// Borrowed (√∂d√ºn√ß) akor olu≈ütur
function createBorrowedChord(chordSymbol, key, scaleType) {
  const rootIndex = NOTES_SHARP.indexOf(key);
  
  // Borrowed chord mapping
  const borrowedIntervals = {
    'bVII': { interval: 10, quality: 'maj', suffix: '' },    // b7
    'bVI': { interval: 8, quality: 'maj', suffix: '' },      // b6
    'bIII': { interval: 3, quality: 'maj', suffix: '' },     // b3
    'iv': { interval: 5, quality: 'min', suffix: 'm' },      // 4 minor
    'bII': { interval: 1, quality: 'maj', suffix: '' },      // Neapolitan
  };
  
  // Secondary dominant (V/X formatƒ±)
  if (chordSymbol.startsWith('V/')) {
    const target = parseInt(chordSymbol.split('/')[1]);
    // V/ii = VI dominant, V/iii = VII dominant, etc.
    const targetRoot = NOTES_SHARP[(rootIndex + [0, 0, 2, 4, 5, 7, 9, 11][target]) % 12];
    const dominantRoot = NOTES_SHARP[(NOTES_SHARP.indexOf(targetRoot) + 7) % 12];
    return {
      degree: chordSymbol,
      name: dominantRoot + '7',
      root: dominantRoot,
      quality: 'dom7',
      suffix: '7',
      borrowed: true
    };
  }
  
  const borrowed = borrowedIntervals[chordSymbol];
  if (borrowed) {
    const chordRoot = NOTES_SHARP[(rootIndex + borrowed.interval) % 12];
    return {
      degree: chordSymbol,
      name: chordRoot + borrowed.suffix,
      root: chordRoot,
      quality: borrowed.quality,
      suffix: borrowed.suffix,
      borrowed: true
    };
  }
  
  // Fallback
  return { degree: 1, name: key, root: key, quality: 'maj', suffix: '' };
}

// Pattern adƒ± i√ßin global deƒüi≈üken
let currentPatternName = "";

function updateChordDisplay() {
  const container = document.getElementById("chordsContainer");
  
  if (currentChords.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üéπ</div><p>Akor dizisi √ºretmek i√ßin butona tƒ±klayƒ±n</p></div>`;
    return;
  }
  
  container.innerHTML = currentChords.map((chord, idx) => {
    const notes = getChordNoteNames(chord.name);
    return `
      <div class="chord-chip" data-index="${idx}" data-quality="${chord.quality}">
        <span class="chord-index">${idx + 1}</span>
        <span class="chord-name">${chord.name}</span>
        <span class="chord-roman">${romanNumeral(chord.degree, chord.quality)}</span>
        <span class="chord-notes-mini">${notes.join("-")}</span>
      </div>
    `;
  }).join("");
  
  // Roma rakamlarƒ±
  document.getElementById("romanLine").textContent = 
    currentChords.map(ch => romanNumeral(ch.degree, ch.quality)).join("  ‚Äî  ");
  
  // Event listeners
  container.querySelectorAll(".chord-chip").forEach(chip => {
    chip.addEventListener("click", () => {
      const idx = parseInt(chip.dataset.index);
      selectChord(idx);
      playChord(currentChords[idx].name, 1.0);
    });
  });
}

function selectChord(index) {
  document.querySelectorAll(".chord-chip").forEach(c => c.classList.remove("active"));
  const chips = document.querySelectorAll(".chord-chip");
  if (chips[index]) chips[index].classList.add("active");
  
  currentChordIndex = index;
  const chord = currentChords[index];
  if (chord) {
    highlightPiano(chord.name);
    updateCurrentChordInfo(chord.name);
  }
}

function highlightPlayingChord(index) {
  document.querySelectorAll(".chord-chip").forEach(c => c.classList.remove("playing"));
  const chips = document.querySelectorAll(".chord-chip");
  if (chips[index]) chips[index].classList.add("playing");
}

function updateTags(key, scaleType, style, patternName = "") {
  document.getElementById("tagKey").textContent = key;
  const scaleNames = { major: "Major", naturalMinor: "Minor", harmonicMinor: "Harm.Min", dorian: "Dorian", phrygian: "Phrygian", lydian: "Lydian", mixolydian: "Mixo", pentatonicMajor: "Penta", blues: "Blues" };
  document.getElementById("tagScale").textContent = scaleNames[scaleType] || scaleType;
  const styleNames = { pop: "Pop", rock: "Rock", jazz: "Jazz", blues: "Blues", ballad: "Ballad", edm: "EDM", latin: "Latin", rnb: "R&B", classical: "Classical", funk: "Funk", country: "Country", gospel: "Gospel", world: "World", random: "Random" };
  
  // Stil + Pattern adƒ±
  const styleName = styleNames[style] || style;
  document.getElementById("tagStyle").textContent = patternName ? `${styleName}: ${patternName}` : styleName;
}

function updateCurrentChordInfo(chordName) {
  document.getElementById("currentChordName").textContent = chordName;
  document.getElementById("currentChordNotes").textContent = getChordNoteNames(chordName).join(" - ");
}

// === Pƒ∞YANO ===

function highlightPiano(chordName) {
  document.querySelectorAll(".piano-key").forEach(k => k.classList.remove("active"));
  const notes = getChordNoteNames(chordName);
  
  // Mevcut piyano oktavlarƒ±na g√∂re highlight
  document.querySelectorAll(".piano-key").forEach(k => {
    const keyOctave = parseInt(k.dataset.octave);
    // Piyano g√∂sterilen oktavlardaki notalarƒ± highlight et
    if (notes.includes(k.dataset.note) && (keyOctave === currentOctave || keyOctave === currentOctave + 1)) {
      k.classList.add("active");
    }
  });
}

function clearPianoHighlight() {
  document.querySelectorAll(".piano-key").forEach(k => k.classList.remove("active", "hint", "correct-hit", "wrong-hit"));
}

// === PLAYBACK ===

// Master timing system - tek clock ile her ≈üeyi kontrol
let masterInterval = null;
let tickCount = 0;
let ticksPerBeat = 4; // Her beat'te 4 tick (16'lƒ±k notalar i√ßin)

// Ritmik fig√ºrler (Comping Patterns) - her akorun beat cinsinden s√ºresi
// Toplam her zaman 4 veya 8 beat (1 veya 2 √∂l√ß√º) olmalƒ±
const COMPING_PATTERNS = {
  straight: {
    name: "Straight",
    // Her akor 4 beat
    pattern: [4, 4, 4, 4, 4, 4, 4, 4]
  },
  half: {
    name: "Half Notes",
    // Her akor 2 beat
    pattern: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
  },
  charleston: {
    name: "Charleston",
    // 3+1 pattern (dotted quarter + eighth)
    pattern: [3, 1, 3, 1, 3, 1, 3, 1]
  },
  anticipation: {
    name: "Anticipation",
    // Akor bir beat erken girer
    pattern: [3.5, 4, 4, 4.5]
  },
  syncopated: {
    name: "Syncopated",
    // Offbeat vurgulu
    pattern: [1.5, 2.5, 1.5, 2.5, 1.5, 2.5, 1.5, 2.5]
  },
  bossaNova: {
    name: "Bossa Nova",
    // Klasik bossa pattern
    pattern: [3, 3, 2, 3, 3, 2]
  },
  shuffle: {
    name: "Shuffle",
    // √ú√ßleme hissi (2.67 + 1.33)
    pattern: [2.67, 1.33, 2.67, 1.33, 2.67, 1.33]
  },
  reggae: {
    name: "Reggae/Ska",
    // Offbeat vurgulu
    pattern: [0.5, 1.5, 0.5, 1.5, 0.5, 1.5, 0.5, 1.5]
  },
  waltz: {
    name: "Waltz (3/4)",
    // 3 beat pattern
    pattern: [3, 3, 3, 3, 3, 3, 3, 3]
  },
  latin: {
    name: "Latin Montuno",
    // Clave-based
    pattern: [1.5, 1, 1.5, 1.5, 1, 1.5]
  },
  ballad: {
    name: "Ballad",
    // Uzun + kƒ±sa
    pattern: [6, 2, 6, 2]
  },
  funk: {
    name: "Funk",
    // Kesik kesik
    pattern: [0.5, 0.5, 1, 0.5, 0.5, 1, 0.5, 0.5, 1, 0.5, 0.5, 1]
  },
  rockPower: {
    name: "Rock Power",
    // G√º√ßl√º downbeat
    pattern: [1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2]
  },
  jazzSwing: {
    name: "Jazz Swing",
    // Swing comping
    pattern: [2, 2, 1, 3, 2, 2, 1, 3]
  }
};

// Mevcut comping pattern
let currentCompingPattern = "straight";
let compingIndex = 0;
let ticksUntilNextChord = 0;
let rhythmEnabled = true; // Ritim a√ßƒ±k/kapalƒ±

function getMsPerTick() {
  return (60000 / tempo) / ticksPerBeat;
}

function getCompingPattern() {
  return COMPING_PATTERNS[currentCompingPattern] || COMPING_PATTERNS.straight;
}

function startPlayback() {
  if (currentChords.length === 0) return;
  if (isPlaying) {
    stopPlayback();
    return;
  }
  
  isPlaying = true;
  tickCount = 0;
  currentChordIndex = 0;
  currentSubdivision = -1;
  compingIndex = 0;
  updatePlayButton();
  
  // Ritim pattern'ini al
  currentRhythmPattern = getCurrentRhythm();
  updateRhythmDisplay();
  
  // Bass line'ƒ± yeniden hesapla (mevcut akorlar i√ßin)
  if (bassLineEnabled && currentChords.length > 0) {
    const style = document.getElementById("styleSelect")?.value || "pop";
    currentBassPattern = getStyleBasedBassPattern(style);
    calculateBassLine(currentChords, currentBassPattern);
  }
  
  // Metronom butonunu aktif yap (eƒüer ritim a√ßƒ±ksa)
  if (rhythmEnabled) {
    metronomeOn = true;
    document.getElementById("metronomeBtn").classList.add("active");
  }
  
  // ƒ∞lk akorun s√ºresini hesapla - COMPING PATTERN'DEN
  const compPattern = getCompingPattern();
  const firstDuration = compPattern.pattern[0];
  ticksUntilNextChord = Math.round(firstDuration * ticksPerBeat);
  
  // ƒ∞lk akoru hemen √ßal
  const firstChord = currentChords[0];
  const durationMs = (firstDuration * 60000 / tempo) * 0.85;
  playChord(firstChord.name, durationMs / 1000);
  selectChord(0);
  highlightPlayingChord(0);
  updateProgress();
  
  // ƒ∞lk bass notasƒ±nƒ± √ßal
  if (bassLineEnabled) {
    playBassAtTick(0, 0);
  }
  
  // ƒ∞lk ritim vuru≈üunu √ßal (eƒüer a√ßƒ±ksa)
  if (rhythmEnabled) {
    playRhythmAtTick(0);
  }
  
  // Master tick ba≈ülat
  const msPerTick = getMsPerTick();
  tickCount = 1;
  
  masterInterval = setInterval(() => {
    // Bass line (master clock ile senkronize)
    if (bassLineEnabled) {
      playBassAtTick(tickCount, currentChordIndex);
    }
    
    // Ritim vuru≈üu (eƒüer a√ßƒ±ksa)
    if (rhythmEnabled) {
      playRhythmAtTick(tickCount);
    }
    
    // Akor deƒüi≈üimi kontrol√º
    ticksUntilNextChord--;
    
    if (ticksUntilNextChord <= 0) {
      currentChordIndex++;
      compingIndex++;
      
      // Comping pattern'i d√∂ng√ºye al
      const compPattern = getCompingPattern();
      if (compingIndex >= compPattern.pattern.length) {
        compingIndex = 0;
      }
      
      if (currentChordIndex >= currentChords.length) {
        if (isLooping) {
          currentChordIndex = 0;
          compingIndex = 0;
        } else {
          stopPlayback();
          return;
        }
      }
      
      // Sonraki akorun s√ºresini COMPING PATTERN'DEN al
      const nextDuration = compPattern.pattern[compingIndex];
      ticksUntilNextChord = Math.round(nextDuration * ticksPerBeat);
      
      const chord = currentChords[currentChordIndex];
      const durationMs = (nextDuration * 60000 / tempo) * 0.85;
      playChord(chord.name, durationMs / 1000);
      selectChord(currentChordIndex);
      highlightPlayingChord(currentChordIndex);
      updateProgress();
    }
    
    tickCount++;
  }, msPerTick);
}

function playRhythmAtTick(tick) {
  if (!currentRhythmPattern) return;
  
  const subdivisions = currentRhythmPattern.subdivisions;
  // Her √∂l√ß√º 16 tick (4 beat * 4 tick/beat)
  const ticksPerMeasure = 16;
  const tickInMeasure = tick % ticksPerMeasure;
  
  // Subdivision index hesapla
  const subdivisionIndex = Math.floor(tickInMeasure * subdivisions / ticksPerMeasure);
  
  // Sadece subdivision deƒüi≈ütiƒüinde ses √ßal
  if (subdivisionIndex !== currentSubdivision || tick === 0) {
    currentSubdivision = subdivisionIndex;
    
    const velocity = currentRhythmPattern.pattern[subdivisionIndex];
    const sound = currentRhythmPattern.sounds[subdivisionIndex];
    
    if (velocity > 0 && sound) {
      playDrumSound(sound, velocity);
    }
    
    updateMetronomeVisualAdvanced(subdivisionIndex, subdivisions);
  }
}

function stopPlayback() {
  isPlaying = false;
  metronomeOn = false;
  
  if (masterInterval) {
    clearInterval(masterInterval);
    masterInterval = null;
  }
  
  tickCount = 0;
  currentChordIndex = 0;
  currentSubdivision = 0;
  
  updatePlayButton();
  updateProgress();
  document.getElementById("metronomeBtn").classList.remove("active");
  document.querySelectorAll(".chord-chip").forEach(c => c.classList.remove("playing"));
  document.querySelectorAll(".beat-dot").forEach(d => d.classList.remove("active", "accent"));
}

function togglePlayback() {
  if (isPlaying) {
    stopPlayback();
  } else {
    if (currentChords.length === 0) {
      generateChordProgression();
    }
    // Metronom butonunu aktif yap (Play ile birlikte √ßalacak)
    metronomeOn = true;
    document.getElementById("metronomeBtn").classList.add("active");
    startPlayback();
  }
}

function toggleLoop() {
  isLooping = !isLooping;
  document.getElementById("loopBtn").classList.toggle("active", isLooping);
}

function updatePlayButton() {
  const btn = document.getElementById("playBtn");
  btn.textContent = isPlaying ? "‚è∏" : "‚ñ∂";
  btn.classList.toggle("playing", isPlaying);
}

function updateProgress() {
  const fill = document.getElementById("progressFill");
  const numEl = document.getElementById("currentChordNum");
  const timeEl = document.getElementById("currentTime");
  
  if (currentChords.length === 0) {
    fill.style.width = "0%";
    numEl.textContent = "Akor 0/0";
    timeEl.textContent = "0:00";
    return;
  }
  
  const progress = (currentChordIndex / currentChords.length) * 100;
  fill.style.width = `${Math.min(progress, 100)}%`;
  numEl.textContent = `Akor ${Math.min(currentChordIndex + 1, currentChords.length)}/${currentChords.length}`;
  
  const totalMs = currentChords.length * getChordDuration();
  const currentMs = currentChordIndex * getChordDuration();
  const formatTime = (ms) => {
    const s = Math.floor(ms / 1000);
    return `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, "0")}`;
  };
  timeEl.textContent = `${formatTime(currentMs)} / ${formatTime(totalMs)}`;
}

// === METRONOM ===

// Her stil i√ßin birden fazla ritim
const STYLE_RHYTHMS = {
  pop: [
    { name: "Standard Pop", subdivisions: 8, pattern: [1.0, 0.3, 0.7, 0.3, 0.8, 0.3, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Pop Ballad", subdivisions: 8, pattern: [0.8, 0.2, 0.6, 0.2, 0.7, 0.2, 0.6, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Disco Pop", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 1.0, 0.5, 0.9, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Synth Pop", subdivisions: 16, pattern: [1.0, 0.2, 0.4, 0.2, 0.8, 0.2, 0.4, 0.3, 0.9, 0.2, 0.4, 0.2, 0.8, 0.2, 0.4, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Teen Pop", subdivisions: 8, pattern: [1.0, 0.3, 0.8, 0.3, 1.0, 0.3, 0.8, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Dance Pop", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.8, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.9, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Power Pop", subdivisions: 8, pattern: [1.0, 0.5, 1.0, 0.5, 1.0, 0.5, 1.0, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Motown", subdivisions: 8, pattern: [0.9, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Acoustic", subdivisions: 8, pattern: [0.7, 0.3, 0.5, 0.3, 0.6, 0.3, 0.5, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  rock: [
    { name: "Standard Rock", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 0.8, 0.6, 1.0, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'kick', 'snare', 'hihat'] },
    { name: "Hard Rock", subdivisions: 8, pattern: [1.0, 0.6, 1.0, 0.6, 1.0, 0.6, 1.0, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Punk", subdivisions: 8, pattern: [1.0, 0.7, 1.0, 0.7, 1.0, 0.7, 1.0, 0.7], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metal", subdivisions: 16, pattern: [1.0, 0.5, 0.5, 0.5, 1.0, 0.5, 1.0, 0.5, 1.0, 0.5, 0.5, 0.5, 1.0, 0.5, 1.0, 0.6], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Classic Rock", subdivisions: 8, pattern: [1.0, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Alternative", subdivisions: 8, pattern: [0.9, 0.3, 0.8, 0.3, 0.7, 0.4, 0.8, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Grunge", subdivisions: 8, pattern: [1.0, 0.3, 0.9, 0.3, 0.8, 0.3, 0.9, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'kick', 'snare', 'hihat'] },
    { name: "Arena Rock", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 1.0, 0.5, 0.9, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Indie", subdivisions: 8, pattern: [0.8, 0.4, 0.7, 0.4, 0.8, 0.4, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  jazz: [
    { name: "Swing", subdivisions: 12, pattern: [0.8, 0, 0.4, 0.6, 0, 0.5, 0.7, 0, 0.4, 0.6, 0, 0.6], sounds: ['ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'hihat'] },
    { name: "Bebop", subdivisions: 12, pattern: [0.9, 0, 0.5, 0.7, 0, 0.5, 0.8, 0, 0.5, 0.7, 0, 0.6], sounds: ['ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'hihat'] },
    { name: "Cool Jazz", subdivisions: 12, pattern: [0.6, 0, 0.3, 0.5, 0, 0.3, 0.5, 0, 0.3, 0.5, 0, 0.4], sounds: ['ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'ride', 'ride', null, 'hihat'] },
    { name: "Bossa Nova", subdivisions: 8, pattern: [0.8, 0, 0.5, 0.6, 0, 0.5, 0.7, 0], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null] },
    { name: "Latin Jazz", subdivisions: 8, pattern: [1.0, 0, 0.8, 0, 0.7, 0.8, 0, 0.7], sounds: ['clave', null, 'clave', null, 'clave', 'clave', null, 'clave'] },
    { name: "Jazz Waltz", subdivisions: 6, pattern: [0.9, 0.4, 0.5, 0.7, 0.4, 0.5], sounds: ['ride', 'hihat', 'hihat', 'ride', 'hihat', 'hihat'] },
    { name: "Straight Ahead", subdivisions: 8, pattern: [0.8, 0.3, 0.6, 0.3, 0.7, 0.3, 0.6, 0.4], sounds: ['ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat'] },
    { name: "Ballad", subdivisions: 8, pattern: [0.5, 0.2, 0.4, 0.2, 0.5, 0.2, 0.4, 0.3], sounds: ['ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat'] },
    { name: "Fusion", subdivisions: 16, pattern: [0.9, 0.3, 0.5, 0.3, 0.8, 0.3, 0.5, 0.4, 0.8, 0.3, 0.5, 0.3, 0.7, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  blues: [
    { name: "Shuffle", subdivisions: 12, pattern: [1.0, 0, 0.4, 0.7, 0, 0.4, 0.6, 0, 0.4, 0.9, 0, 0.5], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat'] },
    { name: "Slow Blues", subdivisions: 12, pattern: [0.8, 0, 0.3, 0.6, 0, 0.3, 0.5, 0, 0.3, 0.7, 0, 0.4], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat'] },
    { name: "Chicago", subdivisions: 12, pattern: [1.0, 0, 0.5, 0.8, 0, 0.5, 0.7, 0, 0.5, 0.9, 0, 0.6], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat'] },
    { name: "Texas", subdivisions: 8, pattern: [1.0, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Delta", subdivisions: 8, pattern: [0.7, 0.3, 0.5, 0.3, 0.6, 0.3, 0.5, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Jump Blues", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 1.0, 0.5, 0.9, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Boogie", subdivisions: 8, pattern: [1.0, 0.6, 0.8, 0.6, 1.0, 0.6, 0.8, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Funky Blues", subdivisions: 16, pattern: [1.0, 0.3, 0.4, 0.3, 0.8, 0.4, 0.5, 0.3, 0.9, 0.3, 0.4, 0.4, 0.8, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Blues Rock", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 0.8, 0.6, 0.9, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'kick', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  ballad: [
    { name: "Slow Ballad", subdivisions: 8, pattern: [0.6, 0, 0.4, 0.2, 0.5, 0.2, 0.4, 0], sounds: ['kick', null, 'snare', 'hihat', 'kick', 'hihat', 'snare', null] },
    { name: "Power Ballad", subdivisions: 8, pattern: [0.8, 0.3, 0.7, 0.3, 0.7, 0.3, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Acoustic", subdivisions: 8, pattern: [0.5, 0.2, 0.4, 0.2, 0.5, 0.2, 0.4, 0.2], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Pop Ballad", subdivisions: 8, pattern: [0.7, 0.2, 0.5, 0.2, 0.6, 0.2, 0.5, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "R&B Ballad", subdivisions: 16, pattern: [0.6, 0.2, 0.3, 0.2, 0.5, 0.2, 0.3, 0.2, 0.5, 0.2, 0.3, 0.2, 0.5, 0.2, 0.4, 0.2], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Soul Ballad", subdivisions: 8, pattern: [0.7, 0.3, 0.6, 0.3, 0.7, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Jazz Ballad", subdivisions: 8, pattern: [0.4, 0.2, 0.3, 0.2, 0.4, 0.2, 0.3, 0.2], sounds: ['ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat', 'ride', 'hihat'] },
    { name: "6/8 Ballad", subdivisions: 6, pattern: [0.7, 0.3, 0.4, 0.6, 0.3, 0.4], sounds: ['kick', 'hihat', 'hihat', 'snare', 'hihat', 'hihat'] },
    { name: "Country Ballad", subdivisions: 8, pattern: [0.6, 0.3, 0.5, 0.3, 0.6, 0.3, 0.5, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  edm: [
    { name: "Four-on-Floor", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.9, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 1.0, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "House", subdivisions: 16, pattern: [1.0, 0.2, 0.4, 0.2, 1.0, 0.2, 0.4, 0.3, 1.0, 0.2, 0.4, 0.2, 1.0, 0.2, 0.4, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat'] },
    { name: "Trance", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.8, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.9, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Dubstep", subdivisions: 16, pattern: [1.0, 0.2, 0.3, 0.2, 0, 0.2, 1.0, 0.3, 0.5, 0.2, 0.3, 0.2, 0.8, 0.2, 0.9, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', null, 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Techno", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.5, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat'] },
    { name: "Progressive", subdivisions: 16, pattern: [1.0, 0.2, 0.4, 0.2, 1.0, 0.2, 0.7, 0.2, 1.0, 0.2, 0.4, 0.2, 1.0, 0.2, 0.8, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Trap", subdivisions: 16, pattern: [1.0, 0.2, 0.3, 0.2, 0, 0.3, 0.9, 0.2, 0.5, 0.3, 0.4, 0.3, 0.8, 0.3, 0.5, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', null, 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat'] },
    { name: "Big Room", subdivisions: 16, pattern: [1.0, 0.4, 0.5, 0.4, 1.0, 0.4, 1.0, 0.4, 1.0, 0.4, 0.5, 0.4, 1.0, 0.4, 1.0, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Future Bass", subdivisions: 16, pattern: [1.0, 0.2, 0.3, 0.2, 0.8, 0.3, 0.9, 0.2, 0.7, 0.2, 0.3, 0.3, 0.8, 0.2, 1.0, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  latin: [
    { name: "Son Clave 3-2", subdivisions: 8, pattern: [1.0, 0, 0.8, 0, 0.7, 0.8, 0, 0.7], sounds: ['clave', null, 'clave', null, 'clave', 'clave', null, 'clave'] },
    { name: "Son Clave 2-3", subdivisions: 8, pattern: [0.8, 0, 0.7, 1.0, 0, 0.8, 0, 0.7], sounds: ['clave', null, 'clave', 'clave', null, 'clave', null, 'clave'] },
    { name: "Rumba", subdivisions: 8, pattern: [1.0, 0, 0.7, 0, 0.8, 0, 0.7, 0.8], sounds: ['clave', null, 'clave', null, 'clave', null, 'clave', 'clave'] },
    { name: "Bossa Nova", subdivisions: 8, pattern: [0.8, 0, 0.5, 0.6, 0, 0.5, 0.7, 0], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null] },
    { name: "Samba", subdivisions: 8, pattern: [0.9, 0.5, 0.7, 0.5, 0.8, 0.5, 0.7, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Salsa", subdivisions: 8, pattern: [1.0, 0.4, 0.7, 0.4, 0.8, 0.5, 0.7, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Reggaeton", subdivisions: 8, pattern: [1.0, 0.3, 0, 0.9, 0.5, 0.3, 0, 0.8], sounds: ['kick', 'hihat', null, 'snare', 'kick', 'hihat', null, 'snare'] },
    { name: "Cumbia", subdivisions: 8, pattern: [0.8, 0.4, 0.6, 0.4, 0.8, 0.4, 0.6, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Flamenco", subdivisions: 12, pattern: [1.0, 0, 0.6, 0.8, 0, 0.5, 0.7, 0, 0.6, 0.9, 0, 0.7], sounds: ['clave', null, 'clave', 'clave', null, 'clave', 'clave', null, 'clave', 'clave', null, 'clave'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  rnb: [
    { name: "Classic R&B", subdivisions: 16, pattern: [0.9, 0.2, 0.4, 0.2, 0.7, 0.3, 0.8, 0.2, 0.6, 0.2, 0.4, 0.3, 0.7, 0.2, 0.9, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Neo Soul", subdivisions: 16, pattern: [0.7, 0.2, 0.3, 0.2, 0.6, 0.2, 0.4, 0.2, 0.5, 0.2, 0.3, 0.2, 0.6, 0.2, 0.5, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Modern R&B", subdivisions: 16, pattern: [1.0, 0.2, 0.3, 0.2, 0, 0.3, 0.9, 0.2, 0.5, 0.2, 0.3, 0.3, 0.8, 0.2, 0.5, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', null, 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Slow Jam", subdivisions: 16, pattern: [0.6, 0.2, 0.3, 0.2, 0.5, 0.2, 0.4, 0.2, 0.5, 0.2, 0.3, 0.2, 0.5, 0.2, 0.4, 0.2], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Motown", subdivisions: 8, pattern: [0.9, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Soul", subdivisions: 8, pattern: [0.8, 0.3, 0.7, 0.3, 0.8, 0.3, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Funk R&B", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 0.8, 0.4, 0.6, 0.3, 0.7, 0.3, 0.5, 0.4, 0.9, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Gospel R&B", subdivisions: 8, pattern: [0.9, 0.4, 0.7, 0.4, 0.8, 0.4, 0.7, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "90s R&B", subdivisions: 16, pattern: [0.9, 0.3, 0.4, 0.3, 0.8, 0.3, 0.5, 0.3, 0.8, 0.3, 0.4, 0.3, 0.8, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  classical: [
    { name: "4/4 Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] },
    { name: "3/4 Waltz", subdivisions: 3, pattern: [1.0, 0.5, 0.5], sounds: ['click', 'click', 'click'] },
    { name: "6/8 Time", subdivisions: 6, pattern: [1.0, 0.4, 0.5, 0.7, 0.4, 0.5], sounds: ['click', 'click', 'click', 'click', 'click', 'click'] },
    { name: "2/4 March", subdivisions: 4, pattern: [1.0, 0.5, 0.8, 0.5], sounds: ['click', 'click', 'click', 'click'] },
    { name: "Cut Time", subdivisions: 2, pattern: [1.0, 0.7], sounds: ['click', 'click'] },
    { name: "5/4 Time", subdivisions: 5, pattern: [1.0, 0.5, 0.7, 0.5, 0.6], sounds: ['click', 'click', 'click', 'click', 'click'] },
    { name: "7/8 Time", subdivisions: 7, pattern: [1.0, 0.5, 0.6, 0.8, 0.5, 0.6, 0.5], sounds: ['click', 'click', 'click', 'click', 'click', 'click', 'click'] },
    { name: "12/8 Compound", subdivisions: 12, pattern: [1.0, 0.3, 0.4, 0.7, 0.3, 0.4, 0.8, 0.3, 0.4, 0.7, 0.3, 0.5], sounds: ['click', 'click', 'click', 'click', 'click', 'click', 'click', 'click', 'click', 'click', 'click', 'click'] },
    { name: "Orchestral", subdivisions: 8, pattern: [1.0, 0.3, 0.5, 0.3, 0.7, 0.3, 0.5, 0.4], sounds: ['click', 'click', 'click', 'click', 'click', 'click', 'click', 'click'] },
    { name: "Rubato", subdivisions: 4, pattern: [0.6, 0.4, 0.5, 0.4], sounds: ['click', 'click', 'click', 'click'] }
  ],
  funk: [
    { name: "Classic Funk", subdivisions: 16, pattern: [1.0, 0.3, 0.6, 0.3, 0.8, 0.4, 0.7, 0.3, 0.5, 0.3, 0.6, 0.4, 0.9, 0.3, 0.7, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "James Brown", subdivisions: 16, pattern: [1.0, 0.4, 0.5, 0.4, 0.9, 0.4, 0.6, 0.4, 0.8, 0.4, 0.5, 0.4, 1.0, 0.4, 0.7, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "P-Funk", subdivisions: 16, pattern: [1.0, 0.3, 0.4, 0.3, 0.7, 0.4, 0.8, 0.3, 0.6, 0.3, 0.4, 0.4, 0.8, 0.3, 0.9, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Disco", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 1.0, 0.5, 0.9, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Slap Funk", subdivisions: 16, pattern: [1.0, 0.2, 0.5, 0.3, 0.8, 0.3, 0.6, 0.2, 0.7, 0.2, 0.5, 0.3, 0.9, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "New Orleans", subdivisions: 16, pattern: [0.9, 0.4, 0.5, 0.4, 0.8, 0.5, 0.6, 0.4, 0.7, 0.4, 0.5, 0.5, 0.8, 0.4, 0.7, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Funky Drummer", subdivisions: 16, pattern: [1.0, 0.3, 0.4, 0.4, 0.8, 0.3, 0.5, 0.4, 0.7, 0.3, 0.4, 0.5, 0.9, 0.3, 0.6, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat'] },
    { name: "Breakbeat", subdivisions: 16, pattern: [1.0, 0.3, 0.4, 0.3, 0, 0.3, 0.9, 0.3, 0.6, 0.4, 0.5, 0.3, 0.8, 0.3, 0.5, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', null, 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Modern Funk", subdivisions: 16, pattern: [1.0, 0.2, 0.4, 0.2, 0.8, 0.3, 0.5, 0.2, 0.7, 0.2, 0.4, 0.3, 0.9, 0.2, 0.6, 0.3], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  country: [
    { name: "Two Step", subdivisions: 8, pattern: [1.0, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Train Beat", subdivisions: 16, pattern: [0.9, 0.4, 0.5, 0.4, 0.8, 0.4, 0.5, 0.4, 0.9, 0.4, 0.5, 0.4, 0.8, 0.4, 0.5, 0.5], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Honky Tonk", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 1.0, 0.5, 0.9, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Country Waltz", subdivisions: 6, pattern: [1.0, 0.4, 0.5, 0.8, 0.4, 0.5], sounds: ['kick', 'hihat', 'hihat', 'snare', 'hihat', 'hihat'] },
    { name: "Country Rock", subdivisions: 8, pattern: [1.0, 0.5, 0.9, 0.5, 0.8, 0.6, 0.9, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'kick', 'snare', 'hihat'] },
    { name: "Bluegrass", subdivisions: 8, pattern: [0.8, 0.5, 0.7, 0.5, 0.8, 0.5, 0.7, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Shuffle", subdivisions: 12, pattern: [0.9, 0, 0.4, 0.7, 0, 0.4, 0.8, 0, 0.4, 0.7, 0, 0.5], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat'] },
    { name: "Boom Chick", subdivisions: 4, pattern: [1.0, 0.7, 0.9, 0.7], sounds: ['kick', 'snare', 'kick', 'snare'] },
    { name: "Country Pop", subdivisions: 8, pattern: [0.9, 0.3, 0.7, 0.3, 0.8, 0.3, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  gospel: [
    { name: "Traditional", subdivisions: 8, pattern: [1.0, 0.4, 0.8, 0.4, 0.9, 0.4, 0.8, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Shuffle", subdivisions: 12, pattern: [0.9, 0, 0.4, 0.8, 0, 0.4, 0.7, 0, 0.4, 0.9, 0, 0.5], sounds: ['kick', null, 'hihat', 'snare', null, 'hihat', 'kick', null, 'hihat', 'snare', null, 'hihat'] },
    { name: "Contemporary", subdivisions: 16, pattern: [1.0, 0.3, 0.4, 0.3, 0.8, 0.3, 0.5, 0.3, 0.9, 0.3, 0.4, 0.3, 0.8, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Gospel Waltz", subdivisions: 6, pattern: [0.9, 0.4, 0.5, 0.8, 0.4, 0.5], sounds: ['kick', 'hihat', 'hihat', 'snare', 'hihat', 'hihat'] },
    { name: "Praise", subdivisions: 8, pattern: [0.8, 0.3, 0.6, 0.3, 0.7, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Southern", subdivisions: 8, pattern: [0.9, 0.5, 0.8, 0.5, 0.9, 0.5, 0.8, 0.6], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Shout", subdivisions: 8, pattern: [1.0, 0.6, 1.0, 0.6, 1.0, 0.6, 1.0, 0.7], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Ballad", subdivisions: 8, pattern: [0.6, 0.2, 0.5, 0.2, 0.6, 0.2, 0.5, 0.3], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "CCM", subdivisions: 8, pattern: [0.8, 0.3, 0.7, 0.3, 0.8, 0.3, 0.7, 0.4], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  world: [
    { name: "Afrobeat", subdivisions: 16, pattern: [1.0, 0.3, 0.5, 0.3, 0.7, 0.4, 0.6, 0.3, 0.8, 0.3, 0.5, 0.4, 0.7, 0.3, 0.6, 0.4], sounds: ['kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'kick', 'hihat', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Reggae", subdivisions: 8, pattern: [0, 0.4, 0.8, 0.4, 0, 0.4, 0.8, 0.5], sounds: [null, 'hihat', 'snare', 'hihat', null, 'hihat', 'snare', 'hihat'] },
    { name: "Ska", subdivisions: 8, pattern: [0, 0.7, 0.9, 0.7, 0, 0.7, 0.9, 0.8], sounds: [null, 'hihat', 'snare', 'hihat', null, 'hihat', 'snare', 'hihat'] },
    { name: "Middle Eastern", subdivisions: 8, pattern: [1.0, 0, 0.7, 0, 0.5, 0.8, 0, 0.6], sounds: ['kick', null, 'clave', null, 'kick', 'clave', null, 'clave'] },
    { name: "Indian", subdivisions: 8, pattern: [1.0, 0.4, 0.6, 0.4, 0.8, 0.4, 0.6, 0.5], sounds: ['kick', 'clave', 'clave', 'clave', 'kick', 'clave', 'clave', 'clave'] },
    { name: "African 6/8", subdivisions: 6, pattern: [1.0, 0.4, 0.6, 0.8, 0.4, 0.6], sounds: ['kick', 'hihat', 'hihat', 'snare', 'hihat', 'hihat'] },
    { name: "Celtic", subdivisions: 8, pattern: [0.9, 0.4, 0.7, 0.4, 0.8, 0.4, 0.7, 0.5], sounds: ['kick', 'hihat', 'snare', 'hihat', 'kick', 'hihat', 'snare', 'hihat'] },
    { name: "Balkan", subdivisions: 7, pattern: [1.0, 0.5, 0.7, 0.9, 0.5, 0.7, 0.6], sounds: ['kick', 'hihat', 'hihat', 'snare', 'hihat', 'hihat', 'hihat'] },
    { name: "Japanese", subdivisions: 8, pattern: [1.0, 0, 0.6, 0.4, 0.7, 0, 0.6, 0.5], sounds: ['kick', null, 'clave', 'hihat', 'kick', null, 'clave', 'hihat'] },
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ],
  random: [
    { name: "Metronom", subdivisions: 4, pattern: [1.0, 0.5, 0.7, 0.5], sounds: ['click', 'click', 'click', 'click'] }
  ]
};

// Her stil i√ßin mevcut ritim index'i
let styleRhythmIndex = {};
Object.keys(STYLE_RHYTHMS).forEach(style => {
  styleRhythmIndex[style] = 0;
});

// Mevcut ritim bilgisini sakla
let currentRhythmPattern = null;

function getCurrentRhythm() {
  const style = document.getElementById("styleSelect")?.value || "pop";
  const rhythms = STYLE_RHYTHMS[style] || STYLE_RHYTHMS.pop;
  const index = styleRhythmIndex[style] || 0;
  return rhythms[index];
}

function updateRhythmDisplay() {
  const rhythm = getCurrentRhythm();
  const rhythmNameEl = document.getElementById("rhythmName");
  if (rhythmNameEl && rhythm) {
    rhythmNameEl.textContent = rhythm.name;
  }
}

function nextRhythm() {
  const style = document.getElementById("styleSelect")?.value || "pop";
  const rhythms = STYLE_RHYTHMS[style] || STYLE_RHYTHMS.pop;
  styleRhythmIndex[style] = (styleRhythmIndex[style] + 1) % rhythms.length;
  updateRhythmDisplay();
  
  // Pattern'i g√ºncelle (√ßalma devam ediyorsa yeni ritim hemen uygulanƒ±r)
  currentRhythmPattern = getCurrentRhythm();
}

function prevRhythm() {
  const style = document.getElementById("styleSelect")?.value || "pop";
  const rhythms = STYLE_RHYTHMS[style] || STYLE_RHYTHMS.pop;
  styleRhythmIndex[style] = (styleRhythmIndex[style] - 1 + rhythms.length) % rhythms.length;
  updateRhythmDisplay();
  
  // Pattern'i g√ºncelle (√ßalma devam ediyorsa yeni ritim hemen uygulanƒ±r)
  currentRhythmPattern = getCurrentRhythm();
}

// Comping pattern fonksiyonlarƒ±
const compingPatternNames = Object.keys(COMPING_PATTERNS);
let currentCompingIndex = 0;

function updateCompingDisplay() {
  const pattern = COMPING_PATTERNS[currentCompingPattern];
  const compingNameEl = document.getElementById("compingName");
  if (compingNameEl && pattern) {
    compingNameEl.textContent = pattern.name;
  }
}

function nextComping() {
  currentCompingIndex = (currentCompingIndex + 1) % compingPatternNames.length;
  currentCompingPattern = compingPatternNames[currentCompingIndex];
  updateCompingDisplay();
}

function prevComping() {
  currentCompingIndex = (currentCompingIndex - 1 + compingPatternNames.length) % compingPatternNames.length;
  currentCompingPattern = compingPatternNames[currentCompingIndex];
  updateCompingDisplay();
}

// === BASS PATTERN TANIMLARI ===
const BASS_PATTERNS = {
  root: {
    name: "Root Only",
    pattern: [{ beat: 0, interval: 0 }]
  },
  rootFifth: {
    name: "Root-Fifth",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 2, interval: 7 }
    ]
  },
  walking: {
    name: "Walking Bass",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 1, interval: 4 },
      { beat: 2, interval: 7 },
      { beat: 3, interval: 5 }
    ]
  },
  latin: {
    name: "Latin/Bossa",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 1.5, interval: 7 },
      { beat: 3, interval: 0 }
    ]
  },
  rock: {
    name: "Rock/Pop",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 0, interval: 12 },
      { beat: 2, interval: 0 },
      { beat: 2, interval: 12 }
    ]
  },
  funk: {
    name: "Funk",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 0.5, interval: 0 },
      { beat: 1, interval: 7 },
      { beat: 1.5, interval: 0 },
      { beat: 2, interval: 5 },
      { beat: 2.5, interval: 7 },
      { beat: 3, interval: 0 },
      { beat: 3.5, interval: 10 }
    ]
  },
  jazz: {
    name: "Jazz Walking",
    pattern: [
      { beat: 0, interval: 0 },
      { beat: 1, interval: 2 },
      { beat: 2, interval: 4 },
      { beat: 3, interval: 6 }
    ]
  },
  ballad: {
    name: "Ballad",
    pattern: [{ beat: 0, interval: 0 }]
  },
  reggae: {
    name: "Reggae",
    pattern: [
      { beat: 0.5, interval: 0 },
      { beat: 2.5, interval: 0 }
    ]
  }
};

let currentBassPattern = "rootFifth";
let bassSequence = [];

// Bass pattern fonksiyonlarƒ±
const bassPatternNames = Object.keys(BASS_PATTERNS);
let currentBassIndex = 1; // rootFifth default

function updateBassDisplay() {
  const pattern = BASS_PATTERNS[currentBassPattern];
  const bassNameEl = document.getElementById("bassName");
  if (bassNameEl && pattern) {
    // Emoji ekle
    const emojis = {
      root: "üî¥", rootFifth: "üé∏", walking: "üö∂", latin: "üíÉ",
      rock: "üé∏", funk: "üï∫", jazz: "üé∑", ballad: "üíù", reggae: "üå¥"
    };
    const emoji = emojis[currentBassPattern] || "üé∏";
    bassNameEl.textContent = `${emoji} ${pattern.name}`;
  }
  
  // Sidebar select'i de g√ºncelle
  const bassSelect = document.getElementById("bassPatternSelect");
  const mobileBassSelect = document.getElementById("mobile_bassPatternSelect");
  if (bassSelect) bassSelect.value = currentBassPattern;
  if (mobileBassSelect) mobileBassSelect.value = currentBassPattern;
}

function nextBass() {
  currentBassIndex = (currentBassIndex + 1) % bassPatternNames.length;
  currentBassPattern = bassPatternNames[currentBassIndex];
  updateBassDisplay();
  // Bass line'ƒ± yeniden hesapla
  if (currentChords.length > 0) {
    calculateBassLine(currentChords, currentBassPattern);
  }
}

function prevBass() {
  currentBassIndex = (currentBassIndex - 1 + bassPatternNames.length) % bassPatternNames.length;
  currentBassPattern = bassPatternNames[currentBassIndex];
  updateBassDisplay();
  // Bass line'ƒ± yeniden hesapla
  if (currentChords.length > 0) {
    calculateBassLine(currentChords, currentBassPattern);
  }
}

// Ritim (metronom) a√ßma/kapama - playback'i durdurmadan
function toggleRhythm() {
  rhythmEnabled = !rhythmEnabled;
  metronomeOn = rhythmEnabled;
  
  if (rhythmEnabled) {
    document.getElementById("metronomeBtn").classList.add("active");
  } else {
    document.getElementById("metronomeBtn").classList.remove("active");
    // Beat dot'larƒ± temizle
    document.querySelectorAll(".beat-dot").forEach(d => d.classList.remove("active", "accent"));
  }
}

// Metronom butonu - ritmi a√ß/kapa
function toggleMetronome() {
  toggleRhythm();
}

// Eski fonksiyonlar (uyumluluk i√ßin)
function startMetronome() {
  rhythmEnabled = true;
  metronomeOn = true;
  document.getElementById("metronomeBtn").classList.add("active");
  
  if (!isPlaying) {
    if (currentChords.length === 0) {
      currentChords = [
        { name: "C", quality: "maj", degree: 1 },
        { name: "G", quality: "maj", degree: 5 },
        { name: "Am", quality: "min", degree: 6 },
        { name: "F", quality: "maj", degree: 4 }
      ];
      updateChordDisplay();
    }
    startPlayback();
  }
}

function stopMetronome() {
  rhythmEnabled = false;
  metronomeOn = false;
  document.getElementById("metronomeBtn").classList.remove("active");
  document.querySelectorAll(".beat-dot").forEach(d => d.classList.remove("active", "accent"));
}

function playRhythmHit(rhythmPattern, subdivision) {
  if (!rhythmPattern || !rhythmPattern.pattern || !rhythmPattern.sounds) return;
  
  const velocity = rhythmPattern.pattern[subdivision];
  const sound = rhythmPattern.sounds[subdivision];
  
  if (velocity > 0 && sound) {
    playDrumSound(sound, velocity);
  }
}

function updateMetronomeVisualAdvanced(subdivision, totalSubdivisions) {
  // 4 beat dot i√ßin subdivision'ƒ± beat'e √ßevir
  const beatIndex = Math.floor(subdivision / (totalSubdivisions / 4));
  
  document.querySelectorAll(".beat-dot").forEach((d, i) => {
    d.classList.remove("active", "accent");
    if (i === beatIndex) {
      d.classList.add("active");
      if (beatIndex === 0) d.classList.add("accent");
    }
  });
}

function updateMetronomeVisual(beat) {
  document.querySelectorAll(".beat-dot").forEach((d, i) => {
    d.classList.remove("active", "accent");
    if (i === beat) {
      d.classList.add("active");
      if (beat === 0) d.classList.add("accent");
    }
  });
}

function changeTempo(delta) {
  tempo = Math.max(40, Math.min(240, tempo + delta));
  document.getElementById("tempoDisplay").textContent = tempo;
  
  // Playback √ßalƒ±yorsa yeni tempoyla yeniden ba≈ülat
  if (isPlaying) {
    // Durdur
    if (masterInterval) {
      clearInterval(masterInterval);
      masterInterval = null;
    }
    
    // Yeni tempo ile devam et
    const msPerTick = getMsPerTick();
    
    masterInterval = setInterval(() => {
      // Ritim vuru≈üu (eƒüer a√ßƒ±ksa)
      if (rhythmEnabled) {
        playRhythmAtTick(tickCount);
      }
      
      // Akor deƒüi≈üimi kontrol√º
      ticksUntilNextChord--;
      
      if (ticksUntilNextChord <= 0) {
        currentChordIndex++;
        compingIndex++;
        
        const compPattern = getCompingPattern();
        if (compingIndex >= compPattern.pattern.length) {
          compingIndex = 0;
        }
        
        if (currentChordIndex >= currentChords.length) {
          if (isLooping) {
            currentChordIndex = 0;
            compingIndex = 0;
          } else {
            stopPlayback();
            return;
          }
        }
        
        const nextDuration = compPattern.pattern[compingIndex];
        ticksUntilNextChord = Math.round(nextDuration * ticksPerBeat);
        
        const chord = currentChords[currentChordIndex];
        const durationMs = (nextDuration * 60000 / tempo) * 0.85;
        playChord(chord.name, durationMs / 1000);
        selectChord(currentChordIndex);
        highlightPlayingChord(currentChordIndex);
        updateProgress();
      }
      
      tickCount++;
    }, msPerTick);
  }
}

// === PRESET ===

function applyPreset(presetId) {
  const preset = PRESETS[presetId];
  if (!preset) return;
  
  document.getElementById("keySelect").value = preset.key;
  document.getElementById("scaleSelect").value = preset.scale;
  if (preset.chordType) document.getElementById("chordTypeSelect").value = preset.chordType;
  
  const scaleChords = buildScaleChords(preset.key, preset.scale, preset.chordType || "triads");
  currentChords = preset.degrees.map(d => {
    const adj = ((d - 1) % scaleChords.length) + 1;
    return { ...scaleChords[adj - 1], degree: adj };
  });
  
  updateChordDisplay();
  updateTags(preset.key, preset.scale, "preset");
  document.getElementById("tagStyle").textContent = preset.name;
  
  if (currentChords.length > 0) selectChord(0);
}

// === ≈ûARKI K√úT√úPHANESƒ∞ FONKSƒ∞YONLARI ===

function loadSongList(genre) {
  const songs = FAMOUS_SONGS[genre] || [];
  const songListContainer = document.getElementById("songList");
  const mobileSongList = document.getElementById("mobile_songList");
  
  const html = songs.map((song, index) => `
    <div class="song-item" data-genre="${genre}" data-index="${index}">
      <div class="song-item-name">${song.name}</div>
      <div class="song-item-info">
        <span class="song-item-key">üéπ ${song.key}</span>
        <span class="song-item-tempo">‚ô© ${song.tempo} BPM</span>
        <span class="song-item-chords">${song.chords.slice(0, 4).join(" - ")}${song.chords.length > 4 ? '...' : ''}</span>
      </div>
    </div>
  `).join('');
  
  if (songListContainer) songListContainer.innerHTML = html;
  if (mobileSongList) mobileSongList.innerHTML = html;
  
  // Event listener'larƒ± ekle
  document.querySelectorAll('.song-item').forEach(item => {
    item.addEventListener('click', () => {
      const genre = item.dataset.genre;
      const index = parseInt(item.dataset.index);
      selectSong(genre, index);
    });
  });
}

function selectSong(genre, index) {
  const song = FAMOUS_SONGS[genre]?.[index];
  if (!song) return;
  
  currentSong = song;
  currentStyle = genre;
  
  // Aktif ≈üarkƒ±yƒ± i≈üaretle
  document.querySelectorAll('.song-item').forEach(item => item.classList.remove('active'));
  document.querySelectorAll(`.song-item[data-genre="${genre}"][data-index="${index}"]`).forEach(item => {
    item.classList.add('active');
  });
  
  // ≈ûarkƒ± akorlarƒ±nƒ± geni≈ület (tipik ≈üarkƒ± yapƒ±sƒ±: verse-verse-chorus-verse-chorus)
  // Temel akorlarƒ± 3 kez tekrar et = tam bir ≈üarkƒ± yapƒ±sƒ±
  const baseChords = song.chords;
  let expandedChords = [];
  
  // ≈ûarkƒ± uzunluƒüuna g√∂re tekrar sayƒ±sƒ±
  const repeatCount = baseChords.length <= 4 ? 4 : (baseChords.length <= 8 ? 2 : 1);
  
  for (let i = 0; i < repeatCount; i++) {
    expandedChords = expandedChords.concat(baseChords);
  }
  
  // Akorlarƒ± y√ºkle
  currentChords = expandedChords.map((chordName, idx) => {
    return {
      name: chordName,
      root: parseChordName(chordName)?.root || chordName[0],
      quality: getChordQuality(chordName),
      degree: idx + 1,
      section: getSectionName(idx, baseChords.length, repeatCount)
    };
  });
  
  // Tempo'yu ayarla
  tempo = song.tempo;
  document.getElementById("tempoDisplay").textContent = tempo;
  
  // Stil se√ßicisini g√ºncelle
  const styleSelect = document.getElementById("styleSelect");
  if (styleSelect) styleSelect.value = genre;
  const mobileStyleSelect = document.getElementById("mobile_styleSelect");
  if (mobileStyleSelect) mobileStyleSelect.value = genre;
  
  // Ritim display'ini g√ºncelle
  updateRhythmDisplay();
  
  // Akor display'ini g√ºncelle
  updateSongChordDisplay();
  
  // Tag'leri g√ºncelle
  document.getElementById("tagKey").textContent = song.key;
  document.getElementById("tagScale").textContent = `${currentChords.length} akor`;
  document.getElementById("tagStyle").textContent = song.name.split(" - ")[0]; // Sadece ≈üarkƒ± adƒ±
  
  // ƒ∞lk akoru se√ß
  if (currentChords.length > 0) {
    selectChord(0);
  }
  
  // √ñnceki √ßalmayƒ± durdur
  if (isPlaying) {
    stopPlayback();
  }
  
  // Kƒ±sa bir gecikme sonra otomatik ba≈ülat
  setTimeout(() => {
    startPlayback();
  }, 100);
}

// B√∂l√ºm adƒ±nƒ± hesapla
function getSectionName(index, baseLength, repeatCount) {
  const sectionIndex = Math.floor(index / baseLength);
  const sections = ['Verse 1', 'Verse 2', 'Chorus', 'Bridge'];
  return sections[sectionIndex % sections.length] || `B√∂l√ºm ${sectionIndex + 1}`;
}

function getChordQuality(chordName) {
  const name = chordName.toLowerCase();
  if (name.includes('dim') || name.includes('¬∞')) return 'dim';
  if (name.includes('aug') || name.includes('+')) return 'aug';
  if (name.includes('m7') || name.includes('min7')) return 'min7';
  if (name.includes('maj7') || name.includes('M7')) return 'maj7';
  if (name.includes('7')) return 'dom7';
  if (name.includes('m') || name.includes('min')) return 'min';
  return 'maj';
}

function updateSongChordDisplay() {
  const container = document.getElementById("chordsContainer");
  
  if (currentChords.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üéπ</div><p>≈ûarkƒ± se√ßin veya akor dizisi √ºretin</p></div>`;
    return;
  }
  
  // B√∂l√ºmlere g√∂re grupla
  let lastSection = null;
  let html = '';
  
  currentChords.forEach((chord, idx) => {
    // Yeni b√∂l√ºm ba≈ülƒ±ƒüƒ±
    if (chord.section && chord.section !== lastSection) {
      if (lastSection !== null) {
        html += '</div>'; // √ñnceki b√∂l√ºm√º kapat
      }
      html += `<div class="chord-section"><div class="chord-section-label">${chord.section}</div>`;
      lastSection = chord.section;
    }
    
    html += `
      <div class="chord-chip" data-index="${idx}" data-quality="${chord.quality}">
        <span class="chord-index">${idx + 1}</span>
        <span class="chord-name">${chord.name}</span>
      </div>
    `;
  });
  
  if (lastSection !== null) {
    html += '</div>'; // Son b√∂l√ºm√º kapat
  }
  
  container.innerHTML = html;
  
  // Roma rakamlarƒ± (≈üarkƒ± i√ßin basit numara)
  const uniqueChords = [...new Set(currentChords.map(c => c.name))];
  document.getElementById("romanLine").textContent = uniqueChords.join("  ‚Äî  ");
  
  // Event listeners
  container.querySelectorAll(".chord-chip").forEach(chip => {
    chip.addEventListener("click", () => {
      const idx = parseInt(chip.dataset.index);
      selectChord(idx);
      playChord(currentChords[idx].name, 1.0);
    });
  });
}

function setupSongLibraryListeners() {
  // Genre select deƒüi≈ütiƒüinde ≈üarkƒ± listesini g√ºncelle
  const genreSelect = document.getElementById("songGenreSelect");
  if (genreSelect) {
    genreSelect.addEventListener("change", (e) => {
      loadSongList(e.target.value);
      // Mobile'ƒ± da senkronize et
      const mobileGenre = document.getElementById("mobile_songGenreSelect");
      if (mobileGenre) mobileGenre.value = e.target.value;
    });
  }
  
  const mobileGenreSelect = document.getElementById("mobile_songGenreSelect");
  if (mobileGenreSelect) {
    mobileGenreSelect.addEventListener("change", (e) => {
      loadSongList(e.target.value);
      // Desktop'ƒ± da senkronize et
      const desktopGenre = document.getElementById("songGenreSelect");
      if (desktopGenre) desktopGenre.value = e.target.value;
    });
  }
  
  // ƒ∞lk y√ºkleme
  loadSongList("pop");
}

// === MOD DEƒûƒ∞≈ûTƒ∞RME ===

function setMode(mode) {
  currentMode = mode;
  
  document.querySelectorAll(".mode-tab").forEach(t => t.classList.remove("active"));
  document.querySelector(`.mode-tab[data-mode="${mode}"]`)?.classList.add("active");
  
  // Panelleri gizle
  ["trainingPanel", "noteFinderPanel", "chordRecogPanel", "keyDetectPanel"].forEach(id => {
    document.getElementById(id).style.display = "none";
  });
  
  // Se√ßilen paneli g√∂ster
  switch(mode) {
    case "practice":
      document.getElementById("trainingPanel").style.display = "block";
      break;
    case "noteFinder":
      document.getElementById("noteFinderPanel").style.display = "block";
      initNoteFinder();
      break;
    case "chordRecog":
      document.getElementById("chordRecogPanel").style.display = "block";
      initChordRecognition();
      break;
    case "keyDetect":
      document.getElementById("keyDetectPanel").style.display = "block";
      break;
  }
}

// === NOTA BULMA ===

function initNoteFinder() {
  noteFinderActive = false;
  noteFinderStats = { correct: 0, wrong: 0, streak: 0 };
  updateNoteFinderStats();
  document.getElementById("noteFinderTarget").style.display = "none";
  document.getElementById("noteFinderFeedback").textContent = "";
}

function startNoteFinderMode(mode) {
  noteFinderMode = mode;
  noteFinderActive = true;
  document.getElementById("noteFinderLearn").classList.toggle("active", mode === "learn");
  document.getElementById("noteFinderTest").classList.toggle("active", mode === "test");
  generateNoteFinderQuestion();
}

function generateNoteFinderQuestion() {
  noteFinderActive = true;
  clearPianoHighlight();
  
  noteFinderTarget.note = pickRandom(NOTES_SHARP);
  noteFinderTarget.octave = pickRandom([currentOctave, currentOctave + 1]);
  
  document.getElementById("noteFinderTarget").style.display = "block";
  document.getElementById("targetNoteName").textContent = noteFinderTarget.note;
  document.getElementById("targetNoteOctave").textContent = noteFinderTarget.octave;
  document.getElementById("noteFinderFeedback").textContent = "";
  document.getElementById("noteFinderFeedback").className = "note-finder-feedback";
  
  if (noteFinderMode === "learn") {
    playNote(noteFinderTarget.note, noteFinderTarget.octave, 1.0, 1.0);
    setTimeout(() => highlightTargetNote(), 800);
  }
}

function highlightTargetNote() {
  document.querySelectorAll(".piano-key").forEach(k => {
    k.classList.remove("hint");
    if (k.dataset.note === noteFinderTarget.note && parseInt(k.dataset.octave) === noteFinderTarget.octave) {
      k.classList.add("hint");
    }
  });
}

function checkNoteFinder(note, octave, keyElement) {
  const isCorrect = note === noteFinderTarget.note && octave === noteFinderTarget.octave;
  const feedback = document.getElementById("noteFinderFeedback");
  
  if (isCorrect) {
    noteFinderStats.correct++;
    noteFinderStats.streak++;
    feedback.textContent = `‚úì Doƒüru! ${noteFinderStats.streak > 1 ? `(${noteFinderStats.streak} seri)` : ""}`;
    feedback.className = "note-finder-feedback correct";
    keyElement.classList.add("correct-hit");
    setTimeout(() => {
      keyElement.classList.remove("correct-hit");
      generateNoteFinderQuestion();
    }, 800);
  } else {
    noteFinderStats.wrong++;
    noteFinderStats.streak = 0;
    feedback.textContent = `‚úó Bu ${note}${octave}. Aranan: ${noteFinderTarget.note}${noteFinderTarget.octave}`;
    feedback.className = "note-finder-feedback wrong";
    keyElement.classList.add("wrong-hit");
    setTimeout(() => keyElement.classList.remove("wrong-hit"), 300);
    if (noteFinderMode === "learn") highlightTargetNote();
  }
  
  updateNoteFinderStats();
}

function updateNoteFinderStats() {
  document.getElementById("nfCorrect").textContent = noteFinderStats.correct;
  document.getElementById("nfWrong").textContent = noteFinderStats.wrong;
  document.getElementById("nfStreak").textContent = noteFinderStats.streak;
}

// === AKOR TANIMA ===

function initChordRecognition() {
  chordRecogStats = { correct: 0, total: 0 };
  chordRecogSelected = { root: null, type: null };
  updateChordRecogStats();
  document.getElementById("chordRecogAnswer").style.display = "none";
  document.getElementById("chordRecogResult").textContent = "";
  document.getElementById("chordRecogResult").className = "chord-recog-result";
}

function playChordRecogQuestion() {
  const difficulty = document.getElementById("chordRecogDifficulty").value;
  
  let types = [];
  if (difficulty === "easy") types = ["maj", "min"];
  else if (difficulty === "medium") types = ["maj", "min", "dim", "aug"];
  else types = ["maj", "min", "dim", "aug", "maj7", "min7", "dom7"];
  
  chordRecogTarget.root = pickRandom(NOTES_SHARP);
  chordRecogTarget.type = pickRandom(types);
  chordRecogTarget.fullName = chordRecogTarget.root + CHORD_TYPES[chordRecogTarget.type].symbol;
  
  playChord(chordRecogTarget.fullName, 1.5);
  highlightPiano(chordRecogTarget.fullName);
  
  // Se√ßenekleri g√∂ster
  document.getElementById("chordRecogAnswer").style.display = "block";
  document.getElementById("chordRecogResult").textContent = "";
  document.getElementById("chordRecogResult").className = "chord-recog-result";
  chordRecogSelected = { root: null, type: null };
  
  // K√∂k nota butonlarƒ±
  const rootDiv = document.getElementById("rootNoteOptions");
  rootDiv.innerHTML = NOTES_SHARP.map(n => `<button class="note-option" data-note="${n}">${n}</button>`).join("");
  rootDiv.querySelectorAll(".note-option").forEach(btn => {
    btn.addEventListener("click", () => {
      rootDiv.querySelectorAll(".note-option").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      chordRecogSelected.root = btn.dataset.note;
    });
  });
  
  // Tip butonlarƒ±
  const typeDiv = document.getElementById("chordTypeOptions");
  typeDiv.innerHTML = types.map(t => `<button class="type-option" data-type="${t}">${CHORD_TYPES[t].short}</button>`).join("");
  typeDiv.querySelectorAll(".type-option").forEach(btn => {
    btn.addEventListener("click", () => {
      typeDiv.querySelectorAll(".type-option").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      chordRecogSelected.type = btn.dataset.type;
    });
  });
}

function checkChordRecogAnswer() {
  if (!chordRecogSelected.root || !chordRecogSelected.type) {
    document.getElementById("chordRecogResult").textContent = "K√∂k nota ve tip se√ßin!";
    return;
  }
  
  chordRecogStats.total++;
  const isCorrect = chordRecogSelected.root === chordRecogTarget.root && chordRecogSelected.type === chordRecogTarget.type;
  const result = document.getElementById("chordRecogResult");
  
  if (isCorrect) {
    chordRecogStats.correct++;
    result.textContent = `‚úì Doƒüru! ${chordRecogTarget.fullName}`;
    result.className = "chord-recog-result correct";
  } else {
    result.textContent = `‚úó Yanlƒ±≈ü! Doƒüru: ${chordRecogTarget.fullName}`;
    result.className = "chord-recog-result wrong";
  }
  
  updateChordRecogStats();
}

function updateChordRecogStats() {
  document.getElementById("crCorrect").textContent = chordRecogStats.correct;
  document.getElementById("crTotal").textContent = chordRecogStats.total;
  const acc = chordRecogStats.total > 0 ? Math.round((chordRecogStats.correct / chordRecogStats.total) * 100) : 0;
  document.getElementById("crAccuracy").textContent = acc + "%";
}

// === TONALƒ∞TE ANALƒ∞Zƒ∞ ===

const KEY_PROFILES = {
  major: [6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88],
  minor: [6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17]
};

function analyzeCurrentProgression() {
  if (currentChords.length === 0) {
    alert("√ñnce akor dizisi olu≈üturun!");
    return;
  }
  performKeyAnalysis(currentChords.map(c => c.name));
}

function analyzeManualChords() {
  const input = document.getElementById("manualChordInput").value.trim();
  if (!input) {
    alert("Akor girin (√∂r: C Am F G)");
    return;
  }
  performKeyAnalysis(input.split(/[\s,]+/).filter(c => c.length > 0));
}

function performKeyAnalysis(chordNames) {
  const validChords = chordNames.filter(c => parseChordName(c));
  if (validChords.length === 0) {
    alert("Ge√ßerli akor bulunamadƒ±!");
    return;
  }
  
  // Notalarƒ± topla
  const allNotes = [];
  const chordRoots = [];
  
  validChords.forEach(name => {
    const notes = getChordNoteNames(name);
    allNotes.push(...notes);
    const parsed = parseChordName(name);
    if (parsed) {
      chordRoots.push(parsed.root);
      allNotes.push(parsed.root, parsed.root); // K√∂k nota aƒüƒ±rlƒ±klƒ±
    }
  });
  
  // Nota sayƒ±mƒ±
  const noteCount = {};
  NOTES_SHARP.forEach(n => noteCount[n] = 0);
  allNotes.forEach(n => {
    const norm = {"Db":"C#","Eb":"D#","Gb":"F#","Ab":"G#","Bb":"A#"}[n] || n;
    if (noteCount[norm] !== undefined) noteCount[norm]++;
  });
  
  // Skorlama
  const keyScores = [];
  NOTES_SHARP.forEach((root, idx) => {
    let majScore = 0, minScore = 0;
    KEY_PROFILES.major.forEach((w, i) => majScore += noteCount[NOTES_SHARP[(idx + i) % 12]] * w);
    KEY_PROFILES.minor.forEach((w, i) => minScore += noteCount[NOTES_SHARP[(idx + i) % 12]] * w);
    
    if (chordRoots.includes(root)) { majScore += 5; minScore += 5; }
    if (chordRoots.includes(NOTES_SHARP[(idx + 7) % 12])) { majScore += 3; minScore += 3; }
    
    keyScores.push({ key: root, mode: "Major", score: majScore, display: root + " Major" });
    keyScores.push({ key: root, mode: "Minor", score: minScore, display: root + " Minor" });
  });
  
  keyScores.sort((a, b) => b.score - a.score);
  
  const top = keyScores[0];
  const maxScore = top.score;
  const confidence = Math.min(100, Math.round(((top.score - keyScores[1].score) / (maxScore || 1)) * 150 + 40));
  
  // Sonu√ßlarƒ± g√∂ster
  document.getElementById("keyDetectResults").style.display = "block";
  document.getElementById("detectedKey").textContent = top.display;
  document.getElementById("confidenceFill").style.width = confidence + "%";
  document.getElementById("confidenceValue").textContent = confidence + "%";
  
  // Alternatifler
  const altDiv = document.getElementById("alternativeKeys");
  altDiv.innerHTML = keyScores.slice(1, 4).map(k => 
    `<span class="alt-key-chip">${k.display} <span class="confidence">${Math.round(k.score / maxScore * 100)}%</span></span>`
  ).join("");
  
  // Nota daƒüƒ±lƒ±mƒ±
  const distDiv = document.getElementById("noteDistribution");
  const maxCount = Math.max(...Object.values(noteCount), 1);
  distDiv.innerHTML = NOTES_SHARP.map(n => 
    `<div class="note-bar"><div class="note-bar-fill" style="height:${(noteCount[n]/maxCount)*35}px"></div><span class="note-bar-label">${n.replace("#","‚ôØ")}</span></div>`
  ).join("");
  
  // Fonksiyonel analiz
  const funcDiv = document.getElementById("functionalAnalysis");
  const scaleChords = buildScaleChords(top.key, top.mode === "Minor" ? "naturalMinor" : "major", "triads");
  const funcNames = top.mode === "Minor" ? ["i","ii¬∞","III","iv","v","VI","VII"] : ["I","ii","iii","IV","V","vi","vii¬∞"];
  
  funcDiv.innerHTML = validChords.map(name => {
    const parsed = parseChordName(name);
    let func = "?";
    scaleChords.forEach((sc, i) => { if (sc.root === parsed?.root) func = funcNames[i]; });
    return `<span class="function-chip"><span class="chord-name">${name}</span><span class="function-name">(${func})</span></span>`;
  }).join("");
  
  // Modal karakter
  const modalDiv = document.getElementById("modalCharacter");
  modalDiv.innerHTML = `Tespit: <span class="highlight">${top.display}</span>. G√∂receli: ${top.mode === "Minor" ? NOTES_SHARP[(NOTES_SHARP.indexOf(top.key)+3)%12]+" Major" : NOTES_SHARP[(NOTES_SHARP.indexOf(top.key)+9)%12]+" Minor"}`;
}

// === SES AYARLARI ===

function setVolume(val) {
  volume = val / 100;
  if (masterGain) masterGain.gain.value = volume;
  document.getElementById("volumeValue").textContent = val + "%";
}

function toggleReverb() {
  reverbEnabled = !reverbEnabled;
  document.getElementById("reverbToggle").classList.toggle("active", reverbEnabled);
  if (wetGain) wetGain.gain.value = reverbEnabled ? 0.35 : 0;
  if (dryGain) dryGain.gain.value = reverbEnabled ? 0.65 : 1.0;
}

function toggleArpeggiator() {
  arpeggiatorEnabled = !arpeggiatorEnabled;
  // Eƒüer arpeggiator aktifse, normal artik√ºlasyonu arpeggio yap
  if (arpeggiatorEnabled) {
    currentArticulation = "arpeggio";
  } else if (currentArticulation === "arpeggio") {
    currentArticulation = "normal";
  }
  document.querySelectorAll(".articulation-btn").forEach(b => {
    b.classList.toggle("active", b.dataset.articulation === currentArticulation);
  });
}

function toggleBassLine() {
  bassLineEnabled = !bassLineEnabled;
}

// Bass note √ßalma (akora e≈ülik eden bas)
async function playBassNote(chordName, duration = 1.0) {
  if (!bassLineEnabled) return;
  
  // Akorun root notasƒ±nƒ± bul
  const rootMatch = chordName.match(/^([A-G][#b]?)/);
  if (!rootMatch) return;
  
  const bassNote = rootMatch[1];
  const bassOctave = 2; // Bas oktavƒ±
  
  // Bas notasƒ±nƒ± √ßal
  await playNote(bassNote, bassOctave, duration * 0.9, 0.75, 0);
}

// Mevcut bass pattern (BASS_PATTERNS yukarƒ±da tanƒ±mlƒ±)
// currentBassPattern ve bassSequence de yukarƒ±da tanƒ±mlƒ±

// Akor dizisine g√∂re bass line hesapla
function calculateBassLine(chords, patternType = null) {
  const pattern = BASS_PATTERNS[patternType || currentBassPattern] || BASS_PATTERNS.rootFifth;
  bassSequence = [];
  
  chords.forEach((chord, chordIndex) => {
    const rootNote = chord.root || chord.name.match(/^([A-G][#b]?)/)?.[1];
    if (!rootNote) return;
    
    const rootMidi = NOTE_TO_MIDI[rootNote];
    const isMinor = chord.quality?.includes('min') || chord.name.includes('m');
    
    pattern.pattern.forEach(p => {
      let interval = p.interval;
      
      // Min√∂r akorlar i√ßin 3rd'√º d√ºzelt (major 3rd = 4, minor 3rd = 3)
      if (interval === 4 && isMinor) {
        interval = 3;
      }
      
      // Nota hesapla
      const noteMidi = (rootMidi + interval) % 12;
      const noteName = NOTES_SHARP[noteMidi];
      
      bassSequence.push({
        chordIndex,
        beat: p.beat,
        note: noteName,
        octave: 2,
        velocity: p.beat === 0 ? 0.8 : 0.65, // Downbeat daha g√º√ßl√º
        duration: 0.4
      });
    });
  });
  
  return bassSequence;
}

// Stil bazlƒ± otomatik bass pattern se√ßimi
function getStyleBasedBassPattern(style) {
  const stylePatterns = {
    pop: "rootFifth",
    rock: "rock",
    jazz: "jazz",
    blues: "walking",
    ballad: "ballad",
    edm: "root",
    latin: "latin",
    rnb: "rootFifth",
    classical: "root",
    funk: "funk",
    country: "rootFifth",
    gospel: "walking",
    world: "latin",
    reggae: "reggae"
  };
  return stylePatterns[style] || "rootFifth";
}

// Bass line'ƒ± master clock ile senkronize √ßal
function playBassAtTick(tick, chordIndex) {
  if (!bassLineEnabled || bassSequence.length === 0) return;
  
  const ticksPerBeat = 4;
  const ticksPerMeasure = 16;
  const beatInMeasure = (tick % ticksPerMeasure) / ticksPerBeat;
  
  // Bu tick'te √ßalmasƒ± gereken bass notalarƒ±nƒ± bul
  bassSequence.forEach(bassNote => {
    if (bassNote.chordIndex === chordIndex) {
      // Beat pozisyonu e≈üle≈üiyor mu? (0.1 tolerans)
      if (Math.abs(bassNote.beat - beatInMeasure) < 0.1) {
        playNote(bassNote.note, bassNote.octave, bassNote.duration, bassNote.velocity, 0);
      }
    }
  });
}

function setArticulation(art) {
  currentArticulation = art;
  // Arpeggiator toggle'ƒ± da g√ºncelle
  if (art === "arpeggio") {
    arpeggiatorEnabled = true;
  } else {
    arpeggiatorEnabled = false;
  }
  document.querySelectorAll('[data-sync="arpToggle"]').forEach(el => {
    el.classList.toggle("active", arpeggiatorEnabled);
  });
  document.querySelectorAll(".articulation-btn").forEach(b => b.classList.remove("active"));
  document.querySelector(`.articulation-btn[data-articulation="${art}"]`)?.classList.add("active");
}

// === MOBƒ∞L AYARLAR ===

function toggleMobileSettings() {
  const sheet = document.getElementById("mobileBottomSheet");
  const overlay = document.getElementById("mobileOverlay");
  const isVisible = sheet.classList.contains("visible");
  
  sheet.classList.toggle("visible", !isVisible);
  overlay.classList.toggle("visible", !isVisible);
}

// === EVENT LISTENERS ===

// Sync helper: Bir kontrol√º deƒüi≈ütirdiƒüinde diƒüerini de g√ºncelle
function syncControl(syncKey, value) {
  document.querySelectorAll(`[data-sync="${syncKey}"]`).forEach(el => {
    if (el.type === 'range' || el.tagName === 'SELECT') {
      el.value = value;
    }
  });
  // Volume value display'i de g√ºncelle
  if (syncKey === 'volumeSlider') {
    document.querySelectorAll('[id$="volumeValue"]').forEach(el => {
      el.textContent = value + '%';
    });
  }
}

function setupEventListeners() {
  // Generate
  document.getElementById("generateBtn").addEventListener("click", () => {
    stopPlayback();
    generateChordProgression();
  });
  
  // Transport
  document.getElementById("playBtn").addEventListener("click", togglePlayback);
  document.getElementById("stopBtn").addEventListener("click", stopPlayback);
  document.getElementById("loopBtn").addEventListener("click", toggleLoop);
  document.getElementById("metronomeBtn").addEventListener("click", toggleMetronome);
  document.getElementById("tempoUp").addEventListener("click", () => changeTempo(5));
  document.getElementById("tempoDown").addEventListener("click", () => changeTempo(-5));
  
  // Ritim se√ßici butonlarƒ±
  document.getElementById("prevRhythmBtn").addEventListener("click", prevRhythm);
  document.getElementById("nextRhythmBtn").addEventListener("click", nextRhythm);
  
  // Comping pattern se√ßici butonlarƒ±
  document.getElementById("prevCompingBtn").addEventListener("click", prevComping);
  document.getElementById("nextCompingBtn").addEventListener("click", nextComping);
  
  // Bass pattern se√ßici butonlarƒ±
  document.getElementById("prevBassBtn").addEventListener("click", prevBass);
  document.getElementById("nextBassBtn").addEventListener("click", nextBass);
  
  // ƒ∞lk ritim, comping ve bass adƒ±nƒ± g√∂ster
  updateRhythmDisplay();
  updateCompingDisplay();
  updateBassDisplay();
  
  // Modlar
  document.querySelectorAll(".mode-tab").forEach(tab => {
    tab.addEventListener("click", () => setMode(tab.dataset.mode));
  });
  
  // Piyano tu≈ülarƒ±
  document.querySelectorAll(".piano-key").forEach(key => {
    const handler = () => {
      const note = key.dataset.note;
      const octave = parseInt(key.dataset.octave);
      playNote(note, octave, 1.0, 1.0);
      
      if (currentMode === "noteFinder" && noteFinderActive) {
        checkNoteFinder(note, octave, key);
      }
    };
    key.addEventListener("click", handler);
    key.addEventListener("touchstart", (e) => { e.preventDefault(); handler(); }, { passive: false });
  });
  
  // Note Finder
  document.getElementById("noteFinderLearn").addEventListener("click", () => startNoteFinderMode("learn"));
  document.getElementById("noteFinderTest").addEventListener("click", () => startNoteFinderMode("test"));
  document.getElementById("noteFinderNext").addEventListener("click", generateNoteFinderQuestion);
  
  // Chord Recognition
  document.getElementById("chordRecogPlay").addEventListener("click", playChordRecogQuestion);
  document.getElementById("chordRecogSubmit").addEventListener("click", checkChordRecogAnswer);
  
  // Key Detection
  document.getElementById("analyzeKeyBtn").addEventListener("click", analyzeCurrentProgression);
  document.getElementById("analyzeManualBtn").addEventListener("click", analyzeManualChords);
  
  // Mobil
  document.getElementById("mobileSettingsBtn").addEventListener("click", toggleMobileSettings);
  document.getElementById("mobileOverlay").addEventListener("click", toggleMobileSettings);
  
  // Klavye kƒ±sayollarƒ±
  document.addEventListener("keydown", e => {
    if (e.code === "Space") { e.preventDefault(); togglePlayback(); }
    else if (e.code === "KeyM") toggleMetronome();
    else if (e.code === "KeyL") toggleLoop();
    else if (e.code === "KeyG") generateChordProgression();
    else if (e.code === "Escape") { stopPlayback(); stopMetronome(); }
    else if (e.code === "ArrowUp") changeTempo(5);
    else if (e.code === "ArrowDown") changeTempo(-5);
  });
  
  // === SENKRONIZE KONTROLLER (Hem Desktop hem Mobile) ===
  setupSyncedControls();
  
  // === ≈ûARKI K√úT√úPHANESƒ∞ ===
  setupSongLibraryListeners();
}

function setupSyncedControls() {
  // Artik√ºlasyon butonlarƒ± - t√ºm sayfada
  document.querySelectorAll(".articulation-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const art = btn.dataset.articulation;
      setArticulation(art);
      // T√ºm artik√ºlasyon butonlarƒ±nƒ± g√ºncelle
      document.querySelectorAll(".articulation-btn").forEach(b => {
        b.classList.toggle("active", b.dataset.articulation === art);
      });
    });
  });
  
  // Preset butonlarƒ± - t√ºm sayfada
  document.querySelectorAll(".preset-chip").forEach(chip => {
    chip.addEventListener("click", () => {
      applyPreset(chip.dataset.preset);
      // Mobil a√ßƒ±ksa kapat
      const sheet = document.getElementById("mobileBottomSheet");
      if (sheet.classList.contains("visible")) {
        toggleMobileSettings();
      }
    });
  });
  
  // Volume slider - desktop
  const desktopVolume = document.getElementById("volumeSlider");
  if (desktopVolume) {
    desktopVolume.addEventListener("input", e => {
      setVolume(e.target.value);
      syncControl('volumeSlider', e.target.value);
    });
  }
  
  // Volume slider - mobile
  const mobileVolume = document.getElementById("mobile_volumeSlider");
  if (mobileVolume) {
    mobileVolume.addEventListener("input", e => {
      setVolume(e.target.value);
      syncControl('volumeSlider', e.target.value);
    });
  }
  
  // Oktav select - desktop
  const desktopOctave = document.getElementById("octaveSelect");
  if (desktopOctave) {
    desktopOctave.addEventListener("change", e => {
      currentOctave = parseInt(e.target.value);
      updatePianoOctave();
      syncControl('octaveSelect', e.target.value);
    });
  }
  
  // Oktav select - mobile
  const mobileOctave = document.getElementById("mobile_octaveSelect");
  if (mobileOctave) {
    mobileOctave.addEventListener("change", e => {
      currentOctave = parseInt(e.target.value);
      updatePianoOctave();
      syncControl('octaveSelect', e.target.value);
    });
  }
  
  // Reverb toggle - desktop
  const desktopReverb = document.getElementById("reverbToggle");
  if (desktopReverb) {
    desktopReverb.addEventListener("click", () => {
      toggleReverb();
      // T√ºm reverb toggle'larƒ± g√ºncelle
      document.querySelectorAll('[data-sync="reverbToggle"]').forEach(el => {
        el.classList.toggle("active", reverbEnabled);
      });
    });
  }
  
  // Reverb toggle - mobile
  const mobileReverb = document.getElementById("mobile_reverbToggle");
  if (mobileReverb) {
    mobileReverb.addEventListener("click", () => {
      toggleReverb();
      // T√ºm reverb toggle'larƒ± g√ºncelle
      document.querySelectorAll('[data-sync="reverbToggle"]').forEach(el => {
        el.classList.toggle("active", reverbEnabled);
      });
    });
  }
  
  // Enstr√ºman se√ßici - desktop
  const desktopInstrument = document.getElementById("instrumentSelect");
  if (desktopInstrument) {
    desktopInstrument.addEventListener("change", e => {
      changeInstrument(e.target.value);
      syncControl('instrumentSelect', e.target.value);
    });
  }
  
  // Enstr√ºman se√ßici - mobile
  const mobileInstrument = document.getElementById("mobile_instrumentSelect");
  if (mobileInstrument) {
    mobileInstrument.addEventListener("change", e => {
      changeInstrument(e.target.value);
      syncControl('instrumentSelect', e.target.value);
    });
  }
  
  // Arpeggiator toggle - desktop & mobile
  document.querySelectorAll('[data-sync="arpToggle"]').forEach(btn => {
    btn.addEventListener("click", () => {
      toggleArpeggiator();
      document.querySelectorAll('[data-sync="arpToggle"]').forEach(el => {
        el.classList.toggle("active", arpeggiatorEnabled);
      });
    });
  });
  
  // Bass toggle - desktop & mobile
  document.querySelectorAll('[data-sync="bassToggle"]').forEach(btn => {
    btn.addEventListener("click", () => {
      toggleBassLine();
      document.querySelectorAll('[data-sync="bassToggle"]').forEach(el => {
        el.classList.toggle("active", bassLineEnabled);
      });
    });
  });
  
  // Bass pattern select - desktop
  const desktopBassPattern = document.getElementById("bassPatternSelect");
  if (desktopBassPattern) {
    desktopBassPattern.addEventListener("change", e => {
      const value = e.target.value;
      if (value === "auto") {
        // Otomatik mod - stile g√∂re se√ß
        const style = document.getElementById("styleSelect")?.value || "pop";
        currentBassPattern = getStyleBasedBassPattern(style);
      } else {
        currentBassPattern = value;
      }
      currentBassIndex = bassPatternNames.indexOf(currentBassPattern);
      updateBassDisplay();
      if (currentChords.length > 0) {
        calculateBassLine(currentChords, currentBassPattern);
      }
      syncControl('bassPatternSelect', e.target.value);
    });
  }
  
  // Bass pattern select - mobile
  const mobileBassPattern = document.getElementById("mobile_bassPatternSelect");
  if (mobileBassPattern) {
    mobileBassPattern.addEventListener("change", e => {
      const value = e.target.value;
      if (value === "auto") {
        const style = document.getElementById("mobile_styleSelect")?.value || 
                      document.getElementById("styleSelect")?.value || "pop";
        currentBassPattern = getStyleBasedBassPattern(style);
      } else {
        currentBassPattern = value;
      }
      currentBassIndex = bassPatternNames.indexOf(currentBassPattern);
      updateBassDisplay();
      if (currentChords.length > 0) {
        calculateBassLine(currentChords, currentBassPattern);
      }
      syncControl('bassPatternSelect', e.target.value);
    });
  }
  
  // Diƒüer select'ler i√ßin senkronizasyon
  ['keySelect', 'scaleSelect', 'styleSelect', 'lengthSelect', 'chordTypeSelect', 'algorithmSelect', 'instrumentSelect', 'bassPatternSelect'].forEach(controlName => {
    const desktop = document.getElementById(controlName);
    const mobile = document.getElementById('mobile_' + controlName);
    
    if (desktop) {
      desktop.addEventListener("change", e => {
        syncControl(controlName, e.target.value);
      });
    }
    
    if (mobile) {
      mobile.addEventListener("change", e => {
        syncControl(controlName, e.target.value);
      });
    }
  });
}

// === BA≈ûLAT ===

document.addEventListener("DOMContentLoaded", initializeApp);

// ============================================
// B√ñL√úM 3 SONU - KOD TAMAMLANDI
// ============================================
  </script>
</body>
</html>